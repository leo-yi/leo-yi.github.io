<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8"/>
        <title> PHP 之道 | PHP The Right Way 中文版</title>
        <meta name="description" content="An easy-to-read, quick reference for PHP best practices, accepted coding standards, and links to authoritative PHP tutorials around the Web"/>
        <meta name="robots" content="index,follow,archive"/>
        <meta property="og:image:url" content="http://www.phptherightway.com/images/og-image.png"/>
        <meta property="og:image:width" content="1024"/>
        <meta property="og:image:height" content="640"/>
        <meta property="og:title" content="PHP: The Right Way"/>
        <meta property="og:description" content="An easy-to-read, quick reference for PHP best practices, accepted coding standards, and links to authoritative PHP tutorials around the Web"/>
        <meta property="og:url" content="http://www.phptherightway.com"/>
        <meta property="og:site_name" content="PHP: The Right Way"/>
        <meta property="og:type" content="website"/>
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
        <link rel="icon" href="/php-the-right-way/images/favicon.png" type="image/png"/>
        <link rel="stylesheet" href="/php-the-right-way/styles/syntax.css">
        <style>
        *{box-sizing:border-box}body{line-height:32px;text-rendering:optimizeLegibility;font-size:16px;color:#525252;font-family:NotoSansHans-Regular,AvenirNext-Regular,arial,Hiragino Sans GB,"Microsoft Yahei","Hiragino Sans GB","WenQuanYi Micro Hei",sans-serif}h1,h2,h3,h4{font-family:georgia,serif}h1,.alpha{position:relative;font-size:48px;font-weight:normal;line-height:50px;text-align:center}h2,.beta{font-size:32px;font-weight:normal;line-height:36px}h3,.gamma{font-size:24px;font-weight:bold;line-height:30px}blockquote{border-left:3px solid #ccc;padding-left:20px;color:#777;font-style:italic;word-wrap:break-word}a{color:#4f5b93}a:hover{color:#8892bf}.back-to-top{text-align:center}.back-to-top a{background:#4f5b93;border-radius:3px;display:inline-block;height:40px;padding:0 20px;transition:all .1s ease;color:white;font-family:verdana,sans-serif;font-size:13px;line-height:40px;text-decoration:none;text-transform:uppercase}.back-to-top a:hover{background:#8892bf}img{max-width:100%}pre,code{color:#444;font-family:"Source Code Pro",Consolas,"Andale Mono WT","Andale Mono","Lucida Console","Lucida Sans Typewriter","DejaVu Sans Mono","Bitstream Vera Sans Mono","Liberation Mono","Nimbus Mono L",Monaco,"Courier New",Courier,monospace;font-size:100%}a pre,a code{color:inherit}pre{background:#f7f7f7;border:1px solid #eee;border-radius:3px;display:block;overflow:auto;padding:20px;width:100%}@media (max-width:767px){body{font-size:18px;line-height:24px}h1,.alpha{font-size:36px;line-height:38px}h2,.beta{font-size:24px;line-height:28px}h3,.gamma{font-size:18px;line-height:23px}blockquote{margin-left:0}ul,ol{padding-left:1em}pre{padding:5px 10px;white-space:pre-wrap;white-space:-moz-pre-wrap;white-space:-pre-wrap;white-space:-o-pre-wrap;word-wrap:break-word}}@media (max-width:360px){body{font-size:16px;line-height:21px}h1,.alpha{font-size:28px;line-height:30px}h2,.beta{font-size:20px;line-height:23px}h3,.gamma{font-size:16px;line-height:20px}}.site-header{padding-top:40px;margin-bottom:40px;text-align:center}.site-header h1{margin:0;font-size:72px;line-height:60px}.site-header h1 em{display:block;font-size:34px;font-style:normal}.site-header h1 a{color:#333;text-decoration:none}.site-header h1 a:hover{color:#8892bf}.site-header .build-date{margin-bottom:10px;color:#999;font-family:verdana,sans-serif;font-size:11px;text-transform:uppercase}.site-header .btn-share{background:#8892bf;border-radius:3px;display:inline-block;height:30px;padding:0 20px;vertical-align:baseline;color:white;font-family:verdana,sans-serif;font-size:12px;line-height:30px;text-decoration:none;text-transform:uppercase}.site-header .fork-me{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAJUAAACVCAMAAABmfEh9AAAAMFBMVEXr6+wSFiH////U1NT09PSRk5hucHb5+flMT1f8/Py+v8EtMDpXWWE8P0hgY2rg4OD5mIG8AAAFoElEQVR4AbSb0W4sKQxEyxfMdAyG///b1bCt3MSZ1CKth4coj0fVVp0GevDnc318POqj9cvlv1efl9taC6j18fj4+JO7AlWtrY9LDtblboVg5VKh9XkdpTUIVjIVsJqcPUSSVi7VowJ4pjWOHuKViUWodljlcOR9XN1KCVhpVOERPrHGOBz5gJVJFcN6Yp2NfHiIiVQxrI0l1xFWXlqE6vMZltOCGCGtbKqIdVgQI6SVRMXS6m9teUJFsI6dGNLKpgpYMg5Hvoe0cqhCPzz4yGemRagSRj6klUsV0zp2Ykgrg+r/j7zPK6SVSxXTmr/Lp2miEwMVTYs5cQKa5URCFdPiI9+AAg0FEdJKpootP14l1cTQ8p0YqXhaEcpEuvbvqg5ppVPF2RrfoSoKNMeJnIr31vDvM9XE4Ektz6m4E/3zaTn2PE1pLdmJnIo78aa5FuryKJ8R08qm4k70hTaXSsSKs5VNxZ24a6GsN+x8OBV34jIRhYpHJ8aWT6WKacXXwFKGYokv28l9gYstn00V0/IvWL4A8/1XxKD8aCSTird8G3vk1bpVFeFOzKTiTtxQEpLaKzoxmYqPfMG8oXps+ejEZKqANfu4PhF8Q1UsLOdOTKfiThSDVW3TU5zIqc5bXh+q6In7RE5F0vIvI9+bmEUi7sQ8KpJWh95TluFETnXuxG5+14RmOJFTnRdEv6FQWsZpIKc6d+INpYYZsKITk6m4E0W8YEqrZZ6nlURFnNgXpvhaBRqxRkgrnYqcnbYmvjAES4Q7MZkqphWceD3jumrIijgxj4qcQTTsuLy3IdyJqVQxrYjl9wYDsAMnplLFtOLID0AHDvaJyVSk5duUAisN7acTQ1r5VMSJAu2G1eUFVkgrnYq8NK/SxebBDVk+FXHiRPGzG7J8KuLEoXc07YpYwYnZVAc3ZApUPbghS6EiTgxQNhR+cEOWTMVuyC5Yl4kmMcL4dppPRZzY6i76rhi85fOpyA1Zg46FpoBFKYaWz6cip4EK1KbV2kKPaY2QVjYVaXlvXauJtHodODGXijhRGqyLFHSJKzoxn4rtqkVkHyHF5cGJyVQxrXhd0A2fTa+DOzFSJaYVjkZ03VAGANq5EyNVXlrhq5F2Q6HoMH5DFqmS0/IfTrRqz5isMCfmU3EnNvyLMyd1Yj4Vc6Ksv5WlSpyYT8X2ibC//xbixHwq4kSpRaQXF3Fpkzoxn4o4cZkCTSZUuBPzqUjL68KGWq6m3In5VMSJNqVhecMWkDpxYjYV2fn4TkqswrooCndipMpMa351omN5N+hU0ScfcWI6FTmxmS62rXhDOXFiOhVp+WvZhsK+ZVn+qxPzqchm31FcFGvtAVv+uxPzqUha0/bj87UsjFb4aiSfijqx7Ygc4Ddk+VTciebPP4CJk31iPhV34iara+5p/7Xl86m4E3dSu7mM/LogUr3fid3Wbq4u+55T24u03kZFnOjSlu3jNxGF/fx1wduo+FcjBbK9+ITq8tOJ76LiX1Jabe2GelUQ76QiTuyGuqFg80VBvJeKONE21KsTm+G9vJWKOFE21OeJTTgaeTMVSasBl0jI6nYip8qfrW9O1AY0+bneTMW/GrEKqLxYPZ+KpBWPRmb7p307SEEoBoIoqBAlIOj9byt/9rUT3yaeoGhhGkmL/2VY9ZdOvBcqdGKtQifWKnRircILWa3CaiRX+cr3KndiqvIvn1TlJWWqcidaVV/5QIUl5baqTytXuROtKjqxVqETaxU6sVahE1uVNzaxCp0Yqny33jtVeUmZqnzlU5WvfKpyWqnKaaUqr0ZSlVcjqcqrkVqFTsxVeCFrVE7rM51oVZTWsLZVRVrjur5Eq4K0xnXtcaEKWbf1fEFVsca1HlBFrHEtvKWGrIFBlbHGheVA6ZoPVK2rV/18dX9UR3VUR3VUX8Uz94M6xyeLAAAAAElFTkSuQmCC);background-position:top right;background-repeat:no-repeat;background-size:contain;height:162px;width:168px;position:absolute;top:0;right:0;z-index:100;}.site-navigation,.site-content,.site-footer{margin:0 auto;max-width:840px;width:92%}.site-navigation{-moz-columns:3;columns:3;-moz-column-gap:40px;column-gap:40px}.site-navigation input[type="checkbox"],.site-navigation label{display:none}.site-navigation ul{list-style:none;margin:0;padding:0}.site-navigation ul li{margin-bottom:20px;font-size:22px;line-height:28px}.site-navigation ul li a{display:block;color:#444;font-weight:700;text-decoration:none}.site-navigation ul li a:hover{color:#8892bf}.site-navigation ul li ul{padding-top:8px}.site-navigation ul li li{margin-bottom:6px;font-size:18px}.site-navigation ul li li a{border:none;color:#777;font-weight:normal}.site-navigation li{page-break-inside:avoid;break-inside:avoid}@media (max-width:820px){.site-navigation{-moz-columns:2;columns:2}}@media (max-width:560px){.site-navigation{-moz-columns:1;columns:1}}@media (max-width:375px){.site-navigation{background:rgba(255,255,255,0.95);-moz-columns:1;columns:1;max-height:100vh;position:fixed;bottom:0;left:0;z-index:100}.site-navigation label{background:#4f5b93;box-sizing:border-box;display:block;height:40px;padding:0 10px;width:100vh;position:absolute;bottom:0;left:0;color:white;font-family:verdana,sans-serif;font-size:13px;line-height:40px;text-transform:uppercase;z-index:2}.site-navigation>ul{background:rgba(255,255,255,0.96);border-top:3px solid #8892bf;box-shadow:rgba(0,0,0,0.25) 0 -5px 10px;box-sizing:border-box;padding:20px;overflow:auto;-webkit-overflow-scrolling:touch;position:absolute;left:0;bottom:40px;height:50vh;width:100vh;-ms-transform:translate(0, 100vh);transform:translate(0, 100vh);transition:all .2s ease;z-index:1}.site-navigation input[type="checkbox"]:checked~ul{-ms-transform:translate(0, 0);transform:translate(0, 0)}}.site-content h1{padding-top:40px;position:relative}.site-content h1:after{border:1px solid #ddd;border-bottom:none;content:"";display:block;height:8px;position:absolute;left:0;top:0;width:100%}.site-content.chapters{counter-reset:chapter}.site-content.chapters h1{counter-increment:chapter;padding-top:60px}.site-content.chapters h1:before{display:inline-block;content:"Chapter " counter(chapter) ".";position:absolute;top:30px;left:50%;-ms-transform:translateX(-50%);transform:translateX(-50%);color:#999;font-size:12px;letter-spacing:1px;line-height:20px;text-transform:uppercase;text-align:center}.site-content #welcome ul{-moz-columns:3;columns:3;-moz-column-gap:30px;column-gap:30px;list-style-position:inside}.site-content .back-to-top{margin-bottom:60px}@media (max-width:870px){.site-content #welcome ul{-moz-columns:2;columns:2}}@media (max-width:600px){.site-content #welcome ul{-moz-columns:1;columns:1}}.site-footer{border-top:1px solid #ccc;margin:60px auto 0 auto;padding:40px 20px;font-family:verdana,sans-serif;font-size:16px;text-align:center}.site-footer .cc-badge{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFgAAAAfCAMAAABUFvrSAAAAw1BMVEX///8AAAAAAACrsar///8oKSjR1NAODg4jHyDLz8pAPz/f399wcHBQUFBgYGDJzcjEyMN5fHkwMDC9wry4vbeAgIDw8PDBxcDO0c3M0MyUmJPGysW6v7q/v7+fn5/T1tKvtK61urSxt7C/w76zuLKhpKDk5OSRk5F2c3RQUVAbGxuts6yEhoR9fnxDREMgICDW1dXJyMirq6qvr68wLS3Pz8+Rj4+Pj4+LioqEgYJaV1i6ubmbl5meoJ1dXl06NjcZGRmWw6QEAAAAAnRSTlMMANomgjQAAAMCSURBVHjatZYJc6JAEIWznWFmOAQDguAdjUqMd0yi5vz/v2q7GTmkNusWW3kxNfJkPts3TMPVFfyIfiH3ttHwRs1623F0PYp03XHa9ebI6zRu74aDwcPDdQUBXCG3440Qq4ec91GchzqhM/J1FSEYuVguYudLASixnBM6JVPJNxqgtJts2mWHwMh1Ij6dQabZlEeKfDccDlo4xbAsA6e11KzLDoG9EXHvqVbb73Z9m+q+r4dEppLHAmomQ5k1EMmsi44CY74JV/gBU+ohWqtjzSMMY6iBjR4AfQAaTVLO87HkTDabiXIUuNnWieuaLFPgYs1cb1PJC6itUzCrwQ2mCe4bcr9EPEkdOmcsUa+Jo8B1J5wiF8s9J0/DpGQNCt9ogkbladKwwZ/DNnNMtpGfdizlMzkKjAXPQDyxMwUCZqpkMOjYBrBpNADnGDESZDxZ5w4L3uQec5A7chTYCecAPiupBzDHkr0OWHQIKBotwqCzidGI17kTSKlhzFJOyFFgvgSBQXRrhuGr4QUnCFhyzOIbMDLinZTH18y523UTsJmBdS7ARiCQjEcg2fTjBdfrzc6foqCsemwtUUbqvI43jG2lxHMyMACW6MLK7K56Lrjm46qXZNGnkE+LB5AvHjlHudtBvF3MUqcn5eGgybd88aI+AP4KlbMaSF0ERwj2ocZKlxs5k8OXeA6KzkGirICcfwI3ChvEKm6Q/bHkbLbbtXLKUQRPKx+joCGPorGttKXzxTutWrZ41mnxGrdjDcC1LTdvOZcddbndg2DZ5fZoJANbqcuNGtygWttMdvTLtxsE+1uFXp9vafO7LV0ZTE3o/S9NqBqXwLDQ+QeSC23IVG1zDtVFYLD0s0Yf+ALgk0cL+F8wLCL+Ubo18agFqdT+oDeZo/7RL53EzsGUxnvpZtoqzDm9WO6o49JXKaMIpjRCPk1v/1Me6sUc0rZZcE5/BaXtpAQGd4Bozul5BbEDAwoqB6GcrOLcLFesZOw99Yjl7Ql7oeIUXjynBP4h/djT5m+nuF33PcPucwAAAABJRU5ErkJggg==);background-position:top left;background-repeat:no-repeat;background-size:contain;display:inline-block;height:31px;width:88px}.site-footer h2{font-size:24px;font-weight:bold;line-height:30px;margin-bottom:10px}.site-footer ul{list-style:none;margin:0 0 20px 0;padding:0}.site-footer .license{color:#777;font-size:13px}
        
        </style>
    </head>
    <body>
        <header class="site-header">
            <h1><a href="/">PHP <em>The Right Way</em></a></h1>
            <div class="build-date">最后更新于: 2019-04-01 17:18:57 +0800 由 <a href="https://blog.oyifan.com/" target="_blank" >Leo Yi</a>个人维护</div>
            <a class="fork-me" href="https://github.com/leo-yi/php-the-right-way" target="_blank"></a>
        </header>

        <nav class="site-navigation">
            <input type="checkbox" id="toggle"/>
            <label for="toggle">Table of Contents</label>
            <ul>
                <li><a href="/php-the-right-way#welcome">欢迎阅读</a>
                    <ul>
                        <li><a href="/php-the-right-way#translations">其他语言版本</a></li>
                        <li><a href="/php-the-right-way#how-to-contribute">参与贡献</a></li>
                        <li><a href="/php-the-right-way#spread-the-word">分享与推广</a></li>
                    </ul>
                </li>
                
                
                    
                        
                    
                    <li><a href="/php-the-right-way/#getting_started">入门指南</a>
                    
                        <ul>
                        
                    
                    
                
                    
                    <li><a href="/php-the-right-way/#use_the_current_stable_version">使用当前稳定版本 (7.2)</a>
                    
                        </li>
                    
                    
                
                    
                    <li><a href="/php-the-right-way/#builtin_web_server">内置的 Web 服务器</a>
                    
                        </li>
                    
                    
                
                    
                    <li><a href="/php-the-right-way/#mac_setup">Mac 安裝</a>
                    
                        </li>
                    
                    
                
                    
                    <li><a href="/php-the-right-way/#windows_setup">Windows 安裝</a>
                    
                        </li>
                    
                    
                
                    
                    <li><a href="/php-the-right-way/#common_directory_structure">常见目录结构</a>
                    
                        </li>
                    
                    
                
                    
                        
                            </ul>
                            </li>
                            
                        
                    
                    <li><a href="/php-the-right-way/#code_style_guide">代码风格指南</a>
                    
                        <ul>
                        
                    
                    
                
                    
                        
                            </ul>
                            </li>
                            
                        
                    
                    <li><a href="/php-the-right-way/#language_highlights">语言亮点</a>
                    
                        <ul>
                        
                    
                    
                
                    
                    <li><a href="/php-the-right-way/#programming_paradigms">编程范式</a>
                    
                        </li>
                    
                    
                
                    
                    <li><a href="/php-the-right-way/#namespaces">命名空间</a>
                    
                        </li>
                    
                    
                
                    
                    <li><a href="/php-the-right-way/#standard_php_library">PHP 标准库</a>
                    
                        </li>
                    
                    
                
                    
                    <li><a href="/php-the-right-way/#command_line_interface">命令行接口</a>
                    
                        </li>
                    
                    
                
                    
                    <li><a href="/php-the-right-way/#xdebug">Xdebug 调试工具</a>
                    
                        </li>
                    
                    
                
                    
                        
                            </ul>
                            </li>
                            
                        
                    
                    <li><a href="/php-the-right-way/#dependency_management">依赖管理</a>
                    
                        <ul>
                        
                    
                    
                
                    
                    <li><a href="/php-the-right-way/#composer_and_packagist">Composer 与 Packagist</a>
                    
                        </li>
                    
                    
                
                    
                    <li><a href="/php-the-right-way/#pear">PEAR</a>
                    
                        </li>
                    
                    
                
                    
                        
                            </ul>
                            </li>
                            
                        
                    
                    <li><a href="/php-the-right-way/#coding_practices">开发实践</a>
                    
                        <ul>
                        
                    
                    
                
                    
                    <li><a href="/php-the-right-way/#the_basics">基础知识</a>
                    
                        </li>
                    
                    
                
                    
                    <li><a href="/php-the-right-way/#date_and_time">日期和时间</a>
                    
                        </li>
                    
                    
                
                    
                    <li><a href="/php-the-right-way/#design_patterns">设计模式</a>
                    
                        </li>
                    
                    
                
                    
                    <li><a href="/php-the-right-way/#php_and_utf8">使用 UTF-8 编码</a>
                    
                        </li>
                    
                    
                
                    
                    <li><a href="/php-the-right-way/#i18n_l10n">国际化和本地化</a>
                    
                        </li>
                    
                    
                
                    
                        
                            </ul>
                            </li>
                            
                        
                    
                    <li><a href="/php-the-right-way/#dependency_injection">依赖注入</a>
                    
                        <ul>
                        
                    
                    
                
                    
                    <li><a href="/php-the-right-way/#basic_concept">基本概念</a>
                    
                        </li>
                    
                    
                
                    
                    <li><a href="/php-the-right-way/#complex_problem">复杂的问题</a>
                    
                        </li>
                    
                    
                
                    
                    <li><a href="/php-the-right-way/#containers">容器</a>
                    
                        </li>
                    
                    
                
                    
                    <li><a href="/php-the-right-way/#further_reading">延伸阅读</a>
                    
                        </li>
                    
                    
                
                    
                        
                            </ul>
                            </li>
                            
                        
                    
                    <li><a href="/php-the-right-way/#databases">数据库</a>
                    
                        <ul>
                        
                    
                    
                
                    
                    <li><a href="/php-the-right-way/#mysql_extension">MySQL 扩展</a>
                    
                        </li>
                    
                    
                
                    
                    <li><a href="/php-the-right-way/#pdo_extension">PDO 扩展</a>
                    
                        </li>
                    
                    
                
                    
                    <li><a href="/php-the-right-way/#databases_interacting">数据库交互</a>
                    
                        </li>
                    
                    
                
                    
                    <li><a href="/php-the-right-way/#databases_abstraction_layers">数据库抽象层</a>
                    
                        </li>
                    
                    
                
                    
                        
                            </ul>
                            </li>
                            
                        
                    
                    <li><a href="/php-the-right-way/#templating">使用模板</a>
                    
                        <ul>
                        
                    
                    
                
                    
                    <li><a href="/php-the-right-way/#templating_benefits">好处</a>
                    
                        </li>
                    
                    
                
                    
                    <li><a href="/php-the-right-way/#plain_php_templates">原生 PHP 模板</a>
                    
                        </li>
                    
                    
                
                    
                    <li><a href="/php-the-right-way/#compiled_templates">编译模板</a>
                    
                        </li>
                    
                    
                
                    
                    <li><a href="/php-the-right-way/#templating_further_reading">延伸阅读</a>
                    
                        </li>
                    
                    
                
                    
                        
                            </ul>
                            </li>
                            
                        
                    
                    <li><a href="/php-the-right-way/#errors_and_exceptions">错误与异常</a>
                    
                        <ul>
                        
                    
                    
                
                    
                    <li><a href="/php-the-right-way/#errors">错误</a>
                    
                        </li>
                    
                    
                
                    
                    <li><a href="/php-the-right-way/#exceptions">异常</a>
                    
                        </li>
                    
                    
                
                    
                        
                            </ul>
                            </li>
                            
                        
                    
                    <li><a href="/php-the-right-way/#security">安全</a>
                    
                        <ul>
                        
                    
                    
                
                    
                    <li><a href="/php-the-right-way/#web_application_security">Web 应用程序安全</a>
                    
                        </li>
                    
                    
                
                    
                    <li><a href="/php-the-right-way/#password_hashing">密码哈希</a>
                    
                        </li>
                    
                    
                
                    
                    <li><a href="/php-the-right-way/#data_filtering">数据过滤</a>
                    
                        </li>
                    
                    
                
                    
                    <li><a href="/php-the-right-way/#configuration_files">配置文件</a>
                    
                        </li>
                    
                    
                
                    
                    <li><a href="/php-the-right-way/#register_globals">注册全局变量</a>
                    
                        </li>
                    
                    
                
                    
                    <li><a href="/php-the-right-way/#error_reporting">错误报告</a>
                    
                        </li>
                    
                    
                
                    
                        
                            </ul>
                            </li>
                            
                        
                    
                    <li><a href="/php-the-right-way/#testing">测试</a>
                    
                        <ul>
                        
                    
                    
                
                    
                    <li><a href="/php-the-right-way/#test_driven_development">测试驱动开发</a>
                    
                        </li>
                    
                    
                
                    
                    <li><a href="/php-the-right-way/#behavior_driven_development">行为驱动开发</a>
                    
                        </li>
                    
                    
                
                    
                    <li><a href="/php-the-right-way/#complementary_testing_tools">共享服务器</a>
                    
                        </li>
                    
                    
                
                    
                        
                            </ul>
                            </li>
                            
                        
                    
                    <li><a href="/php-the-right-way/#servers_and_deployment">服务器与部署</a>
                    
                        <ul>
                        
                    
                    
                
                    
                    <li><a href="/php-the-right-way/#platform_as_a_service">平台即服务 (PaaS)</a>
                    
                        </li>
                    
                    
                
                    
                    <li><a href="/php-the-right-way/#virtual_or_dedicated_servers">虚拟或专用服务器</a>
                    
                        </li>
                    
                    
                
                    
                    <li><a href="/php-the-right-way/#shared_servers">共享服务器</a>
                    
                        </li>
                    
                    
                
                    
                    <li><a href="/php-the-right-way/#building_and_deploying_your_application">Building Your Application</a>
                    
                        </li>
                    
                    
                
                    
                        
                            </ul>
                            </li>
                            
                        
                    
                    <li><a href="/php-the-right-way/#virtualization">虚拟化</a>
                    
                        <ul>
                        
                    
                    
                
                    
                    <li><a href="/php-the-right-way/#vagrant">Vagrant</a>
                    
                        </li>
                    
                    
                
                    
                    <li><a href="/php-the-right-way/#docker">Docker</a>
                    
                        </li>
                    
                    
                
                    
                        
                            </ul>
                            </li>
                            
                        
                    
                    <li><a href="/php-the-right-way/#caching">缓存</a>
                    
                        <ul>
                        
                    
                    
                
                    
                    <li><a href="/php-the-right-way/#opcode_cache">Opcode 缓存</a>
                    
                        </li>
                    
                    
                
                    
                    <li><a href="/php-the-right-way/#object_caching">对象缓存</a>
                    
                        </li>
                    
                    
                
                    
                        
                            </ul>
                            </li>
                            
                        
                    
                    <li><a href="/php-the-right-way/#documenting">代码注释</a>
                    
                        <ul>
                        
                    
                    
                
                    
                    <li><a href="/php-the-right-way/#phpdoc">PHPDoc</a>
                    
                        </li>
                    
                    
                
                    
                        
                            </ul>
                            </li>
                            
                        
                    
                    <li><a href="/php-the-right-way/#resources">资源</a>
                    
                        <ul>
                        
                    
                    
                
                    
                    <li><a href="/php-the-right-way/#from_the_source">PHP 官方</a>
                    
                        </li>
                    
                    
                
                    
                    <li><a href="/php-the-right-way/#people_to_follow">值得关注的大牛</a>
                    
                        </li>
                    
                    
                
                    
                    <li><a href="/php-the-right-way/#mentoring">指导</a>
                    
                        </li>
                    
                    
                
                    
                    <li><a href="/php-the-right-way/#php_paas_providers">PHP Paas 提供商</a>
                    
                        </li>
                    
                    
                
                    
                    <li><a href="/php-the-right-way/#frameworks">框架</a>
                    
                        </li>
                    
                    
                
                    
                    <li><a href="/php-the-right-way/#components">组件</a>
                    
                        </li>
                    
                    
                
                    
                    <li><a href="/php-the-right-way/#other_resources">其他有用的资源</a>
                    
                        </li>
                    
                    
                
                    
                    <li><a href="/php-the-right-way/#videos">视频教程</a>
                    
                        </li>
                    
                    
                
                    
                    <li><a href="/php-the-right-way/#books">书籍</a>
                    
                        </li>
                    
                    
                
                    
                        
                            </ul>
                            </li>
                            
                        
                    
                    <li><a href="/php-the-right-way/#community">社区</a>
                    
                        <ul>
                        
                    
                    
                
                    
                    <li><a href="/php-the-right-way/#user_groups">用户群</a>
                    
                        </li>
                    
                    
                
                    
                    <li><a href="/php-the-right-way/#conferences">PHP 大会</a>
                    
                        </li>
                    
                    
                
                    
                    <li><a href="/php-the-right-way/#elephpants">Elephpants</a>
                    
                        </li>
                    
                    
                
                    </ul>
                </li>
                <li><a href="/php-the-right-way/#credits">荣誉</a></li>
            </ul>
        </nav>

        <div class="site-content chapters">
            
<section class="chapter" id="welcome">
    <h1 id="section">欢迎</h1>

<p>目前网络上充斥着大量的过时资讯，让 PHP 新手误入歧途，并且传播着错误的实践以及不安全的代码。<em>PHP 之道</em> 收集了现有的 PHP 最佳实践、编码规范和权威学习指南，方便 PHP 开发者阅读和查找。</p>

<p><em>使用 PHP 沒有规范化的方式</em>。本网站主要是向 PHP 新手介绍一些他们没有发现或者是太晚发现的主题， 或是经验丰富的专业人士已经实践已久的做法提供一些新想法。本网站也不会告诉您应该使用什么样的工具，而是提供多种选择的建议，并尽可能地说明方法及用法上的差异。</p>

<p>当有更多有用的资讯以及范例时，此文件会随着相关技术的发展而持续更新。</p>

<h2 id="translations">其他翻译</h2>

<p><em>PHP: The Right Way</em> 被翻译为以下版本：</p>

<ul>
  <li><a href="http://www.phptherightway.com">English</a></li>
  <li><a href="http://rwetzlmayr.github.io/php-the-right-way">Deutsch</a></li>
  <li><a href="http://phpdevenezuela.github.io/php-the-right-way">Español</a></li>
  <li><a href="http://eilgin.github.io/php-the-right-way/">Français</a></li>
  <li><a href="http://id.phptherightway.com">Indonesia</a></li>
  <li><a href="http://it.phptherightway.com">Italiano</a></li>
  <li><a href="http://pl.phptherightway.com">Polski</a></li>
  <li><a href="http://br.phptherightway.com">Português do Brasil</a></li>
  <li><a href="https://bgui.github.io/php-the-right-way/">Română</a></li>
  <li><a href="http://sl.phptherightway.com">Slovenščina</a></li>
  <li><a href="http://phpsrbija.github.io/php-the-right-way/">Srpski</a></li>
  <li><a href="http://hkulekci.github.io/php-the-right-way/">Türkçe</a></li>
  <li><a href="http://bg.phptherightway.com">български</a></li>
  <li><a href="http://getjump.github.io/ru-php-the-right-way">Русский язык</a></li>
  <li><a href="http://iflista.github.com/php-the-right-way">Українська</a></li>
  <li><a href="https://adaroobi.github.io/php-the-right-way/">العربية</a></li>
  <li><a href="http://novid.github.io/php-the-right-way/">فارسى</a></li>
  <li><a href="https://apzentral.github.io/php-the-right-way/">ภาษาไทย</a></li>
  <li><a href="http://modernpug.github.io/php-the-right-way">한국어판</a></li>
  <li><a href="http://ja.phptherightway.com">日本語</a></li>
  <li><a href="https://laravel-china.github.io/php-the-right-way/">简体中文</a></li>
  <li><a href="http://laravel-taiwan.github.io/php-the-right-way">繁體中文</a></li>
</ul>

<h2 id="section-1">书本</h2>

<p>最新版本的 <em>PHP 之道</em> 包含  PDF, EPUB 和 MOBI 版本，可以在 <a href="https://leanpub.com/phptherightway">Leanpub</a> 上购买。</p>

<h2 id="how-to-contribute">如何参与</h2>

<p>帮助我们让本网站作为 PHP 新手的最佳资源！<a href="https://github.com/codeguy/php-the-right-way/tree/gh-pages">在 GitHub 上贡献</a></p>


</section>



<div class="back-to-top"><p><a href="#top" class="top">回到顶部</a></p>
</div>
<section class="chapter" id="getting_started">
    <h1 id="getting_started_title">入门指南</h1>


</section>


<section class="chapter" id="use_the_current_stable_version">
    <h2 id="use_the_current_stable_version_title">使用当前稳定版本 (7.2)</h2>

<p>如果你刚开始学习 PHP，请使用最新的稳定版本 <a href="http://php.net/downloads.php">PHP 7.2</a>。PHP 7.x 非常新，相较于 5.x 版本增加了强大的 <a href="#language_highlights">新特性</a>。PHP 引擎大部分被重写，PHP 的运行速度已经远远超越过去。</p>

<p>在很长的一段时间内，你会发现 5.x 还在广泛的被使用，目前最新的 5.x 版本是 5.6。对于当下，这并不是一个坏选项。然而，你应该尽快升级 - PHP 5.6 <a href="http://php.net/supported-versions.php">将会在 2018 停止安全更新</a>。7.1 做了 <a href="http://php.net/manual/migration71.incompatible.php">向下兼容</a> 处理，所以你的升级应该不会很难。. 如果你想查找一个函数及其用法，可以去官方手册 <a href="http://php.net/manual/">php.net</a> 中查找。</p>


</section>


<section class="chapter" id="builtin_web_server">
    <h2 id="builtin_web_server_title">内置的 web 服务器</h2>

<p>PHP 5.4 之后, 你可以不用安装和配置功能齐全的 Web 服务器，就可以开始学习 PHP。
要启动内置的 Web 服务器，需要从你的命令行终端进入项目的 Web 根目录，执行下面的命令:</p>

<div class="highlight"><pre><code class="language-console" data-lang="console"><span class="gp">&gt;</span> php <span class="nt">-S</span> localhost:8000</code></pre></div>

<ul>
  <li><a href="http://php.net/features.commandline.webserver">了解更多内置的命令行服务器</a></li>
</ul>


</section>


<section class="chapter" id="mac_setup">
    <h2 id="mac_setup_title">Mac 安装</h2>

<p>macOS 系统会预装 PHP， 只是一般情况下版本会比最新稳定版低一些。</p>

<p>以下介绍几种在 macOS 上安装最新版本 PHP 的方法。</p>

<h3 id="homebrew--php">通过 Homebrew 安装 PHP</h3>

<p><a href="http://brew.sh/">Homebrew</a> 是一个强大的 macOS 专用包管理器， 它可以帮助你轻松的安装 PHP 和各种扩展。
<a href="https://github.com/Homebrew/homebrew-php#installation">Homebrew PHP</a> 是一个包含与 PHP 相关的 Formulae，能让你通过 homebrew 安装 PHP 的仓库。</p>

<p>也就是说, 你可以通过 <code>brew install</code> 命令安装 <code>php56</code>、<code>php70</code>、<code>php71</code>或者 <code>php72</code>，并且通过修改 <code>PATH</code> 变量来切换各个版本。或者你也可以使用 <a href="https://github.com/philcook/brew-php-switcher">brew-php-switcher</a> 来自动切换。</p>

<h3 id="install-php-via-macports">Install PHP via Macports</h3>
<p>### 通过 Macports 安装 PHP</p>

<p><a href="https://www.macports.org/install.php">MacPorts</a> 是一个开源的，社区发起的项目，它的目的在于设计一个易于使用的系统，方便编译，安装以及升级 macOS 系统上的 command-line, X11 或者基于 Aqua 的开源软件。</p>

<p>MacPorts 支持预编译的二进制文件，因此你不必每次都重新从源码压缩包编译，如果你的系统没有安装这些包，它会节省你很多时间。</p>

<p>此时，你可以通过 <code>port install</code> 命名来安装 <code>php56</code>、<code>php70</code>、<code>php71</code>或者 <code>php72</code>，比如：</p>

<pre><code>sudo port install php56
sudo port install php71
</code></pre>

<p>你也可以执行 <code>select</code> 命令来切换当前的 php 版本：</p>

<pre><code>sudo port select --set php php71
</code></pre>

<h3 id="phpbrew--php">通过 phpbrew 安装 PHP</h3>

<p><a href="https://github.com/phpbrew/phpbrew">phpbrew</a> 是一个安装与管理多个 PHP 版本的工具。它在应用程序或者项目需要不同版本的 PHP 时非常有用，让你不再需要使用虚拟机来处理这些情况。</p>

<h3 id="liips-binary-installer--php">通过 Liip’s binary installer 安装 PHP</h3>
<p><a href="http://php-osx.liip.ch/">php-osx.liip.ch</a> 是另一种流行的选择，它提供了从 5.3 到 7.1 版本的单行安装功能。
它并不会覆盖Apple集成的PHP文件，而是将其安装在了一个独立的目录中(/usr/local/php5)。</p>

<h3 id="section">源码编译</h3>

<p>另一个让你控制安装 PHP 版本的选择就是 <a href="http://php.net/install.macosx.compile">自行编译</a>。
如果使用这种方法， 你必须先确认是否已经通过 「Apple’s Mac Developer Center」 下载、安装 <a href="https://github.com/kennethreitz/osx-gcc-installer">Xcode</a> 或者 <a href="https://developer.apple.com/downloads">“Command Line Tools for XCode”</a>。</p>

<h3 id="all-in-one-installers">集成包 (All-in-One Installers)</h3>

<p>上面列出的解决方案主要是针对 PHP 本身， 并不包含：比如 Apache，Nginx 或者 SQL 服务器。
集成包比如 <a href="http://www.mamp.info/en/downloads/">MAMP</a> 和 <a href="http://www.apachefriends.org/en/xampp.html">XAMPP</a> 会安装这些软件并且将他们绑在一起，不过易于安装的背后也牺牲了一定的弹性。</p>


</section>


<section class="chapter" id="windows_setup">
    <h2 id="windows_setup_title">Windows 安装</h2>

<p>你可以从 <a href="http://windows.php.net/download/">windows.php.net/download</a> 下载二进制包。 解压后, 最好为你的 PHP 所在的根目录（php.exe 所在的文件夹）设置 <a href="http://www.windows-commandline.com/set-path-command-line/">PATH</a>，这样就可以从命令行中直接执行 PHP。</p>

<p>如果只是学习或者本地开发，可以直接使用 PHP 5.4+ 内置的 Web 服务器， 还能省去配置服务器的麻烦。如果你想要包含有网页服务器以及 MySql 的集成包，那么像是<a href="https://www.microsoft.com/web/downloads/platform.aspx">Web Platform Installer</a>, <a href="http://www.apachefriends.org/en/xampp.html">XAMPP</a>, <a href="http://www.easyphp.org/">EasyPHP</a> 和 <a href="http://www.wampserver.com/en/">WAMP</a> 这类工具将会帮助你快速建立 Windows 开发环境。不过这些工具将会与线上环境有些许差别，如果你是在 Windows 下开发，而生产环境则部署至 Linux ，请小心。</p>

<p>如果你需要将生产环境部署在 Windows 上，那 IIS7 将会提供最稳定和最佳的性能。你可以使用 <a href="http://phpmanager.codeplex.com/">phpmanager</a> (IIS7 的图形化插件) 让你简单的设置并管理 PHP。IIS7 也有内置的 FastCGI ，你只需要将 PHP 配置为它的处理器即可。更多详情请见<a href="http://php.iis.net/">dedicated area on iis.net</a>。</p>

<p>一般情况下，使用不同环境开发，会导致你在上线代码时出现 Bug。如果你在 Window 下开发将会用于 Linux 下运行的代码，请应该考虑使用 <a href="/#virtualization_title">虚拟机</a>.</p>

<p>这里推荐 Chris Tankersley 的一篇关于 Window 下工具使用的文章 - <a href="http://ctankersley.com/2016/11/13/developing-on-windows-2016/">Windows 下的 PHP 开发</a>.</p>


</section>


<section class="chapter" id="common_directory_structure">
    <h2 id="common_directory_structure">常见目录结构</h2>

<p>对于那些刚开始为web编写程序的人来说，一个常见的问题是:“我应该把我的文件放在哪里?” 多年来，这个答案一直是“DocumentRoot 指向的目录”。虽然这个答案还不完整，但这是一个很好的开始。</p>

<p>出于安全原因，配置文件不应该被人访问到; 因此，公共脚本保存在公共目录中，私有配置和数据保存在该目录之外。</p>

<p>对于 每个团队、CMS或框架，这些都有目录结构标准。但是，如果个人开发一个项目，那么使用哪种文件结构都是一件令人烦恼的事。</p>

<p><a href="https://twitter.com/pmjones">Paul M. Jones</a> 对 github上成千上万的 PHP 项目中进行了研究。根据研究结果，他编写了一套标准文件和目录结构的标准，即 <a href="https://github.com/php-pds/skeleton">Standard PHP Package Skeleton</a>。在这个目录结构中，<code>DocumentRoot</code> 应该指向 <code>public/</code>，单元测试应该在 <code>tests/</code>目录中，而 <code>composer</code> 安装的第三方包应该在 <code>vender/</code> 目录。遵循标准的PHP包和框架目录标准对项目的发展是非常有意义的。</p>


</section>

<div class="back-to-top"><p><a href="#top" class="top">回到顶部</a></p>
</div>
<section class="chapter" id="code_style_guide">
    <h1 id="code_style_guide_title">代码风格指南</h1>

<p>PHP 社区百花齐放，拥有大量的函数库、框架和组件。PHP 开发者通常会在自己的项目中使用若干个外部库，因此 PHP 代码遵循（尽可能接近）同一个代码风格就非常重要，这让开发者可以轻松地将多个代码库整合到自己的项目中。</p>

<p><a href="https://www.php-fig.org/">PHP标准组</a> 提出并发布了一系列的风格建议。其中有部分是关于代码风格的，即 <a href="https://www.php-fig.org/psr/psr-1/">PSR-1</a>, <a href="https://www.php-fig.org/psr/psr-2/">PSR-2</a> 和 <a href="https://www.php-fig.org/psr/psr-4/">PSR-4</a>。这些推荐只是一些被其他项目所遵循的规则，如 Drupal, Zend, Symfony, CakePHP, phpBB, AWS SDK, FuelPHP, Lithium 等。你可以把这些规则用在自己的项目中，或者继续使用自己的风格。</p>

<p>通常情况下，你应该遵循一个已知的标准来编写 PHP 代码。可能是 PSR 的组合或者是 PEAR 或 Zend 编码准则中的一个。这代表其他开发者能够方便的阅读和使用你的代码，并且使用这些组件的应用程序可以和其他第三方的组件保持一致。</p>

<ul>
  <li><a href="https://www.php-fig.org/psr/psr-1/">阅读 PSR-1</a></li>
  <li><a href="https://www.php-fig.org/psr/psr-2/">阅读 PSR-2</a></li>
  <li><a href="https://www.php-fig.org/psr/psr-4/">阅读 PSR-4</a></li>
  <li><a href="https://pear.php.net/manual/en/standards.php">阅读 PEAR 编码准则</a></li>
  <li><a href="https://symfony.com/doc/current/contributing/code/standards.html">阅读 Symfony 编码准则</a></li>
</ul>

<p>你可以使用 <a href="https://pear.php.net/package/PHP_CodeSniffer/">PHP_CodeSniffer</a> 来检查代码是否符合这些准则，文本编辑器 <a href="https://github.com/benmatselby/sublime-phpcs">Sublime Text</a> 的插件也可以提供实时检查。</p>

<p>你可以通过任意以下两个工具来自动修正你的程序语法，让它符合标准：</p>

<ul>
  <li>一个是 <a href="https://cs.sensiolabs.org/">PHP Coding Standards Fixer</a>，它具有良好的测试。</li>
  <li>另一个是随 PHP_CodeSniffer 安装的 <a href="https://github.com/squizlabs/PHP_CodeSniffer/wiki/Fixing-Errors-Automatically">PHP Code 美化修整器</a>。</li>
</ul>

<p>你也可以手动运行 phpcs 命令：</p>

<pre><code>phpcs -sw --standard=PSR2 file.php
</code></pre>

<p>它会显示出相应的错误以及如何修正的方法。同时，这条命令你也可以用在 git hook 中，如果你的分支代码不符合选择的代码标准则无法提交。</p>

<p>如果你已经安装了 PHP_CodeSniffer，你将可以使用
<a href="https://github.com/squizlabs/PHP_CodeSniffer/wiki/Fixing-Errors-Automatically">PHP Code 美化修整器</a> 来格式化代码：</p>

<pre><code>phpcbf -w --standard=PSR2 file.php
</code></pre>

<p>另一个选项是使用 <a href="https://cs.sensiolabs.org/">PHP 编码标准修复器</a>，他可以让你预览编码不合格的部分：</p>

<pre><code>php-cs-fixer fix -v --level=psr2 file.php
</code></pre>

<p>所有的变量名称以及代码结构建议用英文编写。注释可以使用任何语言，只要让现在以及未来的小伙伴能够容易阅读理解即可。</p>

<p>最后，补充一个简洁PHP的资源 <a href="https://github.com/jupeter/clean-code-php">Clean Code PHP</a>.</p>


</section>

<div class="back-to-top"><p><a href="#top" class="top">回到顶部</a></p>
</div>
<section class="chapter" id="language_highlights">
    <h1 id="language_highlights_title">语言亮点</h1>

</section>


<section class="chapter" id="programming_paradigms">
    <h2 id="programming_paradigms_title">编程范式</h2>

<p>PHP 是一个灵活的动态语言，支持多种编程技巧。这几年一直不断的发展，重要的里程碑包含 PHP 5.0 (2004) 增加了完善的面向对象模型，PHP 5.3 (2009) 增加了匿名函数与命名空间以及 PHP 5.4 (2012) 增加的 traits。</p>

<h3 id="section">面向对象编程</h3>

<p>PHP 拥有完整的面向对象编程的特性，包括类，抽象类，接口，继承，构造函数，克隆和异常等。</p>

<ul>
  <li><a href="https://secure.php.net/language.oop5">阅读 PHP 面向对象编程</a></li>
  <li><a href="https://secure.php.net/language.oop5.traits">阅读 Traits</a></li>
</ul>

<h3 id="functional-programming">函数式编程 Functional Programming</h3>

<p>PHP 支持函数是「第一等公民」，即函数可以被赋值给一个变量，包括用户自定义的或者是内置函数，然后动态调用它。函数可以作为参数传递给其他函数（称为_高阶函数_），也可以作为函数返回值返回。</p>

<p>PHP 支持递归，也就是函数自己调用自己，但多数 PHP 代码使用迭代。</p>

<p>自从 PHP 5.3 (2009) 之后开始引入对闭包以及匿名函数的支持。</p>

<p>PHP 5.4 增加了将闭包绑定到对象作用域中的特性，并改善其可调用性，如此即可在大部分情况下使用匿名函数取代一般的函数。</p>

<ul>
  <li>学习更多 <a href="/php-the-right-way/pages/Functional-Programming.html">PHP 函数式编程</a></li>
  <li><a href="https://secure.php.net/functions.anonymous">阅读匿名函数</a></li>
  <li><a href="https://secure.php.net/class.closure">阅读闭包类</a></li>
  <li><a href="https://wiki.php.net/rfc/closures">更多关于 Closures RFC</a></li>
  <li><a href="https://secure.php.net/language.types.callable">阅读 Callables</a></li>
  <li><a href="https://secure.php.net/function.call-user-func-array">阅读动态调用函数 <code>call_user_func_array()</code></a></li>
</ul>

<h3 id="section-1">元编程</h3>

<p>PHP 通过反射 API 和魔术方法，可以实现多种方式的元编程。开发者通过魔术方法，如 <code>__get()</code>, <code>__set()</code>, <code>__clone()</code>, <code>__toString()</code>, <code>__invoke()</code>，等等，可以改变类的行为。Ruby 开发者常说 PHP 没有 <code>method_missing</code> 方法，实际上通过 <code>__call()</code> 和 <code>__callStatic()</code> 就可以完成相同的功能。</p>

<ul>
  <li><a href="https://secure.php.net/language.oop5.magic">阅读魔术方法</a></li>
  <li><a href="https://secure.php.net/intro.reflection">阅读反射</a></li>
  <li><a href="https://secure.php.net/language.oop5.overloading">阅读重载</a></li>
</ul>


</section>


<section class="chapter" id="namespaces">
    <h2 id="namespaces_title">命名空间</h2>

<p>如前所述，PHP 社区已经有许多开发者开发了大量的代码。这意味着一个类库的 PHP 代码可能使用了另外一个类库中相同的类名。如果他们使用同一个命名空间，那将会产生冲突导致异常。</p>

<p><em>命名空间</em> 解决了这个问题。如 PHP 手册里所描述，命名空间好比操作系统中的目录，两个同名的文件可以共存在不同的目录下。同理两个同名的 PHP 类可以在不同的 PHP 命名空间下共存，就这么简单。</p>

<p>因此把你的代码放在你的命名空间下就非常重要，避免其他开发者担心与第三方类库冲突。</p>

<p><a href="https://www.php-fig.org/psr/psr-4/">PSR-4</a> 提供了一种命名空间的推荐使用方式，它提供一个标准的文件、类和命名空间的使用惯例，进而让代码做到随插即用。</p>

<p>2014 年 10 月，PHP-FIG 废弃了上一个自动加载标准： <a href="https://www.php-fig.org/psr/psr-0/">PSR-0</a>，而采用新的自动加载标准 <a href="https://www.php-fig.org/psr/psr-4/">PSR-4</a>。但 PSR-4 要求 PHP 5.3 以上的版本，而许多项目都还是使用 PHP 5.2，所以目前两者都能使用。</p>

<p>如果你在新应用或扩展包中使用自动加载标准，应优先考虑使用 PSR-4。</p>

<ul>
  <li><a href="https://secure.php.net/language.namespaces">阅读命名空间</a></li>
  <li><a href="https://www.php-fig.org/psr/psr-0/">阅读 PSR-0</a></li>
  <li><a href="https://www.php-fig.org/psr/psr-4/">阅读 PSR-4</a></li>
</ul>


</section>


<section class="chapter" id="standard_php_library">
    <h2 id="standard_php_library_title">PHP 标准库</h2>

<p>PHP 标准库 (Standard PHP Library 简写为 SPL) 随着 PHP 一起发布，提供了一组类和接口。包含了常用的数据结构类 (堆栈，队列，堆等等)，以及遍历这些数据结构的迭代器，或者你可以自己实现 SPL 接口。</p>

<ul>
  <li><a href="https://secure.php.net/book.spl">阅读 SPL</a></li>
  <li><a href="https://www.lynda.com/PHP-tutorials/Up-Running-Standard-PHP-Library/175038-2.html">Lynda.com 上的 SPL 视频教程(付费)</a></li>
</ul>


</section>


<section class="chapter" id="command_line_interface">
    <h2 id="command_line_interface_title">命令行接口</h2>

<p>PHP 是为开发 Web 应用而创建，不过它的命令行脚本接口(CLI)也非常有用。PHP 命令行编程可以帮你完成自动化的任务，如测试，部署和应用管理。</p>

<p>CLI PHP 编程非常强大，可以直接调用你自己的程序代码而无需创建 Web 图形界面，需要注意的是 <strong>不要</strong> 把 CLI PHP 脚本放在公开的 web 目录下！</p>

<p>在命令行下运行 PHP :</p>

<div class="highlight"><pre><code class="language-console" data-lang="console"><span class="gp">&gt;</span> php <span class="nt">-i</span></code></pre></div>

<p>选项 <code>-i</code> 将会打印 PHP 配置，类似于 <a href="https://secure.php.net/function.phpinfo"><code>phpinfo()</code></a> 函数。</p>

<p>选项 <code>-a</code> 提供交互式 shell，和 Ruby 的 IRB 或 python 的交互式 shell 相似，此外还有很多其他有用的<a href="https://secure.php.net/features.commandline.options">命令行选项</a>。</p>

<p>接下来写一个简单的 “Hello, $name” CLI 程序，先创建名为 <code>hello.php</code> 的脚本：</p>

<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="k">if</span><span class="p">(</span><span class="nv">$argc</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="s2">"Usage: php hello.php [name].</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>
    <span class="k">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>
<span class="nv">$name</span> <span class="o">=</span> <span class="nv">$argv</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
<span class="k">echo</span> <span class="s2">"Hello, </span><span class="nv">$name</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span></code></pre></div>

<p>PHP 会在脚本运行时根据参数设置两个特殊的变量，<a href="https://secure.php.net/reserved.variables.argc"><code>$argc</code></a> 是一个整数，表示参数<em>个数</em>，<a href="https://secure.php.net/reserved.variables.argv"><code>$argv</code></a> 是一个数组变量，包含每个参数的<em>值</em>，
它的第一个元素一直是 PHP 脚本的名称，如本例中为 <code>hello.php</code>。</p>

<p>命令运行失败时，可以通过 <code>exit()</code> 表达式返回一个非 0 整数来通知 shell，常用的 exit 返回码可以查看<a href="https://www.gsp.com/cgi-bin/man.cgi?section=3&amp;topic=sysexits">列表</a>.</p>

<p>运行上面的脚本，在命令行输入：</p>

<div class="highlight"><pre><code class="language-console" data-lang="console"><span class="gp">&gt;</span> php hello.php
<span class="go">Usage: php hello.php [name]
</span><span class="gp">&gt;</span> php hello.php world
<span class="go">Hello, world</span></code></pre></div>

<ul>
  <li><a href="https://secure.php.net/features.commandline.options">学习如何在命令行运行 PHP</a></li>
</ul>


</section>


<section class="chapter" id="xdebug">
    <h2 id="xdebug_title">Xdebug</h2>

<p>合适的调试器是软件开发中最有用的工具之一，它使你可以跟踪程序执行结果并监视程序堆栈中的信息。Xdebug 是一个 php 的调试器，它可以被用来在很多 IDE(集成开发环境) 中做断点调试以及堆栈检查。它还可以像 PHPUnit 和 KCacheGrind 一样，做代码覆盖检查或者程序性能跟踪。</p>

<p>如果你仍在使用 <code>var_dump()</code>/<code>print_r()</code> 调错，经常会发现自己处于困境，并且仍然找不到解决办法。这时，你该使用调试器了。</p>

<p><a href="https://xdebug.org/docs/install">安装 Xdebug</a> 可能很费事，但其中一个最重要的「远程调试」特性 —— 如果你在本地开发，并在虚拟机或者其他服务器上测试，远程调试可能是你想要的一种方式。</p>

<p>通常，你需要修改你的 Apache VHost 或者 .htaccess 文件的这些值:</p>

<div class="highlight"><pre><code class="language-ini" data-lang="ini"><span class="err">php_value</span> <span class="py">xdebug.remote_host</span><span class="p">=</span><span class="s">192.168.?.?</span>
<span class="err">php_value</span> <span class="py">xdebug.remote_port</span><span class="p">=</span><span class="s">9000</span></code></pre></div>

<p>「remote host」 和 「remote port」 这两项对应和你本地开发机监听的地址和端口。然后将你的 IDE 设置成「listen for connections」模式，并访问网址：</p>

<pre><code>http://your-website.example.com/index.php?XDEBUG_SESSION_START=1
</code></pre>

<p>你的 IDE 将会拦截当前执行的脚本状态，运行你设置的断点并查看内存中的值。</p>

<p>图形化的调试器可以让你非常容易的逐步的查看代码、变量，以及运行时的 evel 代码。许多 IDE 已经内置或提供了插件支持 XDebug 图形化调试器。比如 MacGDBp 是 Mac 上的一个免费，开源的单机调试器。</p>

<ul>
  <li><a href="https://xdebug.org/docs/">学习更多 Xdebug</a></li>
  <li><a href="https://www.bluestatic.org/software/macgdbp/">学习更多 MacGDBp</a></li>
</ul>


</section>

<div class="back-to-top"><p><a href="#top" class="top">回到顶部</a></p>
</div>
<section class="chapter" id="dependency_management">
    <h1 id="dependency_management_title">依赖管理</h1>

<p>PHP 有很多可供使用的库、框架和组件。通常你的项目都会使用到其中的若干项 - 这些就是项目的依赖。直到最近，PHP 也没有一个很好的方式来管理这些项目依赖。即使你通过手动的方式去管理，你依然会为自动加载器而担心。但现在这已经不再是问题了。</p>

<p>目前 PHP 有两个使用较多的包管理系统 － <a href="/#composer_and_packagist">Composer</a> 和 <a href="/#pear">PEAR</a>。Composer 是 PHP 所使用的主要的包管理器，然而在很长的一段时间里，PEAR 曾经扮演着这个角色。你应该了解 PEAR 是什么，因为即使你从来没有使用过它，你依然有可能会碰到对它的引用。</p>


</section>


<section class="chapter" id="composer_and_packagist">
    <h2 id="composer_and_packagist_title">Composer 与 Packagist</h2>

<p>对于 PHP 来说，Composer 是一个推荐的依赖管理器。在 <code>composer.json</code> 文件中列出你项目所需的依赖包，加上一点简单的命令，Composer 将会自动帮你下载并设置你的项目依赖。Composer 有点类似于 Node.js 世界里的 NPM，或者 Ruby 世界里的 Bundler。</p>

<p>现在有非常多的 PHP 第三方包已兼容 Composer，随时可以在你的项目中使用。这些「packages(包)」都已列在 <a href="https://packagist.org/">Packagist</a>，这是一个官方的 Composer 兼容包仓库。</p>

<blockquote>
  <p>为了提高国内 Composer 的使用体验，可以使用 <a href="https://pkg.phpcomposer.com/">Composer 中文镜像 /Packagist 中国全量镜像</a> ，将会极大加速 Composer 依赖的下载速度。</p>
</blockquote>

<h3 id="composer">如何安装 Composer</h3>

<p>The safest way to download composer is by <a href="https://getcomposer.org/download/">following the official instructions</a>.
This will verify the installer is not corrupt or tampered with.
The installer installs a <code>composer.phar</code> binary in your <em>current working directory</em>.</p>

<p>最安全的下载方法就是使用 <a href="https://getcomposer.org/download/">官方的教程</a>。
此方法会验证安装器是否安全，是否被修改。</p>

<p>安装器会下载一个 <code>composer.phar</code> 的文件在你运行安装器的目录，也就是在你当前执行命令的文件夹。</p>

<p>我们推荐你 <em>全局</em> 安装，即把可执行文件复制到 <code>/usr/local/bin</code> 路径中：</p>

<div class="highlight"><pre><code class="language-console" data-lang="console"><span class="go">mv composer.phar /usr/local/bin/composer</span></code></pre></div>

<p><strong>注意:</strong> 以上命令如果失败，请尝试使用<code>sudo</code> 来增加权限。</p>

<p><em>本地</em> 使用 Composer 的话，你可以运行 <code>php composer.phar</code> ，全局的话是：<code>composer</code>。</p>

<h4 id="windows">Windows环境下安装</h4>

<p>对于Windows 的用户而言最简单的获取及执行方法就是使用 <a href="https://getcomposer.org/Composer-Setup.exe">ComposerSetup</a> 安装程序，它会执行一个全局安装并设置你的 <code>$PATH</code>，所以你在任意目录下在命令行中使用 <code>composer</code>。</p>

<h3 id="section">如何设置及安装依赖</h3>

<p>Composer 会通过一个 <code>composer.json</code> 文件持续的追踪你的项目依赖。 如果你喜欢，你可以手动管理这个文件，或是使用 Composer 自己管理。<code>composer require</code> 这个指令会增加一个项目依赖，如果你还没有 <code>composer.json</code> 文件, 将会创建一个。这里有个例子为你的项目加入 <a href="https://twig.symfony.com/">Twig</a> 依赖。</p>

<div class="highlight"><pre><code class="language-console" data-lang="console"><span class="go">composer require twig/twig:~2.0</span></code></pre></div>

<p>另外 <code>composer init</code> 命令将会引导你创建一个完整的 <code>composer.json</code> 文件到你的项目之中。无论你使用哪种方式，一旦你创建了 <code>composer.json</code> 文件，你可以告诉 Composer 去下载及安装你的依赖到 <code>vendor/</code> 目录中。这命令也适用于你已经下载并已经提供了一个 <code>composer.json</code> 的项目：</p>

<div class="highlight"><pre><code class="language-console" data-lang="console"><span class="go">composer install</span></code></pre></div>

<p>接下来，添加这一行到你应用的主要 PHP 文件中，这将会告诉 PHP 为你的项目依赖使用 Composer 的自动加载器。</p>

<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="k">require</span> <span class="s1">'vendor/autoload.php'</span><span class="p">;</span></code></pre></div>

<p>现在你可以使用你项目中的依赖，且它们会在需要时自动完成加载。</p>

<h3 id="section-1">更新你的依赖</h3>

<p>Composer 会建立一个 <code>composer.lock</code> 文件，在你第一次执行 <code>php composer install</code> 时，存放下载的每个依赖包精确的版本编号。假如你要分享你的项目给其他开发者，并且 <code>composer.lock</code> 文件也在你分享的文件之中的话。 当他们执行 <code>php composer.phar install</code> 这个命令时，他们将会得到与你一样的依赖版本。 当你要更新你的依赖时请执行 <code>php composer update</code>。请不要在部署代码的时候使用 <code>composer update</code>，只能使用 <code>composer install</code> 命令，否则你会发现你在生产环境中用的是不同的扩展包依赖版本。</p>

<p>当你需要灵活的定义你所需要的依赖版本时，这是最有用。 举例来说需要一个版本为 ~1.8 时，意味着 “任何大于 1.8.0 ，但小于 2.0.x-dev 的版本”。你也可以使用通配符 <code>*</code> 在 <code>1.8.*</code> 之中。现在Composer在<code>composer update</code> 时将升级你的所有依赖到你限制的最新版本。</p>

<h3 id="section-2">更新通知</h3>

<p>要接收关于新版本的更新通知。你可以注册 <a href="https://libraries.io/">libraries.io</a>，这个 web 服务可以监控你的 Github 及 BitBucket 帐号中的 <code>composer.json</code> 文件，并且当包有新更新时会发送邮件给你。</p>

<h3 id="section-3">检查你的依赖安全问题</h3>

<p><a href="https://security.sensiolabs.org/">Security Advisories Checker</a> 是一个 web 服务和一个命令行工具，二者都会仔细检查你的 <code>composer.lock</code> 文件，并且告诉你任何你需要更新的依赖。</p>

<h3 id="composer-">处理 Composer 全局依赖</h3>

<p>Composer 也可以处理全局依赖和他们的二进制文件。用法很直接，你所要做的就是在命令前加上<code>global</code>前缀。如果你想安装 PHPUnit 并使它全局可用，你可以运行下面的命令：</p>

<div class="highlight"><pre><code class="language-console" data-lang="console"><span class="go">composer global require phpunit/phpunit</span></code></pre></div>

<p>这将会创建一个 <code>~/.composer</code> 目录存放全局依赖，要让已安装依赖的二进制命令随处可用，你需要添加 <code>~/.composer/vendor/bin</code> 目录到你的 <code>$PATH</code> 变量。</p>

<ul>
  <li><a href="https://getcomposer.org/doc/00-intro.md">其他学习 Composer 相关资源</a></li>
</ul>


</section>


<section class="chapter" id="pear">
    <h2 id="pear_title">PEAR 介绍</h2>

<p><a href="https://pear.php.net/">PEAR</a> 是另一个常用的依赖包管理器, 它跟 Composer 很类似，但是也有一些显著的区别。</p>

<p>PEAR 需要扩展包有专属的结构, 开发者在开发扩展包的时候要提前考虑为 PEAR 定制, 否则后面将无法使用 PEAR.</p>

<p>PEAR 安装扩展包的时候, 是全局安装的, 意味着一旦安装了某个扩展包, 同一台服务器上的所有项目都能用上, 当然, 好处是当多个项目共同使用同一个扩展包的同一个版本, 坏处是如果你需要使用不同版本的话, 就会产生冲突.</p>

<h3 id="pear">如何安装 PEAR</h3>

<p>你可以通过下载 <code>.phar</code> 文件来安装 PEAR. <a href="https://pear.php.net/manual/installation.getting.php">官方文档安装部分</a> 里面有不同系统中安装 PEAR 的详细信息.</p>

<p>如果你是使用 Linux, 你可以尝试找下系统应用管理器, 举个栗子, Debian 和 Ubuntu 有个 <code>php-pear</code> 的 apt 安装包.</p>

<h3 id="section">如何安装扩展包</h3>

<p>如果扩展包是在 <a href="https://pear.php.net/packages.php">PEAR packages list</a> 这个列表里面的, 你可以使用以下命令安装:</p>

<div class="highlight"><pre><code class="language-console" data-lang="console"><span class="go">pear install foo</span></code></pre></div>

<p>如果扩展包是托管到别的渠道上, 你需要 <code>发现 (discover)</code> 渠道先, 请见文档 <a href="https://pear.php.net/manual/guide.users.commandline.channels.php">使用渠道</a>.</p>

<ul>
  <li><a href="https://pear.php.net/">关于 PEAR 的学习</a></li>
</ul>

<h3 id="composer--pear-">使用 Composer 来安装 PEAR 扩展包</h3>

<p>如果你正在使用 <a href="/#composer_and_packagist">Composer</a>, 并且你想使用一些 PEAR 的代码, 你可以通过 Composer 来安装 PEAR 扩展包.</p>

<p>下面是从 <code>pear2.php.net</code> 安装代码依赖的示例:</p>

<div class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span><span class="w">
    </span><span class="s2">"repositories"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"pear"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://pear2.php.net"</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="s2">"require"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"pear-pear2/PEAR2_Text_Markdown"</span><span class="p">:</span><span class="w"> </span><span class="s2">"*"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"pear-pear2/PEAR2_HTTP_Request"</span><span class="p">:</span><span class="w"> </span><span class="s2">"*"</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span></code></pre></div>

<p>第一部分 <code>"repositories"</code> 是让 Composer 从哪个渠道去获取扩展包, 然后, <code>"require"</code> 部分使用下面的命名规范:</p>

<blockquote>
  <p>pear-channel/Package</p>
</blockquote>

<p>前缀 “pear” 是为了避免冲突写死的，因为 <code>pear-channel</code> 有可能是任意扩展包名称，所以 <code>channel</code> 的简称（或者是完整 URL）可以用来指引扩展包在哪个 <code>channel</code> 里。</p>

<p>成功安装扩展包以后, 代码会放到项目的 <code>vendor</code> 文件夹中, 并且可以通过加载 Composer 的自动加载器进行加载:</p>

<blockquote>
  <p>vendor/pear-pear2.php.net/PEAR2_HTTP_Request/pear2/HTTP/Request.php</p>
</blockquote>

<p>在代码里面可以这样使用:</p>

<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="nv">$request</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">pear2\HTTP\Request</span><span class="p">();</span></code></pre></div>

<ul>
  <li><a href="http://getcomposer.org/doc/05-repositories.md#pear">学习更多 PEAR 和 Composer 的使用</a></li>
</ul>


</section>

<div class="back-to-top"><p><a href="#top" class="top">回到顶部</a></p>
</div>
<section class="chapter" id="coding_practices">
    <h1 id="coding_practices_title">开发实践</h1>

</section>


<section class="chapter" id="the_basics">
    <h2 id="the_basics_title">基础知识</h2>

<p>PHP 是一门庞大的语言，各个水平层次的开发者都可以利用它进行迅捷高效的开发。然而在对语言逐渐深入的学习过程中，我们往往会因为走捷径和/或不良习惯而忘记（或忽视掉）基础的知识。为了帮助彻底解决这个问题，这一章的目的就是提醒开发人员注意有关 PHP 的基础编程实践。</p>

<ul>
  <li>学习更多<a href="/pages/The-Basics.html">基础知识</a></li>
</ul>

</section>


<section class="chapter" id="date_and_time">
    <h2 id="date_and_time_title">日期和时间</h2>

<p>PHP 中 DateTime 类的作用是在你读、写、比较或者计算日期和时间时提供帮助。除了 DateTime 类之外，PHP 还有很多与日期和时间相关的函数，但 DateTime 类为大多数常规使用提供了优秀的面向对象接口。它还可以处理时区，不过这并不在这篇简短的介绍之内。</p>

<p>在使用 DateTime 之前，通过 <code>createFromFormat()</code> 工厂方法将原始的日期与时间字符串转换为对象或使用 <code>new DateTime</code> 来取得当前的日期和时间。使用 <code>format()</code> 将 DateTime 转换回字符串用于输出。</p>

<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="nv">$raw</span> <span class="o">=</span> <span class="s1">'22. 11. 1968'</span><span class="p">;</span>
<span class="nv">$start</span> <span class="o">=</span> <span class="nx">DateTime</span><span class="o">::</span><span class="na">createFromFormat</span><span class="p">(</span><span class="s1">'d. m. Y'</span><span class="p">,</span> <span class="nv">$raw</span><span class="p">);</span>

<span class="k">echo</span> <span class="s1">'Start date: '</span> <span class="o">.</span> <span class="nv">$start</span><span class="o">-&gt;</span><span class="na">format</span><span class="p">(</span><span class="s1">'Y-m-d'</span><span class="p">)</span> <span class="o">.</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span></code></pre></div>

<p>对 DateTime 进行计算时可以使用 DateInterval 类。DateTime 类具有例如 <code>add()</code> 和 <code>sub()</code> 等将 DateInterval 当作参数的方法。编写代码时注意不要认为每一天都是由相同的秒数构成的，不论是夏令时（DST）还是时区转换，使用时间戳计算都会遇到问题，应当选择日期间隔。使用 <code>diff()</code> 方法来计算日期之间的间隔，它会返回新的 DateInterval，非常容易进行展示。</p>

<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="c1">// create a copy of $start and add one month and 6 days</span>
<span class="nv">$end</span> <span class="o">=</span> <span class="k">clone</span> <span class="nv">$start</span><span class="p">;</span>
<span class="nv">$end</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="k">new</span> <span class="nx">DateInterval</span><span class="p">(</span><span class="s1">'P1M6D'</span><span class="p">));</span>

<span class="nv">$diff</span> <span class="o">=</span> <span class="nv">$end</span><span class="o">-&gt;</span><span class="na">diff</span><span class="p">(</span><span class="nv">$start</span><span class="p">);</span>
<span class="k">echo</span> <span class="s1">'Difference: '</span> <span class="o">.</span> <span class="nv">$diff</span><span class="o">-&gt;</span><span class="na">format</span><span class="p">(</span><span class="s1">'%m month, %d days (total: %a days)'</span><span class="p">)</span> <span class="o">.</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>
<span class="c1">// Difference: 1 month, 6 days (total: 37 days)</span></code></pre></div>

<p>DateTime 对象之间可以直接进行比较：</p>

<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$start</span> <span class="o">&lt;</span> <span class="nv">$end</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="s2">"Start is before end!</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>
<span class="p">}</span></code></pre></div>

<p>最后一个例子来演示 DatePeriod 类。它用来对循环的事件进行迭代。向它传入开始时间、结束时间和间隔区间，会得到这其中所有的事件。</p>

<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="c1">// output all thursdays between $start and $end</span>
<span class="nv">$periodInterval</span> <span class="o">=</span> <span class="nx">DateInterval</span><span class="o">::</span><span class="na">createFromDateString</span><span class="p">(</span><span class="s1">'first thursday'</span><span class="p">);</span>
<span class="nv">$periodIterator</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DatePeriod</span><span class="p">(</span><span class="nv">$start</span><span class="p">,</span> <span class="nv">$periodInterval</span><span class="p">,</span> <span class="nv">$end</span><span class="p">,</span> <span class="nx">DatePeriod</span><span class="o">::</span><span class="na">EXCLUDE_START_DATE</span><span class="p">);</span>
<span class="k">foreach</span> <span class="p">(</span><span class="nv">$periodIterator</span> <span class="k">as</span> <span class="nv">$date</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// output each date in the period</span>
    <span class="k">echo</span> <span class="nv">$date</span><span class="o">-&gt;</span><span class="na">format</span><span class="p">(</span><span class="s1">'Y-m-d'</span><span class="p">)</span> <span class="o">.</span> <span class="s1">' '</span><span class="p">;</span>
<span class="p">}</span></code></pre></div>

<p>一个有名的 API 扩展是 <a href="https://carbon.nesbot.com">Carbon</a>。Carbon 不仅继承了所有 DateTime 类提供的功能，还提供了更多的人性化功能，例如自然语言时间处理、国际化支持、对象之间执行增减算术。</p>

<ul>
  <li><a href="https://php.net/book.datetime">阅读 DateTime</a></li>
  <li><a href="https://php.net/function.date">阅读日期格式</a> (支持的日期字符串格式)</li>
</ul>


</section>


<section class="chapter" id="design_patterns">
    <h2 id="design_patterns_title">设计模式</h2>

<p>当你在编写自己的应用程序时，最好在项目的代码和整体架构中使用通用的设计模式，这将帮助你更轻松地对程序进行维护，也能够让其他的开发者更快地理解你的代码。</p>

<p>当你使用框架进行开发时，绝大部分的上层代码以及项目结构都会基于所使用的框架，因此很多关于设计模式的决定已经由框架帮你做好了。当然，你还是可以挑选你最喜欢的模式并在你的代码中进行应用。但如果你并没有使用框架的话，你就需要自己去寻找适合你的应用的最佳模式了。</p>

<p>学习更多设计模式：<a href="https://designpatternsphp.readthedocs.io/">https://designpatternsphp.readthedocs.io/</a></p>

</section>


<section class="chapter" id="php_and_utf8">
    <h2 id="php_and_utf8_title">使用 UTF-8 编码</h2>

<p><em>本章是由 <a href="https://alexcabal.com/">Alex Cabal</a> 最初撰写在 <a href="https://phpbestpractices.org/#utf-8">PHP Best Practices</a> 中的，我们使用它作为进行建议的基础</em>。</p>

<h3 id="section">这不是在开玩笑。请小心、仔细并且前后一致地处理它。</h3>

<p>目前，PHP 仍未在底层实现对 Unicode 的支持。虽然有很多途径可以确保 UTF-8 字符串能够被正确地处理，但这并不是很简单的事情，通常需要对 Web 应用进行全方面的检查，从 HTML 到 SQL 再到 PHP。我们将争取进行一个简洁实用的总结。</p>

<h3 id="php--utf-8">PHP 层面的 UTF-8</h3>

<p>最基本的字符串操作，像是连结两个字符串或将字符串赋值给变量，并不需要对 UTF-8 做特别的处理。然而大多数字符串的函数，像 <code>strpos()</code> 和 <code>strlen()</code>，确实需要特别的处理。这些函数名中通常包含 <code>mb_*</code>：比如，<code>mb_strpos()</code> 和 <code>mb_strlen()</code>。这些 <code>mb_*</code> 字符串是由 <a href="https://php.net/book.mbstring">Multibyte String Extension</a> 提供支持的，它专门为操作 Unicode 字符串而特别进行了设计。</p>

<p>在操作 Unicode 字符串时，请你务必使用 <code>mb_*</code> 函数。例如，如果你对一个 UTF-8 字符串使用 <code>substr()</code>，那返回的结果中有很大可能会包含一些乱码。正确的方式是使用 <code>mb_substr()</code>。</p>

<p>最难的地方在于每次都要记得使用 <code>mb_*</code> 函数。如果你哪怕只有一次忘记了使用，你的 Unicode 字符串就有在接下来的过程中变成乱码的风险。</p>

<p>不是所有的字符串函数都有一个对应的 <code>mb_*</code> 函数。如果你想要的功能没有对应的 <code>mb_*</code> 函数的话，那只能说你运气不佳了。</p>

<p>你应该在你所有的 PHP 脚本（或全局包含的脚本）的开头使用 <code>mb_internal_encoding()</code> 函数，然后紧接着在会对浏览器进行输出的脚本中使用 <code>mb_http_output()</code>。在每一个脚本当中明确声明字符串的编码可以免去很多日后的烦恼。</p>

<p>另外，许多对字符串进行操作的函数都有一个可选的参数用来指定字符串编码。当可以设定这类参数时，你应该始终明确指定使用 UTF-8。例如，<code>htmlentities()</code> 有一个字符编码的选项，你应该始终将其设为 UTF-8。从 PHP 5.4.0 开始, <code>htmlentities()</code> 和 <code>htmlspecialchars()</code> 的编码都已经被默认设为了 UTF-8。</p>

<p>最后，如果你所编写的是分布式的应用程序并且不能确定 <code>mbstring</code> 扩展一定开启的话，可以考虑使用 <a href="https://packagist.org/packages/patchwork/utf8">patchwork/utf8</a> Composer 包。它会在 <code>mbstring</code> 可用时自动使用，否则自动切换回非 UTF-8 函数。</p>

<h3 id="utf-8">数据库层面的 UTF-8</h3>

<p>如果你使用 PHP 来操作到 MySQL，有些时候即使你做到了上面的每一点，你的字符串仍可能面临在数据库中以非 UTF-8 的格式进行存储的问题。</p>

<p>为了确保你的字符串从 PHP 到 MySQL都使用 UTF-8，请检查确认你的数据库和数据表都设定为 <code>utf8mb4</code> 字符集和整理，并且确保你的 PDO 连接请求也使用了 <code>utf8mb4</code> 字符集。请看下方的示例代码，这是 <em>非常重要</em> 的。</p>

<p>请注意为了完整的 UTF-8 支持，你必须使用 <code>utf8mb4</code> 而不是  <code>utf8</code>！你会在进一步阅读中找到原因。</p>

<h3 id="utf-8-1">浏览器层面的 UTF-8</h3>

<p>使用 <code>mb_http_output()</code> 函数来确保 PHP 向浏览器输出 UTF-8 格式的字符串。</p>

<p>随后浏览器需要接收 HTTP 应答来指定页面是由 UTF-8 进行编码的。以前这一步是通过在页面 <code>&lt;head&gt;</code> 标签下包含<a href="https://htmlpurifier.org/docs/enduser-utf8.html">字符集 <code>&lt;meta&gt;</code> 标签</a>实现的，这是一种可行的方式。但更好的做法是在 <code>Content-Type</code> 响应头中进行设置，因为这样做的速度会<a href="https://developers.google.com/speed/docs/best-practices/rendering#SpecifyCharsetEarly">更快</a>。</p>

<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="c1">// Tell PHP that we're using UTF-8 strings until the end of the script</span>
<span class="nb">mb_internal_encoding</span><span class="p">(</span><span class="s1">'UTF-8'</span><span class="p">);</span>
<span class="nv">$utf_set</span> <span class="o">=</span> <span class="nb">ini_set</span><span class="p">(</span><span class="s1">'default_charset'</span><span class="p">,</span> <span class="s1">'utf-8'</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$utf_set</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nx">Exception</span><span class="p">(</span><span class="s1">'could not set default_charset to utf-8, please ensure it\'s set on your system!'</span><span class="p">);</span>
<span class="p">}</span>

 
<span class="c1">// Tell PHP that we'll be outputting UTF-8 to the browser</span>
<span class="nb">mb_http_output</span><span class="p">(</span><span class="s1">'UTF-8'</span><span class="p">);</span>
 
<span class="c1">// Our UTF-8 test string</span>
<span class="nv">$string</span> <span class="o">=</span> <span class="s1">'Êl síla erin lû e-govaned vîn.'</span><span class="p">;</span>
 
<span class="c1">// Transform the string in some way with a multibyte function</span>
<span class="c1">// Note how we cut the string at a non-Ascii character for demonstration purposes</span>
<span class="nv">$string</span> <span class="o">=</span> <span class="nb">mb_substr</span><span class="p">(</span><span class="nv">$string</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">15</span><span class="p">);</span>
 
<span class="c1">// Connect to a database to store the transformed string</span>
<span class="c1">// See the PDO example in this document for more information</span>
<span class="c1">// Note the `charset=utf8mb4` in the Data Source Name (DSN)</span>
<span class="nv">$link</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PDO</span><span class="p">(</span>
    <span class="s1">'mysql:host=your-hostname;dbname=your-db;charset=utf8mb4'</span><span class="p">,</span>
    <span class="s1">'your-username'</span><span class="p">,</span>
    <span class="s1">'your-password'</span><span class="p">,</span>
    <span class="k">array</span><span class="p">(</span>
        <span class="nx">PDO</span><span class="o">::</span><span class="na">ATTR_ERRMODE</span> <span class="o">=&gt;</span> <span class="nx">PDO</span><span class="o">::</span><span class="na">ERRMODE_EXCEPTION</span><span class="p">,</span>
        <span class="nx">PDO</span><span class="o">::</span><span class="na">ATTR_PERSISTENT</span> <span class="o">=&gt;</span> <span class="kc">false</span>
    <span class="p">)</span>
<span class="p">);</span>
 
<span class="c1">// Store our transformed string as UTF-8 in our database</span>
<span class="c1">// Your DB and tables are in the utf8mb4 character set and collation, right?</span>
<span class="nv">$handle</span> <span class="o">=</span> <span class="nv">$link</span><span class="o">-&gt;</span><span class="na">prepare</span><span class="p">(</span><span class="s1">'insert into ElvishSentences (Id, Body, Priority) values (default, :body, :priority)'</span><span class="p">);</span>
<span class="nv">$handle</span><span class="o">-&gt;</span><span class="na">bindParam</span><span class="p">(</span><span class="s1">':body'</span><span class="p">,</span> <span class="nv">$string</span><span class="p">,</span> <span class="nx">PDO</span><span class="o">::</span><span class="na">PARAM_STR</span><span class="p">);</span>
<span class="nv">$priority</span> <span class="o">=</span> <span class="mi">45</span><span class="p">;</span>
<span class="nv">$handle</span><span class="o">-&gt;</span><span class="na">bindParam</span><span class="p">(</span><span class="s1">':priority'</span><span class="p">,</span> <span class="nv">$priority</span><span class="p">,</span> <span class="nx">PDO</span><span class="o">::</span><span class="na">PARAM_INT</span><span class="p">);</span> <span class="c1">// explicitly tell pdo to expect an int</span>
<span class="nv">$handle</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">();</span>
 
<span class="c1">// Retrieve the string we just stored to prove it was stored correctly</span>
<span class="nv">$handle</span> <span class="o">=</span> <span class="nv">$link</span><span class="o">-&gt;</span><span class="na">prepare</span><span class="p">(</span><span class="s1">'select * from ElvishSentences where Id = :id'</span><span class="p">);</span>
<span class="nv">$id</span> <span class="o">=</span> <span class="mi">7</span><span class="p">;</span>
<span class="nv">$handle</span><span class="o">-&gt;</span><span class="na">bindParam</span><span class="p">(</span><span class="s1">':id'</span><span class="p">,</span> <span class="nv">$id</span><span class="p">,</span> <span class="nx">PDO</span><span class="o">::</span><span class="na">PARAM_INT</span><span class="p">);</span>
<span class="nv">$handle</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">();</span>
 
<span class="c1">// Store the result into an object that we'll output later in our HTML</span>
<span class="c1">// This object won't kill your memory because it fetches the data Just-In-Time to</span>
<span class="nv">$result</span> <span class="o">=</span> <span class="nv">$handle</span><span class="o">-&gt;</span><span class="na">fetchAll</span><span class="p">(</span><span class="nx">\PDO</span><span class="o">::</span><span class="na">FETCH_OBJ</span><span class="p">);</span>

<span class="c1">// An example wrapper to allow you to escape data to html</span>
<span class="k">function</span> <span class="nf">escape_to_html</span><span class="p">(</span><span class="nv">$dirty</span><span class="p">){</span>
    <span class="k">echo</span> <span class="nb">htmlspecialchars</span><span class="p">(</span><span class="nv">$dirty</span><span class="p">,</span> <span class="nx">ENT_QUOTES</span><span class="p">,</span> <span class="s1">'UTF-8'</span><span class="p">);</span>
<span class="p">}</span>

<span class="nb">header</span><span class="p">(</span><span class="s1">'Content-Type: text/html; charset=UTF-8'</span><span class="p">);</span> <span class="c1">// Unnecessary if your default_charset is set to utf-8 already</span>
<span class="cp">?&gt;&lt;!doctype html&gt;</span>
<span class="nt">&lt;html&gt;</span>
    <span class="nt">&lt;head&gt;</span>
        <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"UTF-8"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;title&gt;</span>UTF-8 test page<span class="nt">&lt;/title&gt;</span>
    <span class="nt">&lt;/head&gt;</span>
    <span class="nt">&lt;body&gt;</span>
        <span class="cp">&lt;?php</span>
        <span class="k">foreach</span><span class="p">(</span><span class="nv">$result</span> <span class="k">as</span> <span class="nv">$row</span><span class="p">){</span>
            <span class="nx">escape_to_html</span><span class="p">(</span><span class="nv">$row</span><span class="o">-&gt;</span><span class="na">Body</span><span class="p">);</span>  <span class="c1">// This should correctly output our transformed UTF-8 string to the browser</span>
        <span class="p">}</span>
        <span class="cp">?&gt;</span>
    <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span></code></pre></div>

<h3 id="further-reading">Further reading</h3>

<ul>
  <li><a href="https://php.net/language.operators.string">PHP 手册：字符串运算符</a></li>
  <li><a href="https://php.net/ref.strings">PHP 手册：字符串函数</a>
    <ul>
      <li><a href="https://php.net/function.strpos"><code>strpos()</code></a></li>
      <li><a href="https://php.net/function.strlen"><code>strlen()</code></a></li>
      <li><a href="https://php.net/function.substr"><code>substr()</code></a></li>
    </ul>
  </li>
  <li><a href="https://php.net/ref.mbstring">PHP 手册：多字节字符串函数</a>
    <ul>
      <li><a href="https://php.net/function.mb-strpos"><code>mb_strpos()</code></a></li>
      <li><a href="https://php.net/function.mb-strlen"><code>mb_strlen()</code></a></li>
      <li><a href="https://php.net/function.mb-substr"><code>mb_substr()</code></a></li>
      <li><a href="https://php.net/function.mb-internal-encoding"><code>mb_internal_encoding()</code></a></li>
      <li><a href="https://php.net/function.mb-http-output"><code>mb_http_output()</code></a></li>
      <li><a href="https://php.net/function.htmlentities"><code>htmlentities()</code></a></li>
      <li><a href="https://php.net/function.htmlspecialchars"><code>htmlspecialchars()</code></a></li>
    </ul>
  </li>
  <li><a href="https://blog.loftdigital.com/blog/php-utf-8-cheatsheet">PHP UTF-8 Cheatsheet</a></li>
  <li><a href="https://www.phpwact.org/php/i18n/utf-8">Handling UTF-8 with PHP</a></li>
  <li><a href="https://stackoverflow.com/questions/571694/what-factors-make-php-unicode-incompatible">Stack Overflow: What factors make PHP Unicode-incompatible?</a></li>
  <li><a href="https://stackoverflow.com/questions/140728/best-practices-in-php-and-mysql-with-international-strings">Stack Overflow: Best practices in PHP and MySQL with international strings</a></li>
  <li><a href="https://mathiasbynens.be/notes/mysql-utf8mb4">How to support full Unicode in MySQL databases</a></li>
  <li><a href="https://www.sitepoint.com/bringing-unicode-to-php-with-portable-utf8/">Bringing Unicode to PHP with Portable UTF-8</a></li>
  <li><a href="https://stackoverflow.com/questions/8218230/php-domdocument-loadhtml-not-encoding-utf-8-correctly">Stack Overflow: DOMDocument loadHTML does not encode UTF-8 correctly</a></li>
</ul>

</section>


<section class="chapter" id="i18n_l10n">
    <h2 id="i18n_l10n_title">国际化（i18n）和本地化（l10n）</h2>

<p>_前置声明：i18n 和 l10n 是使用数字简略拼写方式来实现缩写，在我们的例子里：internationalization 是 i18n，而 localization 简写为 l10n。</p>

<p>首先，我们需要定义这两个相似的概念，还有相关的概念：</p>

<ul>
  <li><strong>Internationalization</strong> 国际化：指的是一开始设计一个支持多语言的架构。很多时候这个事情只需要做一次，并且是在项目初始时，不然的话，你可能面临一个项目的重大修改。</li>
  <li><strong>Localization</strong> 本地化：指的是新语言的添加。基于 i18n 的架构设计，在每一次新支持一门语言时，我们都需要一点点的去增加翻译的语言。</li>
  <li><strong>Pluralization</strong> 复数形式：不同语言复数规则不一样，即使是相同语言里也会出现不同复数规则，例如大部分英文名词后面加 <code>s 为复数，有一些单词如 </code>knowledge` 就没有复数形式。俄语和塞尔威亚语有两种复数的形式，甚至有一些语言，如斯洛维尼亚语、爱尔兰语和阿拉伯语会存在 4、5 或者是 6 种复数形式。</li>
</ul>

<h2 id="section">一般实现的方法</h2>

<p>最简便的方式是使用数组键值对应的方式如 <code>&lt;h1&gt;&lt;?=$TRANS['title_about_page']?&gt;&lt;/h1&gt;</code>，不过在比较正经的项目中，不建议这么做。因为会随着项目代码慢慢变多，维护的难度将会增加，尤其会阻碍后续本地化实施。</p>

<p>The most classic way and often taken as reference for i18n and l10n is a <a href="https://en.wikipedia.org/wiki/Gettext">Unix tool called <code>gettext</code></a>. It dates
back to 1995 and is still a complete implementation for translating software. It is easy enough to get running, while
still sporting powerful supporting tools. It is about Gettext we will be talking here. Also, to help you not get messy
over the command-line, we will be presenting a great GUI application that can be used to easily update your l10n source</p>

<h3 id="other-tools">Other tools</h3>

<p>There are common libraries used that support Gettext and other implementations of i18n. Some of them may seem easier to
install or sport additional features or i18n file formats. In this document, we focus on the tools provided with the
PHP core, but here we list others for completion:</p>

<ul>
  <li>[aura/intl][aura-intl]: Provides internationalization (I18N) tools, specifically package-oriented per-locale message
translation. It uses array formats for message. Does not provide a message extractor, but does provide advanced
message formatting via the <code>intl</code> extension (including pluralized messages).</li>
  <li><a href="https://github.com/oscarotero/Gettext">oscarotero/Gettext</a>: Gettext support with an OO interface; includes improved helper functions, powerful
extractors for several file formats (some of them not supported natively by the <code>gettext</code> command), and can also export
to other formats besides <code>.mo/.po</code> files. Can be useful if you need to integrate your translation files into other
parts of the system, like a JavaScript interface.</li>
  <li><a href="https://symfony.com/doc/current/components/translation.html">symfony/translation</a>: supports a lot of different formats, but recommends using verbose XLIFF’s. Doesn’t
include helper functions nor a built-in extractor, but supports placeholders using <code>strtr()</code> internally.</li>
  <li><a href="https://docs.zendframework.com/zend-i18n/translation">zend/i18n</a>: supports array and INI files, or Gettext formats. Implements a caching layer to save you from
reading the filesystem every time. It also includes view helpers, and locale-aware input filters and validators.
However, it has no message extractor.</li>
</ul>

<p>Other frameworks also include i18n modules, but those are not available outside of their codebases:</p>

<ul>
  <li><a href="https://laravel.com/docs/master/localization">Laravel</a> supports basic array files, has no automatic extractor but includes a <code>@lang</code> helper for template files.</li>
  <li><a href="https://www.yiiframework.com/doc-2.0/guide-tutorial-i18n.html">Yii</a> supports array, Gettext, and database-based translation, and includes a messages extractor. It is backed by the
<a href="https://br2.php.net/manual/en/intro.intl.php"><code>Intl</code></a> extension, available since PHP 5.3, and based on the <a href="https://www.icu-project.org">ICU project</a>; this enables Yii to run powerful
replacements, like spelling out numbers, formatting dates, times, intervals, currency, and ordinals.</li>
</ul>

<p>If you decide to go for one of the libraries that provide no extractors, you may want to use the gettext formats, so
you can use the original gettext toolchain (including Poedit) as described in the rest of the chapter.</p>

<h2 id="gettext">Gettext</h2>

<h3 id="installation">Installation</h3>
<p>You might need to install Gettext and the related PHP library by using your package manager, like <code>apt-get</code> or <code>yum</code>.
After installed, enable it by adding <code>extension=gettext.so</code> (Linux/Unix) or <code>extension=php_gettext.dll</code> (Windows) to
your <code>php.ini</code>.</p>

<p>Here we will also be using <a href="https://poedit.net">Poedit</a> to create translation files. You will probably find it in your system’s package
manager; it is available for Unix, Mac, and Windows, and can be <a href="https://poedit.net/download">downloaded for free on their website</a>
as well.</p>

<h3 id="structure">Structure</h3>

<h4 id="types-of-files">Types of files</h4>
<p>There are three files you usually deal with while working with gettext. The main ones are PO (Portable Object) and
MO (Machine Object) files, the first being a list of readable “translated objects” and the second, the corresponding
binary to be interpreted by gettext when doing localization. There’s also a POT (Template) file, which simply contains
all existing keys from your source files, and can be used as a guide to generate and update all PO files. Those template
files are not mandatory: depending on the tool you are using to do l10n, you can go just fine with only PO/MO files.
You will always have one pair of PO/MO files per language and region, but only one POT per domain.</p>

<h3 id="domains">Domains</h3>
<p>There are some cases, in big projects, where you might need to separate translations when the same words convey 
different meaning given a context. In those cases, you split them into different <em>domains</em>. They are, basically, named
groups of POT/PO/MO files, where the filename is the said <em>translation domain</em>. Small and medium-sized projects usually,
for simplicity, use only one domain; its name is arbitrary, but we will be using “main” for our code samples.
In <a href="https://symfony.com/doc/current/components/translation.html">Symfony</a> projects, for example, domains are used to separate the translation for validation messages.</p>

<h4 id="locale-code">Locale code</h4>
<p>A locale is simply a code that identifies one version of a language. It is defined following the <a href="https://en.wikipedia.org/wiki/List_of_ISO_639-1_codes">ISO 639-1</a> and 
<a href="https://en.wikipedia.org/wiki/ISO_3166-1_alpha-2">ISO 3166-1 alpha-2</a> specs: two lower-case letters for the language, optionally followed by an underline and two
upper-case letters identifying the country or regional code. For <a href="https://www.gnu.org/software/gettext/manual/gettext.html#Rare-Language-Codes">rare languages</a>, three letters are used.</p>

<p>For some speakers, the country part may seem redundant. In fact, some languages have dialects in different
countries, such as Austrian German (<code>de_AT</code>) or Brazilian Portuguese (<code>pt_BR</code>). The second part is used to distinguish
between those dialects - when it is not present, it is taken as a “generic” or “hybrid” version of the language.</p>

<h3 id="directory-structure">Directory structure</h3>
<p>To use Gettext, we will need to adhere to a specific structure of folders. First, you will need to select an arbitrary
root for your l10n files in your source repository. Inside it, you will have a folder for each needed locale, and a
fixed <code>LC_MESSAGES</code> folder that will contain all your PO/MO pairs. Example:</p>

<div class="highlight"><pre><code class="language-console" data-lang="console"><span class="gp">&lt;project root&gt;</span>
<span class="go"> ├─ src/
 ├─ templates/
 └─ locales/
    ├─ forum.pot
    ├─ site.pot
    ├─ de/
    │  └─ LC_MESSAGES/
    │     ├─ forum.mo
    │     ├─ forum.po
    │     ├─ site.mo
    │     └─ site.po
    ├─ es_ES/
    │  └─ LC_MESSAGES/
    │     └─ ...
    ├─ fr/
    │  └─ ...
    ├─ pt_BR/
    │  └─ ...
    └─ pt_PT/
       └─ ...</span></code></pre></div>

<h3 id="plural-forms">Plural forms</h3>
<p>As we said in the introduction, different languages might sport different plural rules. However, gettext saves us from
this trouble once again. When creating a new <code>.po</code> file, you will have to declare the <a href="https://docs.translatehouse.org/projects/localization-guide/en/latest/l10n/pluralforms.html">plural rules</a> for that
language, and translated pieces that are plural-sensitive will have a different form for each of those rules. When
calling Gettext in code, you will have to specify the number related to the sentence, and it will work out the correct
form to use - even using string substitution if needed.</p>

<p>Plural rules include the number of plurals available and a boolean test with <code>n</code> that would define in which rule the
given number falls (starting the count with 0). For example:</p>

<ul>
  <li>Japanese: <code>nplurals=1; plural=0</code> - only one rule</li>
  <li>English: <code>nplurals=2; plural=(n != 1);</code> - two rules, first if N is one, second rule otherwise</li>
  <li>Brazilian Portuguese: <code>nplurals=2; plural=(n &gt; 1);</code> - two rules, second if N is bigger than one, first otherwise</li>
</ul>

<p>Now that you understood the basis of how plural rules works - and if you didn’t, please look at a deeper explanation
on the <a href="https://lingohub.com/blog/2013/07/php-internationalization-with-gettext-tutorial/#Plurals">LingoHub tutorial</a> -, you might want to copy the ones you need from a <a href="https://docs.translatehouse.org/projects/localization-guide/en/latest/l10n/pluralforms.html">list</a> instead
of writing them by hand.</p>

<p>When calling out Gettext to do localization on sentences with counters, you will have to give him the
related number as well. Gettext will work out what rule should be in effect and use the correct localized version.
You will need to include in the <code>.po</code> file a different sentence for each plural rule defined.</p>

<h3 id="sample-implementation">Sample implementation</h3>
<p>After all that theory, let’s get a little practical. Here’s an excerpt of a <code>.po</code> file - don’t mind with its format,
but with the overall content instead; you will learn how to edit it easily later:</p>

<div class="highlight"><pre><code class="language-po" data-lang="po">msgid ""
msgstr ""
"Language: pt_BR\n"
"Content-Type: text/plain; charset=UTF-8\n"
"Plural-Forms: nplurals=2; plural=(n &gt; 1);\n"

msgid "We are now translating some strings"
msgstr "Nós estamos traduzindo algumas strings agora"

msgid "Hello %1$s! Your last visit was on %2$s"
msgstr "Olá %1$s! Sua última visita foi em %2$s"

msgid "Only one unread message"
msgid_plural "%d unread messages"
msgstr[0] "Só uma mensagem não lida"
msgstr[1] "%d mensagens não lidas"</code></pre></div>

<p>The first section works like a header, having the <code>msgid</code> and <code>msgstr</code> especially empty. It describes the file encoding,
plural forms and other things that are less relevant.
The second section translates a simple string from English to
Brazilian Portuguese, and the third does the same, but leveraging string replacement from <a href="https://php.net/manual/en/function.sprintf.php"><code>sprintf</code></a> so the
translation may contain the user name and visit date.
The last section is a sample of pluralization forms, displaying
the singular and plural version as <code>msgid</code> in English and their corresponding translations as <code>msgstr</code> 0 and 1
(following the number given by the plural rule). There, string replacement is used as well so the number can be seen
directly in the sentence, by using <code>%d</code>. The plural forms always have two <code>msgid</code> (singular and plural), so it is
advised not to use a complex language as the source of translation.</p>

<h3 id="discussion-on-l10n-keys">Discussion on l10n keys</h3>
<p>As you might have noticed, we are using as source ID the actual sentence in English. That <code>msgid</code> is the same used
throughout all your <code>.po</code> files, meaning other languages will have the same format and the same <code>msgid</code> fields but
translated <code>msgstr</code> lines.</p>

<p>Talking about translation keys, there are two main “schools” here:</p>

<ol>
  <li><em><code>msgid</code> as a real sentence</em>.
 The main advantages are:
    <ul>
      <li>if there are pieces of the software untranslated in any given language, the key displayed will still maintain some
 meaning. Example: if you happen to translate by heart from English to Spanish but need help to translate to French,
 you might publish the new page with missing French sentences, and parts of the website would be displayed in English
 instead;</li>
      <li>it is much easier for the translator to understand what’s going on and do a proper translation based on the
 <code>msgid</code>;</li>
      <li>it gives you “free” l10n for one language - the source one;</li>
      <li>The only disadvantage: if you need to change the actual text, you would need to replace the same <code>msgid</code>
 across several language files.</li>
    </ul>
  </li>
  <li><em><code>msgid</code> as a unique, structured key</em>.
It would describe the sentence role in the application in a structured way, including the template or part where the
string is located instead of its content.
    <ul>
      <li>it is a great way to have the code organized, separating the text content from the template logic.</li>
      <li>however, that could bring problems to the translator that would miss the context. A source language file would be
 needed as a basis for other translations. Example: the developer would ideally have an <code>en.po</code> file, that
 translators would read to understand what to write in <code>fr.po</code> for instance.</li>
      <li>missing translations would display meaningless keys on screen (<code>top_menu.welcome</code> instead of <code>Hello there, User!</code>
 on the said untranslated French page). That is good it as would force translation to be complete before publishing -
 however, bad as translation issues would be remarkably awful in the interface. Some libraries, though, include an
 option to specify a given language as “fallback”, having a similar behavior as the other approach.</li>
    </ul>
  </li>
</ol>

<p>The <a href="https://www.gnu.org/software/gettext/manual/gettext.html">Gettext manual</a> favors the first approach as, in general, it is easier for translators and users in
case of trouble. That is how we will be working here as well. However, the <a href="https://symfony.com/doc/current/components/translation/usage.html#creating-translations">Symfony documentation</a> favors
keyword-based translation, to allow for independent changes of all translations without affecting templates as well.</p>

<h3 id="everyday-usage">Everyday usage</h3>
<p>In a typical application, you would use some Gettext functions while writing static text in your pages. Those sentences
would then appear in <code>.po</code> files, get translated, compiled into <code>.mo</code> files and then, used by Gettext when rendering
the actual interface. Given that, let’s tie together what we have discussed so far in a step-by-step example:</p>

<h4 id="a-sample-template-file-including-some-different-gettext-calls">1. A sample template file, including some different gettext calls</h4>

<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span> <span class="k">include</span> <span class="s1">'i18n_setup.php'</span> <span class="cp">?&gt;</span>
<span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"header"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;h1&gt;</span><span class="cp">&lt;?=</span><span class="nb">sprintf</span><span class="p">(</span><span class="nb">gettext</span><span class="p">(</span><span class="s1">'Welcome, %s!'</span><span class="p">),</span> <span class="nv">$name</span><span class="p">)</span><span class="cp">?&gt;</span><span class="nt">&lt;/h1&gt;</span>
    <span class="c">&lt;!-- code indented this way only for legibility --&gt;</span>
    <span class="cp">&lt;?php</span> <span class="k">if</span> <span class="p">(</span><span class="nv">$unread</span><span class="p">)</span><span class="o">:</span> <span class="cp">?&gt;</span>
        <span class="nt">&lt;h2&gt;</span><span class="cp">&lt;?=</span><span class="nb">sprintf</span><span class="p">(</span>
            <span class="nb">ngettext</span><span class="p">(</span><span class="s1">'Only one unread message'</span><span class="p">,</span>
                     <span class="s1">'%d unread messages'</span><span class="p">,</span>
                     <span class="nv">$unread</span><span class="p">),</span>
            <span class="nv">$unread</span><span class="p">)</span><span class="cp">?&gt;</span>
        <span class="nt">&lt;/h2&gt;</span>
    <span class="cp">&lt;?php</span> <span class="k">endif</span> <span class="cp">?&gt;</span>
<span class="nt">&lt;/div&gt;</span>

<span class="nt">&lt;h1&gt;</span><span class="cp">&lt;?=</span><span class="nb">gettext</span><span class="p">(</span><span class="s1">'Introduction'</span><span class="p">)</span><span class="cp">?&gt;</span><span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;p&gt;</span><span class="cp">&lt;?=</span><span class="nb">gettext</span><span class="p">(</span><span class="s1">'We\'re now translating some strings'</span><span class="p">)</span><span class="cp">?&gt;</span><span class="nt">&lt;/p&gt;</span></code></pre></div>

<ul>
  <li><a href="https://php.net/manual/en/function.gettext.php"><code>gettext()</code></a> simply translates a <code>msgid</code> into its corresponding <code>msgstr</code> for a given language. There’s also
the shorthand function <code>_()</code> that works the same way;</li>
  <li><a href="https://php.net/manual/en/function.ngettext.php"><code>ngettext()</code></a> does the same but with plural rules;</li>
  <li>there’s also <a href="https://php.net/manual/en/function.dgettext.php"><code>dgettext()</code></a> and <a href="https://php.net/manual/en/function.dngettext.php"><code>dngettext()</code></a>, that allows you to override the domain for a single
call. More on domain configuration in the next example.</li>
</ul>

<h4 id="a-sample-setup-file-i18nsetupphp-as-used-above-selecting-the-correct-locale-and-configuring-gettext">2. A sample setup file (<code>i18n_setup.php</code> as used above), selecting the correct locale and configuring Gettext</h4>

<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="sd">/**
 * Verifies if the given $locale is supported in the project
 * @param string $locale
 * @return bool
 */</span>
<span class="k">function</span> <span class="nf">valid</span><span class="p">(</span><span class="nv">$locale</span><span class="p">)</span> <span class="p">{</span>
   <span class="k">return</span> <span class="nb">in_array</span><span class="p">(</span><span class="nv">$locale</span><span class="p">,</span> <span class="p">[</span><span class="s1">'en_US'</span><span class="p">,</span> <span class="s1">'en'</span><span class="p">,</span> <span class="s1">'pt_BR'</span><span class="p">,</span> <span class="s1">'pt'</span><span class="p">,</span> <span class="s1">'es_ES'</span><span class="p">,</span> <span class="s1">'es'</span><span class="p">]);</span>
<span class="p">}</span>

<span class="c1">//setting the source/default locale, for informational purposes</span>
<span class="nv">$lang</span> <span class="o">=</span> <span class="s1">'en_US'</span><span class="p">;</span>

<span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">'lang'</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nx">valid</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">'lang'</span><span class="p">]))</span> <span class="p">{</span>
    <span class="c1">// the locale can be changed through the query-string</span>
    <span class="nv">$lang</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">'lang'</span><span class="p">];</span>    <span class="c1">//you should sanitize this!</span>
    <span class="nb">setcookie</span><span class="p">(</span><span class="s1">'lang'</span><span class="p">,</span> <span class="nv">$lang</span><span class="p">);</span> <span class="c1">//it's stored in a cookie so it can be reused</span>
<span class="p">}</span> <span class="k">elseif</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_COOKIE</span><span class="p">[</span><span class="s1">'lang'</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nx">valid</span><span class="p">(</span><span class="nv">$_COOKIE</span><span class="p">[</span><span class="s1">'lang'</span><span class="p">]))</span> <span class="p">{</span>
    <span class="c1">// if the cookie is present instead, let's just keep it</span>
    <span class="nv">$lang</span> <span class="o">=</span> <span class="nv">$_COOKIE</span><span class="p">[</span><span class="s1">'lang'</span><span class="p">];</span> <span class="c1">//you should sanitize this!</span>
<span class="p">}</span> <span class="k">elseif</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">'HTTP_ACCEPT_LANGUAGE'</span><span class="p">]))</span> <span class="p">{</span>
    <span class="c1">// default: look for the languages the browser says the user accepts</span>
    <span class="nv">$langs</span> <span class="o">=</span> <span class="nb">explode</span><span class="p">(</span><span class="s1">','</span><span class="p">,</span> <span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">'HTTP_ACCEPT_LANGUAGE'</span><span class="p">]);</span>
    <span class="nb">array_walk</span><span class="p">(</span><span class="nv">$langs</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="o">&amp;</span><span class="nv">$lang</span><span class="p">)</span> <span class="p">{</span> <span class="nv">$lang</span> <span class="o">=</span> <span class="nb">strtr</span><span class="p">(</span><span class="nb">strtok</span><span class="p">(</span><span class="nv">$lang</span><span class="p">,</span> <span class="s1">';'</span><span class="p">),</span> <span class="p">[</span><span class="s1">'-'</span> <span class="o">=&gt;</span> <span class="s1">'_'</span><span class="p">]);</span> <span class="p">});</span>
    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$langs</span> <span class="k">as</span> <span class="nv">$browser_lang</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">valid</span><span class="p">(</span><span class="nv">$browser_lang</span><span class="p">))</span> <span class="p">{</span>
            <span class="nv">$lang</span> <span class="o">=</span> <span class="nv">$browser_lang</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// here we define the global system locale given the found language</span>
<span class="nb">putenv</span><span class="p">(</span><span class="s2">"LANG=</span><span class="nv">$lang</span><span class="s2">"</span><span class="p">);</span>

<span class="c1">// this might be useful for date functions (LC_TIME) or money formatting (LC_MONETARY), for instance</span>
<span class="nb">setlocale</span><span class="p">(</span><span class="nx">LC_ALL</span><span class="p">,</span> <span class="nv">$lang</span><span class="p">);</span>

<span class="c1">// this will make Gettext look for ../locales/&lt;lang&gt;/LC_MESSAGES/main.mo</span>
<span class="nb">bindtextdomain</span><span class="p">(</span><span class="s1">'main'</span><span class="p">,</span> <span class="s1">'../locales'</span><span class="p">);</span>

<span class="c1">// indicates in what encoding the file should be read</span>
<span class="nb">bind_textdomain_codeset</span><span class="p">(</span><span class="s1">'main'</span><span class="p">,</span> <span class="s1">'UTF-8'</span><span class="p">);</span>

<span class="c1">// if your application has additional domains, as cited before, you should bind them here as well</span>
<span class="nb">bindtextdomain</span><span class="p">(</span><span class="s1">'forum'</span><span class="p">,</span> <span class="s1">'../locales'</span><span class="p">);</span>
<span class="nb">bind_textdomain_codeset</span><span class="p">(</span><span class="s1">'forum'</span><span class="p">,</span> <span class="s1">'UTF-8'</span><span class="p">);</span>

<span class="c1">// here we indicate the default domain the gettext() calls will respond to</span>
<span class="nb">textdomain</span><span class="p">(</span><span class="s1">'main'</span><span class="p">);</span>

<span class="c1">// this would look for the string in forum.mo instead of main.mo</span>
<span class="c1">// echo dgettext('forum', 'Welcome back!');</span>
<span class="cp">?&gt;</span></code></pre></div>

<h4 id="preparing-translation-for-the-first-run">3. Preparing translation for the first run</h4>
<p>One of the great advantages Gettext has over custom framework i18n packages is its extensive and powerful file format.
“Oh man, that’s quite hard to understand and edit by hand, a simple array would be easier!” Make no mistake,
applications like <a href="https://poedit.net">Poedit</a> are here to help - <em>a lot</em>. You can get the program from <a href="https://poedit.net/download">their website</a>,
it’s free and available for all platforms. It’s a pretty easy tool to get used to, and a very powerful one at the same
time - using all features Gettext has available. This guide is based on PoEdit 1.8.</p>

<p>In the first run, you should select “File &gt; New…” from the menu. You’ll be asked straight ahead for the language:
here you can select/filter the language you want to translate to, or use that format we mentioned before, such as
<code>en_US</code> or <code>pt_BR</code>.</p>

<p>Now, save the file - using that directory structure we mentioned as well. Then you should click “Extract from sources”,
and here you’ll configure various settings for the extraction and translation tasks. You’ll be able to find all those
later through “Catalog &gt; Properties”:</p>

<ul>
  <li>Source paths: here you must include all folders from the project where <code>gettext()</code> (and siblings) are called - this
is usually your templates/views folder(s). This is the only mandatory setting;</li>
  <li>Translation properties:
    <ul>
      <li>Project name and version, Team and Team’s email address: useful information that goes in the .po file header;</li>
      <li>Plural forms: here go those rules we mentioned before - there’s a link in there with samples as well. You can
  leave it with the default option most of the time, as PoEdit already includes a handy database of plural rules for
  many languages.</li>
      <li>Charsets: UTF-8, preferably;</li>
      <li>Source code charset: set here the charset used by your codebase - probably UTF-8 as well, right?</li>
    </ul>
  </li>
  <li>Source keywords: The underlying software knows how <code>gettext()</code> and similar function calls look like in several
programming languages, but you might as well create your own translation functions. It will be here you’ll add those
other methods. This will be discussed later in the “Tips” section.</li>
</ul>

<p>After setting those points it will run a scan through your source files to find all the localization calls. After every
scan PoEdit will display a summary of what was found and what was removed from the source files. New entries will fed
empty into the translation table, and you’ll start typing in the localized versions of those strings. Save it and a .mo
file will be (re)compiled into the same folder and ta-dah: your project is internationalized.</p>

<h4 id="translating-strings">4. Translating strings</h4>
<p>As you may have noticed before, there are two main types of localized strings: simple ones and those with plural
forms. The first ones have simply two boxes: source and localized string. The source string cannot be modified as
Gettext/Poedit do not include the powers to alter your source files - you should change the source itself and rescan
the files. Tip: you may right-click a translation line and it will hint you with the source files and lines where that
string is being used.
On the other hand, plural form strings include two boxes to show the two source strings, and tabs so you can configure
the different final forms.</p>

<p>Whenever you change your sources and need to update the translations, just hit Refresh and Poedit will rescan the code,
removing non-existent entries, merging the ones that changed and adding new ones. It may also try to guess some
translations, based on other ones you did. Those guesses and the changed entries will receive a “Fuzzy” marker,
indicating it needs review, appearing golden in the list. It is also useful if you have a translation team and someone
tries to write something they are not sure about: just mark Fuzzy, and someone else will review later.</p>

<p>Finally, it is advised to leave “View &gt; Untranslated entries first” marked, as it will help you <em>a lot</em> to not forget
any entry. From that menu, you can also open parts of the UI that allow you to leave contextual information for
translators if needed.</p>

<h3 id="tips--tricks">Tips &amp; Tricks</h3>

<h4 id="possible-caching-issues">Possible caching issues</h4>
<p>If you are running PHP as a module on Apache (<code>mod_php</code>), you might face issues with the <code>.mo</code> file being cached. It
happens the first time it is read, and then, to update it, you might need to restart the server. On Nginx and PHP5 it
usually takes only a couple of page refreshes to refresh the translation cache, and on PHP7 it is rarely needed.</p>

<h4 id="additional-helper-functions">Additional helper functions</h4>
<p>As preferred by many people, it is easier to use <code>_()</code> instead of <code>gettext()</code>. Many custom i18n libraries from
frameworks use something similar to <code>t()</code> as well, to make translated code shorter. However, that is the only function
that sports a shortcut. You might want to add in your project some others, such as <code>__()</code> or <code>_n()</code> for <code>ngettext()</code>,
or maybe a fancy <code>_r()</code> that would join <code>gettext()</code> and <code>sprintf()</code> calls. Other libraries, such as
<a href="https://github.com/oscarotero/Gettext">oscarotero’s Gettext</a> also provide helper functions like these.</p>

<p>In those cases, you’ll need to instruct the Gettext utility on how to extract the strings from those new functions.
Don’t be afraid; it is very easy. It is just a field in the <code>.po</code> file, or a Settings screen on Poedit. In the editor,
that option is inside “Catalog &gt; Properties &gt; Source keywords”. Remember: Gettext already knows the default functions
for many languages, so don’t be afraid if that list seems empty. You need to include there the specifications of those
new functions, following <a href="https://www.gnu.org/software/gettext/manual/gettext.html#Language-specific-options">a specific format</a>:</p>

<ul>
  <li>if you create something like <code>t()</code> that simply returns the translation for a string, you can specify it as <code>t</code>.
Gettext will know the only function argument is the string to be translated;</li>
  <li>if the function has more than one argument, you can specify in which one the first string is - and if needed, the
plural form as well. For instance, if we call our function like this: <code>__('one user', '%d users', $number)</code>, the
specification would be <code>__:1,2</code>, meaning the first form is the first argument, and the second form is the second
argument. If your number comes as the first argument instead, the spec would be <code>__:2,3</code>, indicating the first form is
the second argument, and so on.</li>
</ul>

<p>After including those new rules in the <code>.po</code> file, a new scan will bring in your new strings just as easy as before.</p>

<h3 id="references">References</h3>

<ul>
  <li><a href="https://en.wikipedia.org/wiki/Internationalization_and_localization">Wikipedia: i18n and l10n</a></li>
  <li><a href="https://en.wikipedia.org/wiki/Gettext">Wikipedia: Gettext</a></li>
  <li><a href="https://lingohub.com/blog/2013/07/php-internationalization-with-gettext-tutorial/">LingoHub: PHP internationalization with gettext tutorial</a></li>
  <li><a href="https://php.net/manual/en/book.gettext.php">PHP Manual: Gettext</a></li>
  <li><a href="https://www.gnu.org/software/gettext/manual/gettext.html">Gettext Manual</a></li>
</ul>


</section>

<div class="back-to-top"><p><a href="#top" class="top">回到顶部</a></p>
</div>
<section class="chapter" id="dependency_injection">
    <h1 id="dependency_injection_title">依赖注入</h1>

<p>出自维基百科 <a href="https://wikipedia.org/wiki/Dependency_injection">Wikipedia</a>:</p>

<blockquote>
  <p>依赖注入是一种允许我们从硬编码的依赖中解耦出来，从而在运行时或者编译时能够修改的软件设计模式。</p>
</blockquote>

<p>这句解释让依赖注入的概念听起来比它实际要复杂很多。依赖注入通过构造注入，函数调用或者属性的设置来提供组件的依赖关系。就是这么简单。</p>

</section>


<section class="chapter" id="basic_concept">
    <h2 id="basic_concept_title">基本概念</h2>

<p>我们可以用一个简单的例子来说明依赖注入的概念</p>

<p>下面的代码中有一个 <code>Database</code> 的类，它需要一个适配器来与数据库交互。我们在构造函数里实例化了适配器，从而产生了耦合。这会使测试变得很困难，而且 <code>Database</code> 类和适配器耦合的很紧密。</p>

<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="k">namespace</span> <span class="nx">Database</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Database</span>
<span class="p">{</span>
    <span class="k">protected</span> <span class="nv">$adapter</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">adapter</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MySqlAdapter</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">MysqlAdapter</span> <span class="p">{}</span></code></pre></div>

<p>这段代码可以用依赖注入重构，从而解耦</p>

<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="k">namespace</span> <span class="nx">Database</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Database</span>
<span class="p">{</span>
    <span class="k">protected</span> <span class="nv">$adapter</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">(</span><span class="nx">MySqlAdapter</span> <span class="nv">$adapter</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">adapter</span> <span class="o">=</span> <span class="nv">$adapter</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">MysqlAdapter</span> <span class="p">{}</span></code></pre></div>

<p>现在我们通过外界给予 <code>Database</code> 类的依赖，而不是让它自己产生依赖的对象。我们甚至能用可以接受依赖对象参数的成员函数来设置，或者如果 <code>$adapter</code> 属性本身是 <code>public</code>的，我们可以直接给它赋值。</p>

</section>


<section class="chapter" id="complex_problem">
    <h2 id="complex_problem_title">复杂的问题</h2>

<p>如果你曾经了解过依赖注入，那么你可能见过 <em>“控制反转”(Inversion of Control)</em> 或者 <em>“依赖反转准则”(Dependency Inversion Principle)</em>这种说法。这些是依赖注入能解决的更复杂的问题。</p>

<h3 id="section">控制反转</h3>

<p>顾名思义，一个系统通过组织控制和对象的完全分离来实现”控制反转”。对于依赖注入，这就意味着通过在系统的其他地方控制和实例化依赖对象，从而实现了解耦。</p>

<p>一些 PHP 框架很早以前就已经实现控制反转了，但是问题是，应该反转哪部分以及到什么程度？比如， MVC 框架通常会提供超类或者基本的控制器类以便其他控制器可以通过继承来获得相应的依赖。这就是控制反转的例子，但是这种方法是直接移除了依赖而不是减轻了依赖。</p>

<p>依赖注入允许我们通过按需注入的方式更加优雅地解决这个问题，完全不需要任何耦合。</p>

<h3 id="section-1">依赖反转准则</h3>

<p>依赖反转准则是面向对象设计准则 S.O.L.I.D 中的 “D” ,倡导 <em>“依赖于抽象而不是具体”</em>。简单来说就是依赖应该是接口/约定或者抽象类，而不是具体的实现。我们能很容易重构前面的例子，使之遵循这个准则</p>

<h4 id="single-responsibility-principle">Single Responsibility Principle</h4>

<p>The Single Responsibility Principle is about actors and high-level architecture. It states that “A class should have
only one reason to change.” This means that every class should <em>only</em> have responsibility over a single part of the
functionality provided by the software. The largest benefit of this approach is that it enables improved code
<em>reusability</em>. By designing our class to do just one thing, we can use (or re-use) it in any other program without
changing it.</p>

<h4 id="section-2">开闭原则</h4>

<p>The Open/Closed Principle is about class design and feature extensions. It states that “Software entities (classes,
modules, functions, etc.) should be open for extension, but closed for modification.” This means that we should design
our modules, classes and functions in a way that when a new functionality is needed, we should not modify our existing
code but rather write new code that will be used by existing code. Practically speaking, this means that we should write
classes that implement and adhere to <em>interfaces</em>, then type-hint against those interfaces instead of specific classes.</p>

<p>The largest benefit of this approach is that we can very easily extend our code with support for something new without
having to modify existing code, meaning that we can reduce QA time, and the risk for negative impact to the application
is substantially reduced. We can deploy new code, faster, and with more confidence.</p>

<h4 id="liskov-substitution-principle">Liskov Substitution Principle</h4>

<p>The Liskov Substitution Principle is about subtyping and inheritance. It states that “Child classes should never break
the parent class’ type definitions.” Or, in Robert C. Martin’s words, “Subtypes must be substitutable for their base
types.”</p>

<p>For example, if we have a <code>FileInterface</code> interface which defines an <code>embed()</code> method, and we have <code>Audio</code> and <code>Video</code>
classes which both implement the <code>embed()</code> method, then we can expect that the usage of the <code>embed()</code> method will always
do the thing that we intend. If we later create a <code>PDF</code> class or a <code>Gist</code> class which implement the <code>FileInterface</code>
interface, we will already know and understand what the <code>embed()</code> method will do. The largest benefit of this approach
is that we have the ability to build flexible and easily-configurable programs, because when we change one object of a
type (e.g., <code>FileInterface</code>) to another we don’t need to change anything else in our program.</p>

<h4 id="interface-segregation-principle">Interface Segregation Principle</h4>

<p>The Interface Segregation Principle (ISP) is about <em>business-logic-to-clients</em> communication. It states that “No client
should be forced to depend on methods it does not use.” This means that instead of having a single monolithic interface
that all conforming classes need to implement, we should instead provide a set of smaller, concept-specific interfaces
that a conforming class implements one or more of.</p>

<p>For example, a <code>Car</code> or <code>Bus</code> class would be interested in a <code>steeringWheel()</code> method, but a <code>Motorcycle</code> or <code>Tricycle</code>
class would not. Conversely, a <code>Motorcycle</code> or <code>Tricycle</code> class would be interested in a <code>handlebars()</code> method, but a
<code>Car</code> or <code>Bus</code> class would not. There is no need to have all of these types of vehicles implement support for both
<code>steeringWheel()</code> as well as <code>handlebars()</code>, so we should break-apart the source interface.</p>

<h4 id="dependency-inversion-principle">Dependency Inversion Principle</h4>

<p>The Dependency Inversion Principle is about removing hard-links between discrete classes so that new functionality can
be leveraged by passing a different class. It states that one should <em>“Depend on Abstractions. Do not depend on
concretions.”</em>. Put simply, this means our dependencies should be interfaces/contracts or abstract classes rather than
concrete implementations. We can easily refactor the above example to follow this principle.</p>

<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="k">namespace</span> <span class="nx">Database</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Database</span>
<span class="p">{</span>
    <span class="k">protected</span> <span class="nv">$adapter</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">(</span><span class="nx">AdapterInterface</span> <span class="nv">$adapter</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">adapter</span> <span class="o">=</span> <span class="nv">$adapter</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">interface</span> <span class="nx">AdapterInterface</span> <span class="p">{}</span>

<span class="k">class</span> <span class="nc">MysqlAdapter</span> <span class="k">implements</span> <span class="nx">AdapterInterface</span> <span class="p">{}</span></code></pre></div>

<p>现在 <code>Database</code> 类依赖于接口，相比依赖于具体实现有更多的优势。</p>

<p>假设你工作的团队中，一位同事负责设计适配器。在第一个例子中，我们需要等待适配器设计完之后才能单元测试。现在由于依赖是一个接口/约定，我们能轻松地模拟接口测试，因为我们知道同事会基于约定实现那个适配器</p>

<p>这种方法的一个更大的好处是代码扩展性变得更高。如果一年之后我们决定要迁移到一种不同的数据库，我们只需要写一个实现相应接口的适配器并且注入进去，由于适配器遵循接口的约定，我们不需要额外的重构。</p>

</section>


<section class="chapter" id="containers">
    <h2 id="containers_title">容器</h2>

<p>你应该明白的第一件事是依赖注入容器和依赖注入不是相同的概念。容器是帮助我们更方便地实现依赖注入的工具，但是他们通常被误用来实现反模式设计：服务定位（Service Location）。把一个依赖注入容器作为服务定位器（ Service Locator）注入进类中隐式地建立了对于容器的依赖，而不是真正需要替换的依赖，而且还会让你的代码更不透明，最终变得更难测试。</p>

<p>大多数现代的框架都有自己的依赖注入容器，允许你通过配置将依赖绑定在一起。这实际上意味着你能写出和框架层同样干净、解耦的应用层代码。</p>

</section>


<section class="chapter" id="further_reading">
    <h2 id="further_reading_title">延伸阅读</h2>

<ul>
  <li><a href="http://ralphschindler.com/2011/05/18/learning-about-dependency-injection-and-php">Learning about Dependency Injection and PHP</a></li>
  <li><a href="http://fabien.potencier.org/article/11/what-is-dependency-injection">What is Dependency Injection?</a></li>
  <li><a href="https://mwop.net/blog/260-Dependency-Injection-An-analogy.html">Dependency Injection: An analogy</a></li>
  <li><a href="https://net.tutsplus.com/tutorials/php/dependency-injection-huh/">Dependency Injection: Huh?</a></li>
  <li><a href="https://philipobenito.github.io/dependency-injection-as-a-tool-for-testing/">Dependency Injection as a tool for testing</a></li>
</ul>

</section>

<div class="back-to-top"><p><a href="#top" class="top">回到顶部</a></p>
</div>
<section class="chapter" id="databases">
    <h1 id="databases_title">数据库</h1>

<p>绝大多数时候你的 PHP 程序都需要使用数据库来长久地保存数据。这时你有一些不同的选择可以来连接并与数据库进行交互。在 <strong>PHP 5.1.0 之前</strong>，我们推荐的方式是使用例如 <a href="https://secure.php.net/mysqli">mysqli</a>，<a href="https://secure.php.net/pgsql">pgsql</a>，<a href="https://secure.php.net/mssql">mssql</a> 等原生驱动。</p>

<p>原生驱动是在只使用 <em>一个</em> 数据库的情况下的不错的方式，但如果，举个例子来说，你同时使用了 MySQL 和一点点 MSSQL，或者你需要使用 Oracle 的数据库，那你就不能够只使用一个数据库驱动了。你需要为每一个数据库去学习各自不同的 API — 这样做显然不科学。</p>


</section>


<section class="chapter" id="mysql_extension">
    <h2 id="mysql_extension_title">MySQL 扩展</h2>

<p><a href="https://secure.php.net/mysqli">mysql</a> 非常古老，并且已经被以下两个扩展取代：</p>

<ul>
  <li><a href="https://secure.php.net/mysqli">mysqli</a></li>
  <li><a href="https://secure.php.net/pdo">pdo</a></li>
</ul>

<p>PHP 中的 <a href="https://secure.php.net/mysqli">mysql</a> 扩展已经不再进行新的开发了，<a href="https://secure.php.net/migration55.deprecated">在 PHP 5.5.0 版本中正式标记为废弃</a>，并在 <strong><a href="https://secure.php.net/manual/migration70.removed-exts-sapis.php">7.0 正式被移除</a></strong> 。</p>

<p>想要辨别 <code>mysql</code> 是否被使用，你不需要到 <code>php.ini</code> 去查看。只需要使用编辑器打开你的项目，然后全局搜索 <code>mysql_*</code>
，如果有类似 <code>mysql_connect()</code> 或者 <code>mysql_query()</code> 方法出现，那么你就使用了 <code>mysql</code>。</p>

<p>如果因为特别原因还未考虑升级到 PHP 7.x 的话，可以考虑使用 <a href="https://secure.php.net/mysqli">mysqli</a> 或者 <a href="https://secure.php.net/pdo">PDO</a> 来临时解决问题。</p>

<p><strong>如果你是从 <a href="https://secure.php.net/mysqli">mysql</a> 升级到 <a href="https://secure.php.net/mysqli">mysqli</a>，请尽量不要使用全局替换 <code>mysql_*</code> 为 <code>mysqli_*</code>。你会错过 mysqli 提供的一些优秀特性，如数据参数绑定，此功能能有效的防止 SQL 注入攻击。<a href="https://secure.php.net/pdo">PDO</a> 也提供此功能。</strong></p>

<ul>
  <li><a href="https://websitebeaver.com/prepared-statements-in-php-mysqli-to-prevent-sql-injection">MySQLi Prepared Statements</a></li>
  <li><a href="https://secure.php.net/mysqlinfo.api.choosing">PHP: Choosing an API for MySQL</a></li>
  <li><a href="http://wiki.hashphp.org/PDO_Tutorial_for_MySQL_Developers">PDO Tutorial for MySQL Developers</a></li>
</ul>


</section>


<section class="chapter" id="pdo_extension">
    <h2 id="pdo_extension_title">PDO 扩展</h2>

<p><a href="https://secure.php.net/pdo">PDO</a> 是一个数据库连接抽象类库 — 自 5.1.0 版本起内置于 PHP 当中 — 它提供了一个通用的接口来与不同的数据库进行交互。比如你可以使用相同的简单代码来连接 MySQL 或是 SQLite：</p>

<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="c1">// PDO + MySQL</span>
<span class="nv">$pdo</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PDO</span><span class="p">(</span><span class="s1">'mysql:host=example.com;dbname=database'</span><span class="p">,</span> <span class="s1">'user'</span><span class="p">,</span> <span class="s1">'password'</span><span class="p">);</span>
<span class="nv">$statement</span> <span class="o">=</span> <span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span><span class="s2">"SELECT some_field FROM some_table"</span><span class="p">);</span>
<span class="nv">$row</span> <span class="o">=</span> <span class="nv">$statement</span><span class="o">-&gt;</span><span class="na">fetch</span><span class="p">(</span><span class="nx">PDO</span><span class="o">::</span><span class="na">FETCH_ASSOC</span><span class="p">);</span>
<span class="k">echo</span> <span class="nb">htmlentities</span><span class="p">(</span><span class="nv">$row</span><span class="p">[</span><span class="s1">'some_field'</span><span class="p">]);</span>

<span class="c1">// PDO + SQLite</span>
<span class="nv">$pdo</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PDO</span><span class="p">(</span><span class="s1">'sqlite:/path/db/foo.sqlite'</span><span class="p">);</span>
<span class="nv">$statement</span> <span class="o">=</span> <span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span><span class="s2">"SELECT some_field FROM some_table"</span><span class="p">);</span>
<span class="nv">$row</span> <span class="o">=</span> <span class="nv">$statement</span><span class="o">-&gt;</span><span class="na">fetch</span><span class="p">(</span><span class="nx">PDO</span><span class="o">::</span><span class="na">FETCH_ASSOC</span><span class="p">);</span>
<span class="k">echo</span> <span class="nb">htmlentities</span><span class="p">(</span><span class="nv">$row</span><span class="p">[</span><span class="s1">'some_field'</span><span class="p">]);</span></code></pre></div>

<p>PDO 并不会对 SQL 请求进行转换或者模拟实现并不存在的功能特性；它只是单纯地使用相同的 API 连接不同种类的数据库。</p>

<p>更重要的是，<code>PDO</code> 使你能够安全的插入外部输入(例如 ID)到你的 SQL 请求中而不必担心 SQL 注入的问题。这可以通过使用 PDO 语句和限定参数来实现。</p>

<p>我们来假设一个 PHP 脚本接收一个数字 ID 作为一个请求参数。这个 ID 应该被用来从数据库中取出一条用户记录。下面是一个<code>错误</code>的做法：</p>

<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="nv">$pdo</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PDO</span><span class="p">(</span><span class="s1">'sqlite:/path/db/users.db'</span><span class="p">);</span>
<span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span><span class="s2">"SELECT name FROM users WHERE id = "</span> <span class="o">.</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">'id'</span><span class="p">]);</span> <span class="c1">// &lt;-- NO!</span></code></pre></div>

<p>这是一段糟糕的代码。你正在插入一个原始的请求参数到 SQL 请求中。这将让被黑客轻松地利用[SQL 注入]方式进行攻击。想一下如果黑客将一个构造的 <code>id</code> 参数通过像 <code>http://domain.com/?id=1%3BDELETE+FROM+users</code> 这样的 URL 传入。这将会使 <code>$_GET['id']</code> 变量的值被设为 <code>1;DELETE
FROM users</code> 然后被执行从而删除所有的 user 记录！因此，你应该使用 PDO 限制参数来过滤 ID 输入。</p>

<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="nv">$pdo</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PDO</span><span class="p">(</span><span class="s1">'sqlite:/path/db/users.db'</span><span class="p">);</span>
<span class="nv">$stmt</span> <span class="o">=</span> <span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">prepare</span><span class="p">(</span><span class="s1">'SELECT name FROM users WHERE id = :id'</span><span class="p">);</span>
<span class="nv">$id</span> <span class="o">=</span> <span class="nb">filter_input</span><span class="p">(</span><span class="nx">INPUT_GET</span><span class="p">,</span> <span class="s1">'id'</span><span class="p">,</span> <span class="nx">FILTER_SANITIZE_NUMBER_INT</span><span class="p">);</span> <span class="c1">// &lt;-- filter your data first (see [Data Filtering](#data_filtering)), especially important for INSERT, UPDATE, etc.</span>
<span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">bindParam</span><span class="p">(</span><span class="s1">':id'</span><span class="p">,</span> <span class="nv">$id</span><span class="p">,</span> <span class="nx">PDO</span><span class="o">::</span><span class="na">PARAM_INT</span><span class="p">);</span> <span class="c1">// &lt;-- Automatically sanitized for SQL by PDO</span>
<span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">();</span></code></pre></div>

<p>这是正确的代码。它在一条 PDO 语句中使用了一个限制参数。这将对外部 ID 输入在发送给数据库之前进行转义来防止潜在的 SQL 注入攻击。</p>

<p>对于写入操作，例如 INSERT 或者 UPDATE，进行<a href="#data_filtering">数据过滤</a>并对其他内容进行清理（去除 HTML 标签，Javascript 等等）是尤其重要的。PDO 只会为 SQL 进行清理，并不会为你的应用做任何处理。</p>

<ul>
  <li><a href="https://secure.php.net/book.pdo">了解 PDO</a></li>
</ul>

<p>你也应该知道数据库连接有时会耗尽全部资源，如果连接没有被隐式地关闭的话，有可能会造成可用资源枯竭的情况。不过这通常在其他语言中更为常见一些。使用 PDO 你可以通过销毁（destroy）对象，也就是将值设为 NULL，来隐式地关闭这些连接，确保所有剩余的引用对象的连接都被删除。如果你没有亲自做这件事情，PHP 会在你的脚本结束的时候自动为你完成 —— 除非你使用的是持久链接。</p>

<ul>
  <li><a href="https://secure.php.net/pdo.connections">了解 PDO 连接</a></li>
</ul>


</section>


<section class="chapter" id="databases_interacting">
    <h2 id="databases_interacting_title">数据库交互</h2>

<p>当开发者第一次接触 PHP 时，通常会使用类似下面的代码来将数据库的交互与表示层逻辑混在一起：</p>

<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="nt">&lt;ul&gt;</span>
<span class="cp">&lt;?php</span>
<span class="k">foreach</span> <span class="p">(</span><span class="nv">$db</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span><span class="s1">'SELECT * FROM table'</span><span class="p">)</span> <span class="k">as</span> <span class="nv">$row</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="s2">"&lt;li&gt;"</span><span class="o">.</span><span class="nv">$row</span><span class="p">[</span><span class="s1">'field1'</span><span class="p">]</span><span class="o">.</span><span class="s2">" - "</span><span class="o">.</span><span class="nv">$row</span><span class="p">[</span><span class="s1">'field1'</span><span class="p">]</span><span class="o">.</span><span class="s2">"&lt;/li&gt;"</span><span class="p">;</span>
<span class="p">}</span>
<span class="cp">?&gt;</span>
<span class="nt">&lt;/ul&gt;</span></code></pre></div>

<p>这从很多方面来看都是错误的做法，主要是由于它不易阅读又难以测试和调试。而且如果你不加以限制的话，它会输出非常多的字段。</p>

<p>其实还有许多不同的解决方案来完成这项工作 — 取决于你倾向于 <a href="/#object-oriented-programming">面向对象编程（OOP）</a>还是<a href="/#functional-programming">函数式编程</a> — 但必须有一些分离的元素。</p>

<p>来看一下最基本的做法：</p>

<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="k">function</span> <span class="nf">getAllFoos</span><span class="p">(</span><span class="nv">$db</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nv">$db</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span><span class="s1">'SELECT * FROM table'</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">foreach</span> <span class="p">(</span><span class="nx">getAllFoos</span><span class="p">(</span><span class="nv">$db</span><span class="p">)</span> <span class="k">as</span> <span class="nv">$row</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="s2">"&lt;li&gt;"</span><span class="o">.</span><span class="nv">$row</span><span class="p">[</span><span class="s1">'field1'</span><span class="p">]</span><span class="o">.</span><span class="s2">" - "</span><span class="o">.</span><span class="nv">$row</span><span class="p">[</span><span class="s1">'field1'</span><span class="p">]</span><span class="o">.</span><span class="s2">"&lt;/li&gt;"</span><span class="p">;</span> <span class="c1">// BAD!!</span>
<span class="p">}</span></code></pre></div>

<p>这是一个不错的开头。将这两个元素放入了两个不同的文件于是你得到了一些干净的分离。</p>

<p>创建一个类来放置上面的函数，你就得到了一个「Model」。创建一个简单的<code>.php</code>文件来存放表示逻辑，你就得到了一个「View」。这已经很接近 <a href="https://code.tutsplus.com/tutorials/mvc-for-noobs--net-10488">MVC</a> — 一个大多数<a href="/#frameworks">框架</a>常用的面向对象的架构。</p>

<p><strong>foo.php</strong></p>

<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="nv">$db</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PDO</span><span class="p">(</span><span class="s1">'mysql:host=localhost;dbname=testdb;charset=utf8'</span><span class="p">,</span> <span class="s1">'username'</span><span class="p">,</span> <span class="s1">'password'</span><span class="p">);</span>

<span class="c1">// Make your model available</span>
<span class="k">include</span> <span class="s1">'models/FooModel.php'</span><span class="p">;</span>

<span class="c1">// Create an instance</span>
<span class="nv">$fooModel</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">FooModel</span><span class="p">(</span><span class="nv">$db</span><span class="p">);</span>
<span class="c1">// Get the list of Foos</span>
<span class="nv">$fooList</span> <span class="o">=</span> <span class="nv">$fooModel</span><span class="o">-&gt;</span><span class="na">getAllFoos</span><span class="p">();</span>

<span class="c1">// Show the view</span>
<span class="k">include</span> <span class="s1">'views/foo-list.php'</span><span class="p">;</span></code></pre></div>

<p><strong>models/FooModel.php</strong></p>

<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="k">class</span> <span class="nc">FooModel</span>
<span class="p">{</span>
    <span class="k">protected</span> <span class="nv">$db</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">(</span><span class="nx">PDO</span> <span class="nv">$db</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">db</span> <span class="o">=</span> <span class="nv">$db</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">getAllFoos</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">db</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span><span class="s1">'SELECT * FROM table'</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></div>

<p><strong>views/foo-list.php</strong></p>

<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span> <span class="k">foreach</span> <span class="p">(</span><span class="nv">$fooList</span> <span class="k">as</span> <span class="nv">$row</span><span class="p">)</span><span class="o">:</span> <span class="cp">?&gt;</span>
    <span class="cp">&lt;?=</span> <span class="nv">$row</span><span class="p">[</span><span class="s1">'field1'</span><span class="p">]</span> <span class="cp">?&gt;</span> - <span class="cp">&lt;?=</span> <span class="nv">$row</span><span class="p">[</span><span class="s1">'field1'</span><span class="p">]</span> <span class="cp">?&gt;</span>
<span class="cp">&lt;?php</span> <span class="k">endforeach</span> <span class="cp">?&gt;</span></code></pre></div>

<p>向大多数现代框架的做法学习是很有必要的，尽管多了一些手动的工作。你可以并不需要每一次都完全这么做，但将太多的表示逻辑层代码和数据库交互掺杂在一些将会为你在想要对程序进行<a href="/#unit-testing">单元测试</a>时带来真正的麻烦。</p>

<p><a href="https://phpbridge.org/docs/">PHPBridge</a> 具有一项非常棒的资源叫做<a href="https://phpbridge.org/intro-to-php/creating_a_data_class">创建一个数据类</a>。它包含了非常相似的逻辑而且非常适合刚刚习惯数据库交互概念的开发者使用。</p>


</section>


<section class="chapter" id="databases_abstraction_layers">
    <h2 id="databases_abstraction_layers_title">数据库抽象层</h2>

<p>许多框架都提供了自己的数据库抽象层，其中一些是设计在 <a href="https://secure.php.net/book.pdo">PDO</a> 的上层的。这些抽象层通常将你的请求在 PHP 方法中包装起来，通过模拟的方式来使你的数据库拥有一些之前不支持的功能。这种抽象是真正的数据库抽象，而不单单只是 PDO 提供的数据库连接抽象。这类抽象的确会增加一定程度的性能开销，但如果你正在设计的应用程序需要同时使用 MySQL，PostgreSQL 和 SQLite 时，一点点的额外性能开销对于代码整洁度的提高来说还是很值得的。</p>

<p>有一些抽象层使用的是<a href="https://www.php-fig.org/psr/psr-0/">PSR-0</a> 或 <a href="https://www.php-fig.org/psr/psr-4/">PSR-4</a> 命名空间标准，所以他们可以安装在任何你需要的应用程序中。</p>

<ul>
  <li><a href="https://github.com/auraphp/Aura.Sql">Aura SQL</a></li>
  <li><a href="https://www.doctrine-project.org/projects/dbal.html">Doctrine2 DBAL</a></li>
  <li><a href="http://propelorm.org/">Propel</a></li>
  <li><a href="https://packages.zendframework.com/docs/latest/manual/en/index.html#zendframework/zend-db">Zend-db</a></li>
</ul>


</section>

<div class="back-to-top"><p><a href="#top" class="top">回到顶部</a></p>
</div>
<section class="chapter" id="templating">
    <h1 id="templating_title">使用模板</h1>

<p>模板提供了一种简便的方式，将展现逻辑从控制器和业务逻辑中分离出来。</p>

<p>一般来说，模板包含应用程序的 HTML 代码，但也可以使用其他的格式，例如 XML 。</p>

<p>模板通常也被称为「视图」, 而它是 <a href="/pages/Design-Patterns.html#model-view-controller">模型-视图-控制器</a> (MVC) 软件架构模式第二个元素的 <strong>一部份</strong> 。</p>

</section>


<section class="chapter" id="templating_benefits">
    <h2 id="templating_benefits_title">好处</h2>

<p>使用模板的主要好处是可以将呈现逻辑与应用程序的其他部分进行分离。模板的单一职责就是呈现格式化后的内容。它不负责数据的查询，保存或是其他复杂的任务。进一步促成了更干净、更具可读性的代码，在团队协作开发中尤其有用，开发者可以专注服务端的代码（控制器、模型），而设计师负责客户端代码 (网页) 。</p>

<p>模板同时也改善了前端代码的组织架构。一般来说，模板放置在「视图」文件夹中，每一个模板都放在独立的一个文件中。这种方式鼓励代码重用，它将大块的代码拆成较小的、可重用的片段，通常称为局部模板。举例来说，网站的头、尾区块可以各自定义为一个模板，之后将它们放在每一个页面模板的上、下位置。</p>

<p>最后，根据你选择的类库，模板可以通过自动转义用户的内容，从而带来更多的安全性。有些类库甚至提供沙箱机制，模板设计者只能使用在白名单中的变量和函数。</p>

</section>


<section class="chapter" id="plain_php_templates">
    <h2 id="plain_php_templates_title">原生 PHP 模板</h2>

<p>原生 PHP 模板就是指直接用 PHP 来写模板，这是很自然的选择，因为 PHP 本身其实是个模板语言。这代表你可以在其他的语言中结合 PHP 使用，比如 HTML 。这对 PHP 开发者相当有利，因为不需要额外学习新的语法，他们熟知可以使用的函数，并且使用的编辑器也已经内置了语法高亮和自动补全。此外，原生的 PHP 模板没有了编译阶段，速度会更快。</p>

<p>现今的 PHP 框架都会使用一些模板系统，这当中多数是使用原生的 PHP 语法。在框架之外，一些类库比如 <a href="http://platesphp.com/">Plates</a> 或 <a href="https://github.com/auraphp/Aura.View">Aura.View</a>，提供了现代化模板的常见功能，比如继承、布局、扩展，让原生的 PHP 模板更容易使用。</p>

<h3 id="php-">原生 PHP 模板的简单示例</h3>

<p>使用 <a href="http://platesphp.com/">Plates</a> 类库。</p>

<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span> <span class="c1">// user_profile.php ?&gt;</span>

<span class="o">&lt;?</span><span class="nx">php</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">insert</span><span class="p">(</span><span class="s1">'header'</span><span class="p">,</span> <span class="p">[</span><span class="s1">'title'</span> <span class="o">=&gt;</span> <span class="s1">'User Profile'</span><span class="p">])</span> <span class="cp">?&gt;</span>

<span class="nt">&lt;h1&gt;</span>User Profile<span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;p&gt;</span>Hello, <span class="cp">&lt;?=</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">escape</span><span class="p">(</span><span class="nv">$name</span><span class="p">)</span><span class="cp">?&gt;</span><span class="nt">&lt;/p&gt;</span>

<span class="cp">&lt;?php</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">insert</span><span class="p">(</span><span class="s1">'footer'</span><span class="p">)</span> <span class="cp">?&gt;</span></code></pre></div>

<h3 id="php--1">原生 PHP 模板使用继承的示例</h3>

<p>使用 <a href="http://platesphp.com/">Plates</a> 类库。</p>

<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span> <span class="c1">// template.php ?&gt;</span>

<span class="o">&lt;</span><span class="nx">html</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="nx">head</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">title</span><span class="o">&gt;&lt;?=</span><span class="nv">$title</span><span class="cp">?&gt;</span><span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>

<span class="nt">&lt;main&gt;</span>
    <span class="cp">&lt;?=</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">section</span><span class="p">(</span><span class="s1">'content'</span><span class="p">)</span><span class="cp">?&gt;</span>
<span class="nt">&lt;/main&gt;</span>

<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span></code></pre></div>

<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span> <span class="c1">// user_profile.php ?&gt;</span>

<span class="o">&lt;?</span><span class="nx">php</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">layout</span><span class="p">(</span><span class="s1">'template'</span><span class="p">,</span> <span class="p">[</span><span class="s1">'title'</span> <span class="o">=&gt;</span> <span class="s1">'User Profile'</span><span class="p">])</span> <span class="cp">?&gt;</span>

<span class="nt">&lt;h1&gt;</span>User Profile<span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;p&gt;</span>Hello, <span class="cp">&lt;?=</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">escape</span><span class="p">(</span><span class="nv">$name</span><span class="p">)</span><span class="cp">?&gt;</span><span class="nt">&lt;/p&gt;</span></code></pre></div>


</section>


<section class="chapter" id="compiled_templates">
    <h2 id="compiled_templates_title">编译模板</h2>

<p>尽管 PHP 不断升级为成熟的、面向对象的语言，但它作为模板语言 <a href="http://fabien.potencier.org/article/34/templating-engines-in-php">没有改善多少</a>。编译模板，比如 <a href="https://github.com/box/brainy">Twig</a> 或 <a href="https://www.smarty.net/">Smarty</a>* ，提供了模板专用的新语法，填补了这片空白。从自动转义到继承以及简化控制结构，编译模板设计地更容易编写，可读性更高，同时使用上也更加的安全。编译模板甚至可以在不同的语言中使用，<a href="https://mustache.github.io/">Mustache</a> 就是一个很好的例子。由于这些模板需要编译，在性能上会带来一些轻微的影响，不过如果适当的使用缓存，影响就变得非常小了。</p>

<p><em>*虽然 Smarty 提供了自动转义的功能, 不过这个功能默认是关闭的</em></p>

<h3 id="section">编译模板简单示例</h3>

<p>使用 <a href="https://twig.symfony.com/">Twig</a> 类库。</p>

<div class="highlight"><pre><code class="language-html-jinja" data-lang="html+jinja">{% include 'header.html' with {'title': 'User Profile'} %}

&lt;h1&gt;User Profile&lt;/h1&gt;
&lt;p&gt;Hello, {{ name }}&lt;/p&gt;

{% include 'footer.html' %}</code></pre></div>

<h3 id="section-1">编译模板使用继承示例</h3>

<p>使用 <a href="https://twig.symfony.com/">Twig</a> 类库。</p>

<div class="highlight"><pre><code class="language-html-jinja" data-lang="html+jinja">// template.html

&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;{% block title %}{% endblock %}&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;

&lt;main&gt;
    {% block content %}{% endblock %}
&lt;/main&gt;

&lt;/body&gt;
&lt;/html&gt;</code></pre></div>

<div class="highlight"><pre><code class="language-html-jinja" data-lang="html+jinja">// user_profile.html

{% extends "template.html" %}

{% block title %}User Profile{% endblock %}
{% block content %}
    &lt;h1&gt;User Profile&lt;/h1&gt;
    &lt;p&gt;Hello, {{ name }}&lt;/p&gt;
{% endblock %}</code></pre></div>


</section>


<section class="chapter" id="templating_further_reading">
    <h2 id="templating_further_reading_title">延伸阅读</h2>

<h3 id="section">文章与教程</h3>

<ul>
  <li><a href="http://fabien.potencier.org/article/34/templating-engines-in-php">Templating Engines in PHP</a></li>
  <li><a href="https://code.tutsplus.com/tutorials/an-introduction-to-views-templating-in-codeigniter--net-25648">An Introduction to Views &amp; Templating in CodeIgniter</a></li>
  <li><a href="https://www.smashingmagazine.com/2011/10/getting-started-with-php-templating/">Getting Started With PHP Templating</a></li>
  <li><a href="https://code.tutsplus.com/tutorials/roll-your-own-templating-system-in-php--net-16596">Roll Your Own Templating System in PHP</a></li>
  <li><a href="https://laracasts.com/series/laravel-from-scratch/episodes/7">Master Pages</a></li>
  <li><a href="https://code.tutsplus.com/tutorials/working-with-templates-in-symfony-2--cms-21172">Working With Templates in Symfony 2</a></li>
  <li><a href="https://github.com/box/brainy/wiki/Writing-Safe-Templates">Writing Safer Templates</a></li>
</ul>

<h3 id="section-1">类库</h3>

<ul>
  <li><a href="https://github.com/auraphp/Aura.View">Aura.View</a> <em>(native)</em></li>
  <li><a href="https://laravel.com/docs/blade">Blade</a> <em>(compiled, framework specific)</em></li>
  <li><a href="https://github.com/box/brainy">Brainy</a> <em>(compiled)</em></li>
  <li><a href="http://dwoo.org/">Dwoo</a> <em>(compiled)</em></li>
  <li><a href="https://github.com/nette/latte">Latte</a> <em>(compiled)</em></li>
  <li><a href="https://github.com/bobthecow/mustache.php">Mustache</a> <em>(compiled)</em></li>
  <li><a href="https://phptal.org/">PHPTAL</a> <em>(compiled)</em></li>
  <li><a href="http://platesphp.com/">Plates</a> <em>(native)</em></li>
  <li><a href="https://www.smarty.net/">Smarty</a> <em>(compiled)</em></li>
  <li><a href="https://twig.symfony.com/">Twig</a> <em>(compiled)</em></li>
  <li><a href="https://framework.zend.com/manual/2.3/en/modules/zend.view.quick-start.html">Zend\View</a> <em>(native, framework specific)</em></li>
</ul>

</section>

<div class="back-to-top"><p><a href="#top" class="top">回到顶部</a></p>
</div>
<section class="chapter" id="errors_and_exceptions">
    <h1 id="errors_and_exceptions_title">错误与异常</h1>


</section>


<section class="chapter" id="errors">
    <h2 id="errors_title">错误</h2>

<p>在许多「重异常」(exception-heavy) 的编程语言中，一旦发生错误，就会抛出异常。这确实是一个可行的方式。不过 PHP 却是一个 「轻异常」(exception-light) 的语言。当然它确实有异常机制，在处理对象时，核心也开始采用这个机制来处理，只是 PHP 会尽可能的执行而无视发生的事情，除非是一个严重错误。</p>

<p>举例来说:</p>

<div class="highlight"><pre><code class="language-console" data-lang="console"><span class="gp">$</span> php <span class="nt">-a</span>
<span class="gp">php &gt;</span> <span class="nb">echo</span> <span class="nv">$foo</span><span class="p">;</span>
<span class="go">Notice: Undefined variable: foo in php shell code on line 1</span></code></pre></div>

<p>这里只是一个 notice 级别的错误，PHP 仍然会愉快的继续执行。这对有「重异常」编程经验的人来说会带来困惑，例如在 Python 中，引用一个不存在的变量会抛出异常：</p>

<div class="highlight"><pre><code class="language-console" data-lang="console"><span class="gp">$</span> python
<span class="gp">&gt;</span><span class="o">&gt;&gt;</span> print foo
<span class="go">Traceback (most recent call last):
</span><span class="gp">  File "&lt;stdin&gt;</span><span class="s2">", line 1, in &lt;module&gt;
</span><span class="go">NameError: name 'foo' is not defined</span></code></pre></div>

<p>本质上的差异在于 Python 会对任何小错误进行抛错，因此开发人员可以确信任何潜在的问题或者边缘的案例都可以被捕捉到，与此同时 PHP 仍然会保持执行，除非极端的问题发生才会抛出异常。</p>

<h3 id="section">错误严重性</h3>

<p>PHP 有几个错误严重性等级。三个最常见的的信息类型是错误（error）、通知（notice）和警告（warning）。它们有不同的严重性: <code>E_ERROR</code> 、<code>E_NOTICE</code>和 <code>E_WARNING</code>。错误是运行期间的严重问题，通常是因为代码出错而造成，必须要修正它，否则会使 PHP 停止执行。通知是建议性质的信息，是因为程序代码在执行期有可能造成问题，但程序不会停止。
警告是非致命错误，程序执行也不会因此而中止。</p>

<p>另一个在编译期间会报错的信息类型是 <code>E_STRICT</code>。这个信息用來建议修改程序代码以维持最佳的互通性并能与今后的 PHP 版本兼容。</p>

<h3 id="php-">更改 PHP 错误报告行为</h3>

<p>错误报告可以由 PHP 配置及函数调用改变。使用 PHP 内置的函数 <code>error_reporting()</code>，可以设定程序执行期间的错误等级，方法是传入预定义的错误等级常量，意味着如果你只想看到警告和错误（而非通知），你可以这样设定：</p>

<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="nb">error_reporting</span><span class="p">(</span><span class="k">E_ERROR</span> <span class="o">|</span> <span class="k">E_WARNING</span><span class="p">);</span></code></pre></div>

<p>你也可以控制错误是否在屏幕上显示 （开发时比较有用）或隐藏后记录日志 （适用于正式环境）。如果想知道更多细节，可以查看 <a href="errorreport">错误报告</a> 章节。</p>

<h3 id="section-1">行内错误抑制</h3>

<p>你可以让 PHP 利用错误控制操作符 <code>@</code> 来抑制特定的错误。将这个操作符放置在表达式之前，其后的任何错误都不会出现。</p>

<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="k">echo</span> <span class="o">@</span><span class="nv">$foo</span><span class="p">[</span><span class="s1">'bar'</span><span class="p">];</span></code></pre></div>

<p>如果 <code>$foo['bar']</code> 存在，程序会将结果输出，如果变量 <code>$foo</code> 或是 <code>'bar'</code> 键值不存在，则会返回 null 并且不输出任何东西。如果不使用错误控制操作符，这个表达式会产生一个错误信息 <code>PHP Notice: Undefined
variable: foo</code> 或 <code>PHP Notice: Undefined index: bar</code> 。</p>

<p>这看起来像是个好主意，不过也有一些讨厌的代价。PHP 处理使用 <code>@</code> 的表达式比起不用时效率会低一些。过早的性能优化在所有程序语言中也许都是争论点，不过如果性能在你的应用程序 / 类库中占有重要地位，那么了解错误控制操作符的性能影响就比较重要。</p>

<p>其次，错误控制操作符会 <strong>完全</strong> 吃掉错误。不但没有显示，而且也不会记录在错误日志中。此外，在正式环境中 PHP 也没有办法关闭错误控制操作符。也许你认为那些错误时无害的，不过那些较具伤害性的错误同时也会被隐藏。</p>

<p>如果有方法可以避免错误抑制符，你应该考虑使用，举例来说，上面的程序代码可以这样重写：</p>

<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="c1">//Null Coalescing Operator</span>
<span class="k">echo</span> <span class="nv">$foo</span><span class="p">[</span><span class="s1">'bar'</span><span class="p">]</span> <span class="o">??</span> <span class="s1">''</span><span class="p">;</span></code></pre></div>

<p>当 <code>fopen()</code> 载入文件失败时，也许是一个使用错误抑制符的合理例子。你可以在尝试载入文件前检查是否存在，但是如果这个文件在检查后才被删除，而此时 <code>fopen()</code> 还未执行 （听起来有点不太可能，但是确实会发生），这时 <code>fopen()</code> 会返回 false <em>并且</em> 抛出操作。这也许应该由 PHP 本身来解决，但这时一个错误抑制符才能有效解决的例子。</p>

<p>前面我们提到在正式的 PHP 环境中没有办法关闭错误控制操作符。但是 <a href="https://xdebug.org/docs/basic">Xdebug</a> 有一个 <code>xdebug.scream</code> 的 ini 配置项，可以关闭错误控制操作符。你可以按照下面的方式修改 <code>php.ini</code>。</p>

<div class="highlight"><pre><code class="language-ini" data-lang="ini"><span class="py">xdebug.scream</span> <span class="p">=</span> <span class="s">On</span></code></pre></div>

<p>你也可以在执行期间通过 <code>ini_set</code> 函数来设置这个值：</p>

<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="nb">ini_set</span><span class="p">(</span><span class="s1">'xdebug.scream'</span><span class="p">,</span> <span class="s1">'1'</span><span class="p">)</span></code></pre></div>

<p>「Scream」这个 PHP 扩展提供了和 xDebug 类似的功能，只是 Scream 的 ini 设置项叫做 <code>scream.enabled</code> 。</p>

<p>当你在调试代码而错误信息被隐藏时，这是最有用的方法。请务必小心使用 scream ，而是把它当作暂时性的调试工具。有许多的 PHP 函数类库代码也许无法在错误抑制操作符停用时正常使用。</p>

<ul>
  <li><a href="https://secure.php.net/language.operators.errorcontrol">Error Control Operators</a></li>
  <li><a href="https://www.sitepoint.com/">SitePoint</a></li>
  <li><a href="https://xdebug.org/docs/basic">Xdebug</a></li>
  <li><a href="https://secure.php.net/book.scream">Scream</a></li>
</ul>

<h3 id="section-2">错误异常类</h3>

<p>PHP 可以完美化身为「重异常」的程序语言，只需要几行代码就能切换过去。基本上你可以利用 <code>ErrorException</code> 类抛出「错误」来当做「异常」，这个类是继承自 <code>Exception</code> 类。</p>

<p>这在大量的现代框架中是一个常见的做法，比如 Symfony 和 Laravel。如果开启调试模式，或者进入开发环境的话，这两个框架都会将显示美观清晰的 <em>调用栈</em>。</p>

<p>There are also some packages available for better error and exception handling and reporting. Like <a href="https://filp.github.io/whoops/">Whoops!</a>, which comes with the default installation of Laravel and can be used in any framework as well.</p>

<p>在开发过程中将错误当作异常抛出可以更好的处理它，如果在开发时发生异常，你可以将它包在一个 catch 语句中具体说明这种情况如何处理。每捕捉一个异常，都会使你的应用程序越来越健壮。</p>

<p>更多关于如何使用 <code>ErrorException</code> 来处理错误的细节，可以参考 <a href="errorexception">ErrorException Class</a>。</p>

<ul>
  <li><a href="https://secure.php.net/language.operators.errorcontrol">Error Control Operators</a></li>
  <li><a href="https://secure.php.net/errorfunc.constants">Predefined Constants for Error Handling</a></li>
  <li><a href="https://secure.php.net/function.error-reporting"><code>error_reporting()</code></a></li>
  <li><a href="/#error_reporting">Reporting</a></li>
</ul>


</section>


<section class="chapter" id="exceptions">
    <h2 id="exceptions_title">异常</h2>

<p>异常是许多流行编程语言的标配，但它们往往被 PHP 开发人员所忽视。像 Ruby 就是一个极度重视异常的语言，无论有什么错误发生，像是 HTTP 请求失败，或者数据库查询有问题，甚至找不到一个图片资源，Ruby （或是所使用的 gems），将会抛出异常，你可以通过屏幕立刻知道所发生的问题。</p>

<p>PHP 处理这个问题则比较随意，调用 <code>file_get_contents()</code> 函数通常只会给出 <code>FALSE</code> 值和警告。许多较早的 PHP 框架比如 CodeIgniter 只是返回 false，将信息写入专有的日志，或者让你使用类似 <code>$this-&gt;upload-&gt;get_error()</code> 的方法来查看错误原因。这里的问题在于你必须找出错误所在，并且通过翻阅文档来查看这个类使用了什么样的错误的方法，而不是明确的暴露错误。</p>

<p>另一个问题发生在当类自动抛出错误到屏幕时会结束程序。这样做会阻挡其他开发者动态处理错误的机会。应该抛出异常让开发人员意识到错误的存在，让他们可以选择处理的方式，例如：</p>

<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="nv">$email</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Fuel\Email</span><span class="p">;</span>
<span class="nv">$email</span><span class="o">-&gt;</span><span class="na">subject</span><span class="p">(</span><span class="s1">'My Subject'</span><span class="p">);</span>
<span class="nv">$email</span><span class="o">-&gt;</span><span class="na">body</span><span class="p">(</span><span class="s1">'How the heck are you?'</span><span class="p">);</span>
<span class="nv">$email</span><span class="o">-&gt;</span><span class="na">to</span><span class="p">(</span><span class="s1">'guy@example.com'</span><span class="p">,</span> <span class="s1">'Some Guy'</span><span class="p">);</span>

<span class="k">try</span>
<span class="p">{</span>
    <span class="nv">$email</span><span class="o">-&gt;</span><span class="na">send</span><span class="p">();</span>
<span class="p">}</span>
<span class="k">catch</span><span class="p">(</span><span class="nx">Fuel\Email\ValidationFailedException</span> <span class="nv">$e</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// 验证失败</span>
<span class="p">}</span>
<span class="k">catch</span><span class="p">(</span><span class="nx">Fuel\Email\SendingFailedException</span> <span class="nv">$e</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// 这个驱动无法发送 email</span>
<span class="p">}</span>
<span class="nx">finally</span>
<span class="p">{</span>
    <span class="c1">// 无论抛出什么样的异常都会执行，并且在正常程序继续之前执行</span>
<span class="p">}</span></code></pre></div>

<h3 id="spl-">SPL 异常</h3>

<p>原生的 <code>Exception</code> 类并没有提供太多的调试情境给开发人员，不过可以通过建立一个特殊的 <code>Exception</code> 来弥补它，方式就是建立一个继承自原生 <code>Exception</code> 类的一个子类：</p>

<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="k">class</span> <span class="nc">ValidationException</span> <span class="k">extends</span> <span class="nx">Exception</span> <span class="p">{}</span></code></pre></div>

<p>如此一来，可以加入多个 catch 区块，并且根据不同的异常分别处理。通过这样可以建立 <em>许多</em>自定义异常，其中有些已经在 <a href="/#standard_php_library">SPL 扩展</a> 提供的 SPL 异常中定义了。</p>

<p>举例来说，如果你使用了 <code>__call()</code> 魔术方法去调用一个无效的方法，而不是抛出一个模糊的标准 Exception 或是建立自定义的异常处理，你可以直接抛出 <code>throw new BadMethodCallException;</code>。</p>

<ul>
  <li><a href="https://secure.php.net/language.exceptions">Read about Exceptions</a></li>
  <li><a href="https://secure.php.net/spl.exceptions">Read about SPL Exceptions</a></li>
  <li><a href="https://www.brandonsavage.net/exceptional-php-nesting-exceptions-in-php/">Nesting Exceptions In PHP</a></li>
  <li><a href="http://ralphschindler.com/2010/09/15/exception-best-practices-in-php-5-3">Exception Best Practices in PHP 5.3</a></li>
</ul>


</section>

<div class="back-to-top"><p><a href="#top" class="top">回到顶部</a></p>
</div>
<section class="chapter" id="security">
    <h1 id="security_title">安全</h1>

<p>我能找到最好的关于 PHP 安全的资源是： <a href="https://paragonie.com/blog/2017/12/2018-guide-building-secure-php-software">The 2018 Guide to Building Secure PHP Software</a> by
<a href="https://paragonie.com/">Paragon Initiative</a>.</p>

</section>


<section class="chapter" id="web_application_security">
    <h2 id="web_application_security_title">Web 应用程序安全</h2>

<p>It is very important for every PHP developer to learn <a href="https://paragonie.com/blog/2015/08/gentle-introduction-application-security">the basics of web application security</a>, which can be broken
down into a handful of broad topics:</p>

<ol>
  <li>Code-data separation.
    <ul>
      <li>When data is executed as code, you get SQL Injection, Cross-Site Scripting, Local/Remote File Inclusion, etc.</li>
      <li>When code is printed as data, you get information leaks (source code disclosure or, in the case of C programs,
enough information to bypass <a href="http://searchsecurity.techtarget.com/definition/address-space-layout-randomization-ASLR">ASLR</a>).</li>
    </ul>
  </li>
  <li>Application logic.
    <ul>
      <li>Missing authentication or authorization controls.</li>
      <li>Input validation.</li>
    </ul>
  </li>
  <li>Operating environment.
    <ul>
      <li>PHP versions.</li>
      <li>Third party libraries.</li>
      <li>The operating system.</li>
    </ul>
  </li>
  <li>Cryptography weaknesses.
    <ul>
      <li><a href="https://paragonie.com/blog/2016/01/on-design-and-implementation-stealth-backdoor-for-web-applications">Weak random numbers</a>.</li>
      <li><a href="https://paragonie.com/blog/2015/05/using-encryption-and-authentication-correctly">Chosen-ciphertext attacks</a>.</li>
      <li><a href="http://blog.ircmaxell.com/2014/11/its-all-about-time.html">Side-channel information leaks</a>.</li>
    </ul>
  </li>
</ol>

<p>There are bad people ready and willing to exploit your web application. It is important that you take necessary
precautions to harden your web application’s security. Luckily, the fine folks at
<a href="https://www.owasp.org/">The Open Web Application Security Project</a> (OWASP) have compiled a comprehensive list of known security issues and
methods to protect yourself against them. This is a must read for the security-conscious developer. <a href="https://phpsecurity.readthedocs.io/en/latest/index.html">Survive The Deep End: PHP Security</a> by Padraic Brady is also another good web application security guide for PHP.</p>

<ul>
  <li><a href="https://www.owasp.org/index.php/Guide_Table_of_Contents">Read the OWASP Security Guide</a></li>
</ul>


</section>


<section class="chapter" id="password_hashing">
    <h2 id="password_hashing_title">密码哈希</h2>

<p>每个人在建构 PHP 应用时终究都会加入用户登录的模块。用户的帐号及密码会被储存在数据库中，在登录时用来验证用户。</p>

<p>It is important that you properly <a href="https://wikipedia.org/wiki/Cryptographic_hash_function"><em>hash</em></a> passwords before storing them. Hashing and encrypting are <a href="https://paragonie.com/blog/2015/08/you-wouldnt-base64-a-password-cryptography-decoded">two very different things</a>
that often get confused.</p>

<p>Hashing is an irreversible, one-way function. This produces a fixed-length string that cannot be feasibly reversed.
This means you can compare a hash against another to determine if they both came from the same source string, but you
cannot determine the original string. If passwords are not hashed and your database is accessed by an unauthorized
third-party, all user accounts are now compromised.</p>

<p>Unlike hashing, encryption is reversible (provided you have the key). Encryption is useful in other areas, but is a poor
strategy for securely storing passwords.</p>

<p>密码应该单独被  <a href="https://wikipedia.org/wiki/Salt_(cryptography)">加盐处理</a> ，加盐值指的是在哈希之前先加入随机子串。以此来防范「字典破解」或者「彩虹碰撞」（一个可以保存了通用哈希后的密码数据库，可用来逆向推出密码）。</p>

<p>哈希和加盐非常重要，因为很多情况下，用户会在不同的服务中选择使用同一个密码，密码的安全性很低。</p>

<p>Additionally, you should use <a href="https://paragonie.com/blog/2016/02/how-safely-store-password-in-2016">a specialized <em>password hashing</em> algoithm</a> rather than fast, general-purpose
cryptographic hash function (e.g. SHA256). The short list of acceptable password hashing algorithms (as of June 2018)
to use are:</p>

<ul>
  <li>Argon2 (available in PHP 7.2 and newer)</li>
  <li>Scrypt</li>
  <li><strong>Bcrypt</strong> (PHP provides this one for you; see below)</li>
  <li>PBKDF2 with HMAC-SHA256 or HMAC-SHA512</li>
</ul>

<p>值得庆幸的是，在 PHP 中这些很容易做到。</p>

<p><strong>使用 <code>password_hash</code> 来哈希密码</strong></p>

<p><code>password_hash</code> 函数在 PHP 5.5 时被引入。 此函数现在使用的是目前 PHP 所支持的最强大的加密算法 BCrypt 。 当然，此函数未来会支持更多的加密算法。 <code>password_compat</code> 库的出现是为了提供对 PHP &gt;= 5.3.7 版本的支持。</p>

<p>在下面例子中，我们哈希一个字符串，然后和新的哈希值对比。因为我们使用的两个字符串是不同的（’secret-password’ 与 ‘bad-password’），所以登录失败。</p>

<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="k">require</span> <span class="s1">'password.php'</span><span class="p">;</span>

<span class="nv">$passwordHash</span> <span class="o">=</span> <span class="nb">password_hash</span><span class="p">(</span><span class="s1">'secret-password'</span><span class="p">,</span> <span class="nx">PASSWORD_DEFAULT</span><span class="p">);</span>

<span class="k">if</span> <span class="p">(</span><span class="nb">password_verify</span><span class="p">(</span><span class="s1">'bad-password'</span><span class="p">,</span> <span class="nv">$passwordHash</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">// Correct Password</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="c1">// Wrong password</span>
<span class="p">}</span></code></pre></div>

<p><code>password_hash()</code> 已经帮你处理好了加盐。加进去的随机子串通过加密算法自动保存着，成为哈希的一部分。<code>password_verify()</code> 会把随机子串从中提取，所以你不必使用另一个数据库来记录这些随机子串。</p>

<ul>
  <li><a href="https://secure.php.net/function.password-hash">了解 <code>password_hash()</code></a></li>
  <li><a href="https://github.com/ircmaxell/password_compat">PHP &gt;= 5.3.7 &amp;&amp; &lt; 5.5 的 <code>password_compat</code></a></li>
  <li><a href="https://wikipedia.org/wiki/Cryptographic_hash_function">了解密码学中的哈希</a></li>
  <li><a href="https://wikipedia.org/wiki/Salt_(cryptography)">学习下加盐</a></li>
  <li><a href="https://wiki.php.net/rfc/password_hash">PHP <code>password_hash()</code> RFC</a></li>
</ul>


</section>


<section class="chapter" id="data_filtering">
    <h2 id="data_filtering_title">数据过滤</h2>

<p>永远不要信任外部输入。请在使用外部输入前进行过滤和验证。<code>filter_var()</code> 和 <code>filter_input()</code> 函数可以过滤文本并对格式进行校验（例如 email 地址）。</p>

<p>外部输入可以是任何东西：<code>$_GET</code> 和 <code>$_POST</code> 等表单输入数据，<code>$_SERVER</code> 超全局变量中的某些值，还有通过 <code>fopen('php://input', 'r')</code> 得到的 HTTP 请求体。记住，外部输入的定义并不局限于用户通过表单提交的数据。上传和下载的文档，session 值，cookie 数据，还有来自第三方 web 服务的数据，这些都是外部输入。</p>

<p>虽然外部输入可以被存储、组合并在以后继续使用，但它依旧是外部输入。每次你处理、输出、连结或在代码中包含时，请提醒自己检查数据是否已经安全地完成了过滤。</p>

<p>数据可以根据不同的目的进行不同的 <em>过滤</em> 。比如，当原始的外部输入被传入到了 HTML 页面的输出当中，它可以在你的站点上执行 HTML 和 JavaScript 脚本！这属于跨站脚本攻击（XSS），是一种很有杀伤力的攻击方式。一种避免 XSS 攻击的方法是在输出到页面前对所有用户生成的数据进行清理，使用 <code>strip_tags()</code> 函数来去除 HTML 标签或者使用 <code>htmlentities()</code> 或是 <code>htmlspecialchars()</code> 函数来对特殊字符分别进行转义从而得到各自的 HTML 实体。</p>

<p>另一个例子是传入能够在命令行中执行的选项。这是非常危险的（同时也是一个不好的做法），但是你可以使用自带的 <code>escapeshellarg()</code> 函数来过滤执行命令的参数。</p>

<p>最后的一个例子是接受外部输入来从文件系统中加载文件。这可以通过将文件名修改为文件路径来进行利用。你需要过滤掉<code>"/"</code>, <code>"../"</code>, <a href="https://secure.php.net/security.filesystem.nullbytes">null 字符</a>或者其他文件路径的字符来确保不会去加载隐藏、私有或者敏感的文件。</p>

<ul>
  <li><a href="https://secure.php.net/book.filter">学习更多数据过滤</a></li>
  <li><a href="https://secure.php.net/function.filter-var">学习更多 <code>filter_var</code></a></li>
  <li><a href="https://secure.php.net/function.filter-input">学习更多 <code>filter_input</code></a></li>
  <li><a href="https://secure.php.net/security.filesystem.nullbytes">学习更多 null 字符问题</a></li>
</ul>

<h3 id="section">数据清理</h3>

<p>数据清理是指删除（或转义）外部输入中的非法和不安全的字符。</p>

<p>例如，你需要在将外部输入包含在 HTML 中或者插入到原始的 SQL 请求之前对它进行过滤。当你使用 <a href="#databases">PDO</a> 中的限制参数功能时，它会自动为你完成过滤的工作。</p>

<p>有些时候你可能需要允许一些安全的 HTML 标签输入进来并被包含在输出的 HTML 页面中，但这实现起来并不容易。尽管有一些像 <a href="http://htmlpurifier.org/">HTML Purifier</a> 的白名单类库为了这个原因而出现，实际上更多的人通过使用其他更加严格的格式限制方式例如使用 Markdown 或 BBCode 来避免出现问题。</p>

<p><a href="https://secure.php.net/filter.filters.sanitize">查看 Sanitization Filters</a></p>

<h3 id="unserialization">反序列化 Unserialization</h3>

<p>使用 <code>unserialize()</code> 从用户或者其他不可信的渠道中提取数据是非常危险的事情。这样做会触发恶意实例化对象（包含用户定义的属性），<strong>即使对象没用被使用</strong>，也会触发运行对象的析构函数。所以你应该避免从不可信渠道反序列化数据。</p>

<p>如果你必须这样做，请你使用 PHP 7 的 <a href="https://secure.php.net/manual/function.unserialize.php"><code>allowed_classes</code></a> 选项来限制反序列化的对象类型。</p>

<h3 id="section-1">有效性验证</h3>

<p>验证是来确保外部输入的是你所想要的内容。比如，你也许需要在处理注册申请时验证 email 地址、手机号码或者年龄等信息的有效性。</p>

<p><a href="https://secure.php.net/filter.filters.validate">查看 Validation Filters</a></p>


</section>


<section class="chapter" id="configuration_files">
    <h2 id="configuration_files_title">配置文件</h2>

<p>当你在为你的应用程序创建配置文件时，最好的选择时参照以下的做法：</p>

<ul>
  <li>推荐你将你的配置信息存储在无法被直接读取和上传的位置上。</li>
  <li>如果你一定要存储配置文件在根目录下，那么请使用 <code>.php</code> 的扩展名来进行命名。这将可以确保即使脚本被直接访问到，它也不会被以明文的形式输出出来。</li>
  <li>配置文件中的信息需要被针对性的保护起来，对其进行加密或者设置访问权限。</li>
  <li>建议不要把敏感信息如密码或者 API 令牌放到版本控制器中。</li>
</ul>

</section>


<section class="chapter" id="register_globals">
    <h2 id="register_globals_title">注册全局变量</h2>

<p><strong>注意：</strong> 自 PHP 5.4.0 开始，<code>register_globals</code> 选项已经被移除并不再使用。这是在提醒你如果你正在升级旧的应用程序的话，你需要注意这一点。</p>

<p>当 <code>register_globals</code> 选项被开启时，它会使许多类型的变量（包括 <code>$_POST</code>, <code>$_GET</code> 和 <code>$_REQUEST</code>）被注册为全局变量。这将很容易使你的程序无法有效地判断数据的来源并导致安全问题。</p>

<p>例如：<code>$_GET['foo']</code> 可以通过 <code>$foo</code> 被访问到，也就是可以对未声明的变量进行覆盖。如果你使用低于 5.4.0 版本的 PHP 的话，请 <strong>确保</strong> <code>register_globals</code> 是被设为 <strong>off</strong> 的。</p>

<ul>
  <li><a href="https://secure.php.net/security.globals">在 PHP 手册中了解 Register_globals</a></li>
</ul>

</section>


<section class="chapter" id="error_reporting">
    <h2 id="error_reporting_title">错误报告</h2>

<p>错误日志对于发现程序中的错误是非常有帮助的，但是有些时候它也会将应用程序的结构暴露给外部。为了有效的保护你的应用程序不受到由此而引发的问题。你需要将在你的服务器上使用开发和生产（线上）两套不同的配置。</p>

<h3 id="section">开发环境</h3>

<p>为了在 <strong>开发</strong> 环境中显示所有可能的错误，将你的 <code>php.ini</code> 进行如下配置：</p>

<div class="highlight"><pre><code class="language-ini" data-lang="ini"><span class="py">display_errors</span> <span class="p">=</span> <span class="s">On</span>
<span class="py">display_startup_errors</span> <span class="p">=</span> <span class="s">On</span>
<span class="py">error_reporting</span> <span class="p">=</span> <span class="s">-1</span>
<span class="py">log_errors</span> <span class="p">=</span> <span class="s">On</span></code></pre></div>

<blockquote>
  <p>将值设为 <code>-1</code> 将会显示出所有的错误，甚至包括在未来的 PHP 版本中新增加的类型和参数。
和 PHP 5.4 起开始使用的 <code>E_ALL</code> 是相同的。-
<a href="http://php.net/function.error-reporting">php.net</a></p>
</blockquote>

<p><code>E_STRICT</code> 类型的错误是在 5.3.0 中被引入的，并没有被包含在 <code>E_ALL</code> 中。然而从 5.4.0 开始，它被包含在了 <code>E_ALL</code> 中。这意味着什么？这表示如果你想要在 5.3 中显示所有的错误信息，你需要使用 <code>-1</code> 或者 <code>E_ALL | E_STRICT</code>。</p>

<p><strong>不同 PHP 版本下开启全部错误显示</strong></p>

<ul>
  <li>&lt; 5.3 <code>-1</code> 或 <code>E_ALL</code></li>
  <li>  5.3 <code>-1</code> 或 <code>E_ALL | E_STRICT</code></li>
  <li>&gt; 5.3 <code>-1</code> 或 <code>E_ALL</code></li>
</ul>

<h3 id="section-1">生产环境</h3>

<p>为了在 <strong>生产</strong> 环境中隐藏错误显示，将你的 <code>php.ini</code> 进行如下配置：</p>

<div class="highlight"><pre><code class="language-ini" data-lang="ini"><span class="py">display_errors</span> <span class="p">=</span> <span class="s">Off</span>
<span class="py">display_startup_errors</span> <span class="p">=</span> <span class="s">Off</span>
<span class="py">error_reporting</span> <span class="p">=</span> <span class="s">E_ALL</span>
<span class="py">log_errors</span> <span class="p">=</span> <span class="s">On</span></code></pre></div>

<p>当在生产环境中使用这个配置时，错误信息依旧会被照常存储在 web 服务器的错误日志中，唯一不同的是将不再显示给用户。更多关于设置的信息，请参考 PHP 手册：</p>

<ul>
  <li><a href="https://secure.php.net/errorfunc.configuration#ini.error-reporting">错误报告</a></li>
  <li><a href="https://secure.php.net/errorfunc.configuration#ini.display-errors">显示错误</a></li>
  <li><a href="https://secure.php.net/errorfunc.configuration#ini.display-startup-errors">显示启动错误</a></li>
  <li><a href="https://secure.php.net/errorfunc.configuration#ini.log-errors">记录错误</a></li>
</ul>

</section>

<div class="back-to-top"><p><a href="#top" class="top">回到顶部</a></p>
</div>
<section class="chapter" id="testing">
    <h1 id="testing_title">测试</h1>

<p>为你的 PHP 程序编写自动化测试被认为是最佳实践，可以帮助你建立良好的应用程序。 自动化测试是非常棒的工具，它能确保你的应用程序在改变或增加新的功能时不会影响现有的功能，不应该忽视。</p>

<p>PHP 有一些不同种类的测试工具 (或框架) 可以使用，它们使用不同的方法 - 但他们都试图避免手动测试和大型 QA 团队的需求，确保最近的变更不会破坏既有功能。</p>

</section>


<section class="chapter" id="test_driven_development">
    <h2 id="test_driven_development_title">测试驱动开发</h2>

<p><a href="https://wikipedia.org/wiki/Test-driven_development">Wikipedia</a> 上的定义:</p>

<blockquote>
  <p>测试驱动开发 (TDD) 是一种以非常短的开发周期不断迭代的软件开发过程:首先开发者对将要实现的功能或者新的方法写一个失败的自动化测试用例，然后就去写代码来通过这个测试用例，最终通过重构代码让一其达到可接受的水准。<strong>Kent Beck</strong>， 这个技术创造者或者说重新发现者，在2003年声明TDD 鼓励简单的设计和激励信心。</p>
</blockquote>

<p>目前你可以应用的几种不同类型的测试：</p>

<h3 id="section">单元测试</h3>
<p>单元测试是一种编程方法来确认函数，类和方法以我们预期的方式来工作，单元测试会贯穿整个项目的开发周期。通过检查各个函数和方法的输入输出，你就可以保证内部的逻辑已经正确执行。通过使用依赖注入和编写”mock” 类以及 stubs 来确认依赖被正确的使用，提高测试覆盖率。</p>

<p>当你创建一个类或者一个函数，你应该为它们的每一个行为创建一个单元测试。至少你应该确认当你输入一个错误参数会触发一个错误，你输入一个有效的参数会得到正确的结果。这会帮助你在开发周期后段对类或者函数做出修改后，确认已有的功能任然可以正常的工作。可替代的方法是在源码中使用 <code>var_dump()</code> ，但这种方法却不能去构建一个或大或小的应用。</p>

<p>单元测试的其他用处是在给开源项目贡献代码时。如果你写了一个测试证明代码有bug，然后修复它，并且展示测试的过程，这样补丁将会更容易被接受。如果你在维护一个项目，在处理 pull request 的时候可以将单元测试作为一个要求。</p>

<p><a href="https://phpunit.de/">PHPUnit</a> 是业界PHP应用开发单元测试框架的标准，但也有其他可选的框架：</p>

<ul>
  <li><a href="https://github.com/atoum/atoum">atoum</a></li>
  <li><a href="https://github.com/crysalead/kahlan">Kahlan</a></li>
  <li><a href="https://peridot-php.github.io/">Peridot</a></li>
  <li><a href="http://simpletest.org">SimpleTest</a></li>
</ul>

<h3 id="section-1">集成测试</h3>

<p><a href="https://wikipedia.org/wiki/Integration_testing">Wikipedia</a> 上的定义:</p>

<blockquote>
  <p>集成测试 (有时候称为集成和测试，缩写为 <code>I&amp;T</code>)是把各个模块组合在一起进行整体测试的软件测试阶段。它处于单元测试之后，验收测试之前。集成测试将已经经过了单元测试的模块做为输入模块，组合成一个整体，然后运行集成测试用例，然后输出一个可以进行系统测试的系统。</p>
</blockquote>

<p>许多相同的测试工具既可以运用到单元测试，也可以运用到集成测试。</p>

<h3 id="section-2">功能性测试</h3>

<p>有时候也被称之为验收测试，功能测试是通过使用工具来生成自动化的测试用例，然后在真实的系统上运行。而不是单元测试中简单的验证单个模块的正确性和集成测试中验证各个模块间交互的正确性。这些工具会使用代表性的真实数据来模拟真实用户的行为来验证系统的正确性。</p>

<h4 id="section-3">功能测试的工具</h4>

<ul>
  <li><a href="https://docs.seleniumhq.org/">Selenium</a></li>
  <li><a href="http://mink.behat.org/">Mink</a></li>
  <li><a href="https://codeception.com/">Codeception</a> 是一个全栈的测试框架包括验收性测试工具。</li>
  <li><a href="https://datasift.github.io/storyplayer/">Storyplayer</a> 是一个全栈的测试框架并且支持随时创建和销毁测试环境。</li>
</ul>

</section>


<section class="chapter" id="behavior_driven_development">
    <h2 id="behavior_driven_development_title">行为驱动开发</h2>

<p>有两种不同的行为驱动开发 (BDD): SpecBDD 和 StoryBDD。 SpecBDD 专注于代码的技术行为，而 StoryBDD 专注于业务逻辑或功能的行为和互动。这两种 BDD 都有对应的 PHP 框架。</p>

<p>采用 StoryBDD 时, 你编写可读的故事来描述应用程序的行为。接着这些故事可以作为应用程序的实际测试案例执行。<a href="http://behat.org/">Behat</a> 是使用在 PHP 应用程序中的 StoryBDD框架，它受到 Ruby 的 <a href="https://cucumber.io/">Cucumber</a> 项目的启发并且实现了 Gherkin DSL 來描述功能的行为。</p>

<p>采用 SpecBDD 时, 你编写规格来描述实际的代码应该有什么行为。你应该描述函数或者方法应该有什么行为，而不是测试函数或者方法。PHP 提供了 <a href="https://www.phpspec.net/">PHPSpec</a> 框架来达到这个目的，这个框架受到了 Ruby 的 <a href="https://rspec.info/">RSpec project</a> 项目的启发。</p>

<h3 id="bdd-">BDD 链接</h3>

<ul>
  <li><a href="http://behat.org/">Behat</a>, PHP 的 StoryBDD 框架， 受到了 Ruby’s <a href="https://cucumber.io/">Cucumber</a> 项目的启发。</li>
  <li><a href="https://www.phpspec.net/">PHPSpec</a>, PHP 的 SpecBDD 框架， 受到了 Ruby’s <a href="https://rspec.info/">RSpec</a> 项目的启发。</li>
  <li><a href="https://codeception.com/">Codeception</a> 是一个使用 BDD 准则的全栈测试框架。</li>
</ul>


</section>


<section class="chapter" id="complementary_testing_tools">
    <h2 id="complementary_testing_tools_title">其他测试工具</h2>

<p>除了个别的测试驱动和行为驱动框架之外，还有一些通用的框架和辅助函数类库，对任何的测试方法都很有用。</p>

<h3 id="section">工具地址</h3>

<ul>
  <li><a href="https://www.seleniumhq.org/">Selenium</a> 是一个浏览器自动化工具 <a href="https://github.com/giorgiosironi/phpunit-selenium/">integrated with PHPUnit</a></li>
  <li><a href="https://github.com/padraic/mockery">Mockery</a> 是一个可以跟 <a href="https://phpunit.de/">PHPUnit</a> 或者 <a href="https://www.phpspec.net/">PHPSpec</a> 整合的 Mock 对象框架</li>
  <li><a href="https://github.com/phpspec/prophecy">Prophecy</a> 是个有自己的想法，且非常强大灵活的 PHP 对象 mocking 框架。它整合了 <a href="https://www.phpspec.net/">PHPSpec</a> 并且可以和 <a href="https://phpunit.de/">PHPUnit</a> 一起使用</li>
  <li><a href="https://github.com/php-mock/php-mock">php-mock</a>  一个 Mock PHP 原生方法的库</li>
  <li><a href="https://github.com/infection/infection">Infection</a> is a PHP implementation of <a href="https://en.wikipedia.org/wiki/Mutation_testing">Mutation Testing</a> to help to measure the effectiveness of your tests.</li>
</ul>


</section>

<div class="back-to-top"><p><a href="#top" class="top">回到顶部</a></p>
</div>
<section class="chapter" id="servers_and_deployment">
    <h1 id="servers_and_deployment_title">服务器与部署</h1>

<p>部署 PHP 应用程序到生产环境中有多种方式。</p>

</section>


<section class="chapter" id="platform_as_a_service">
    <h2 id="platform_as_a_service_title">Platform as a Service (PaaS)</h2>

<p>PaaS 提供了运行 PHP 应用程序所必须的系统环境和网络架构。这就意味着只需做少量配置就可以运行 PHP 应用程序或者 PHP 框架。</p>

<p>现在，PaaS 已经成为一种部署、托管和扩展各种规模的 PHP 应用程序的流行方式。你可以在 <a href="#resources">资源部分</a> 查看 <a href="#php_paas_providers">PHP PaaS “Platform as a Service” 提供商</a>  列表。</p>

</section>


<section class="chapter" id="virtual_or_dedicated_servers">
    <h2 id="virtual_or_dedicated_servers_title">虚拟或专用服务器</h2>

<p>如果你喜欢系统管理员的工作，或者对这方面感兴趣，虚拟或者专用服务器可以让你完全控制自己的生产环境。</p>

<h3 id="nginx--php-fpm">nginx 和 PHP-FPM</h3>

<p>PHP 通过内置的 FastCGI 进程管理器（FPM），可以很好的与轻量级的高性能 web 服务器 <a href="https://nginx.org/">nginx</a> 协作使用。nginx 比 Apache 占用更少内存而且可以更好的处理并发请求，这对于并没有太多内存的虚拟服务器尤其重要。</p>

<ul>
  <li><a href="https://nginx.org/">阅读更多 nginx 的内容</a></li>
  <li><a href="https://secure.php.net/install.fpm">阅读更多 PHP-FPM 的内容</a></li>
  <li><a href="https://nealpoole.com/blog/2011/04/setting-up-php-fastcgi-and-nginx-dont-trust-the-tutorials-check-your-configuration/">学习如何配置安全的 nginx 和 PHP-FPM</a></li>
</ul>

<h3 id="apache--php">Apache 和 PHP</h3>

<p>PHP 和 Apache 有很长的合作历史。Apache 有很强的可配置性和大量的 <a href="https://httpd.apache.org/docs/2.4/mod/">扩展模块</a>
 。是共享主机中常见的Web服务器，完美支持各种 PHP 框架和开源应用(如 WordPress )。可惜的是，默认情况下，Apache 会比 nginx 消耗更多的资源，而且并发处理能力不强。</p>

<p>Apache 有多种方式运行 PHP，最常见的方式就是使用 mode_php5 的 <a href="https://httpd.apache.org/docs/2.4/mod/prefork.html">prefork MPM</a> 方式。但是它对内存的利用效率并不高，如果你不想深入服务器管理方面学习，那么这种简单的方式可能是你最好的选择。需要注意的事如果你使用 mod_php5，就必须使用 prefork MPM。</p>

<p>如果你追求高性能和高稳定性，可以为 Apache 选择与 nginx 类似的的 FPM 系统 <a href="https://httpd.apache.org/docs/2.4/mod/worker.html">worker MPM</a> 或者
<a href="https://httpd.apache.org/docs/2.4/mod/event.html">event MPM</a>，它们分别使用 mod_fastcgi 和 mod_fcgid。这种方式可以更高效的利用内存，运行速度也更快，但是配置也相对复杂一些。</p>

<ul>
  <li><a href="https://httpd.apache.org/">阅读更多 Apache</a></li>
  <li><a href="https://httpd.apache.org/docs/2.4/mod/mpm_common.html">阅读更多 Apache 多进程模块</a></li>
  <li><a href="https://blogs.oracle.com/opal/entry/php_fpm_fastcgi_process_manager">阅读更多 mod_fastcgi</a></li>
  <li><a href="hhttps://httpd.apache.org/mod_fcgid/">阅读更多 mod_fcgid</a></li>
  <li><a href="https://httpd.apache.org/docs/current/mod/mod_proxy_fcgi.html">阅读更多 mod_proxy_fcgi</a></li>
  <li><a href="https://serversforhackers.com/video/apache-and-php-fpm">配置 Apache 通过 mod_proxy_fcgi 使用 PHP-FPM</a></li>
</ul>


</section>


<section class="chapter" id="shared_servers">
    <h2 id="shared_servers_title">共享主机</h2>

<p>PHP 非常流行，很少有服务器没有安装 PHP 的，因而有很多共享主机，不过需要注意服务器上的 PHP 是否是最新稳定 版本。共享主机允许多个开发者把自己的网站部署在上面，这样的好处是费用非常便宜，坏处是你不知道将和哪些 网站共享主机，因此需要仔细考虑机器负载和安全问题。如果项目预算允许的话，避免使用共享主机是上策。</p>

<p>为确保你的共享主机使用了最新的 PHP 版本，请查看：<a href="http://phpversions.info/shared-hosting/">共享主机 PHP 版本使用</a>.</p>

</section>


<section class="chapter" id="building_and_deploying_your_application">
    <h2 id="building_and_deploying_your_application_title">构建及部署应用</h2>

<p>如果你在手动的进行数据库结构的修改或者在更新文件前手动运行测试，请三思而后行！因为随着每一个额外的手动任务的添加都需要去部署一个新的版本到应用程序，这些更改会增加程序潜在的致命错误。即使你是在处理一个简单的更新，全面的构建处理或者持续集成策略，<a href="https://wikipedia.org/wiki/Build_automation">构建自动化</a>绝对是你的朋友。</p>

<p>你可能想要自动化的任务有：</p>

<ul>
  <li>依赖管理</li>
  <li>静态资源编译、压缩</li>
  <li>执行测试</li>
  <li>文档生成</li>
  <li>打包</li>
  <li>部署</li>
</ul>

<h3 id="section">构建自动化工具</h3>

<p>构建工具可以认为是一系列的脚本来完成应用部署的通用任务。构建工具并不属于应用的一部分，它独立于应用层 ‘之外’。</p>

<p>现在已有很多开源的工具来帮助你完成构建自动化，一些是用 PHP 编写，有一些不是。应该根据你的实际项目来选择最适合的工具，不要让语言阻碍了你使用这些工具，如下有一些例子：</p>

<p><a href="https://www.phing.info/">Phing</a> 是一种在 PHP 领域中最简单的开始自动化部署的方式。通过 Phing 你可以控制打包，部署或者测试，只需要一个简单的 XML 构建文件。Phing (基于<a href="https://ant.apache.org/">Apache Ant</a>) 提供了在安装或者升级 web 应用时的一套丰富的任务脚本，并且可以通过 PHP 编写额外的任务脚本来扩展。</p>

<p><a href="http://capistranorb.com/">Capistrano</a> 是一个为 <em>中高级程序员</em> 准备的系统，以一种结构化、可复用的方式在一台或多台远程机器上执行命令。对于部署 Ruby on Rails 的应用，它提供了预定义的配置，不过也可以用它来 <strong>部署 PHP 应用</strong> 。如果要成功的使用 Capistrano ，需要一定的 Ruby 和 Rake 的知识。</p>

<p>对 Capistrano 感兴趣的 PHP 开发者可以阅读 Dave Gardner 的博文 [PHP Deployment with Capistrano][phpdeploy_capistrano] ，来作为一个很好的开始。</p>

<p><a href="http://rocketeer.autopergamene.eu/">Rocketeer</a> 从 Laravel 框架中得到了很多灵感。 目标是默认智能化配置、高速、优雅的自动化部署工具。他支持多服务器，多阶段，并行部署等功能。工具的扩展性极强，并且是由 PHP 编写。</p>

<p><a href="https://deployer.org/">Deployer</a> 是一个用 PHP 编写的部署工具，它很简单且实用。并行执行任务，原子化部署，在多台服务器之间保持一致性。为 Symfony、Laravel、Zend Framework 和 Yii 提供了通用的任务脚本。推荐阅读 Younes Rafie 的博文 <a href="https://www.sitepoint.com/deploying-php-applications-with-deployer/">快速使用 Deployer 部署 PHP 应用</a>。</p>

<p><a href="https://www.magephp.com/">Magallanes</a> 是另一个由 PHP 编写的自动化部署工具。使用 YAML 作为配置信息，支持多服务器和多环境，自动化部署。并且自带了许多通用的任务。</p>

<h4 id="section-1">延伸阅读：</h4>

<ul>
  <li><a href="https://code.tutsplus.com/tutorials/automate-your-projects-with-apache-ant--net-18595">Automate your project with Apache Ant</a></li>
  <li>[Expert PHP Deployments][expert_php_deployments] - free book on deployment with Capistrano, Phing and Vagrant.</li>
  <li><a href="https://deployingphpapplications.com/">Deploying PHP Applications</a> - paid book on best practices and tools for PHP deployment.</li>
</ul>

<h3 id="server-provisioning">服务器布置 Server Provisioning</h3>

<p>在多台服务器的场景下，管理服务器系统配置信息将会是一个令人棘手的事情。接下来介绍几种工具来让你自动化这些工作。一般情况下，一些大型的云托管商（如：Amazon Web Services, Heroku, DigitalOcean 等）会集成自动化管理工具。</p>

<p><a href="https://www.ansible.com/">Ansible</a> 让你使用 YAML 配置文件来管理你的服务器基础设施。简单上手，功能强大，能支持复杂和大型应用场景。甚至支持 API 来动态管理云主机实例。</p>

<p><a href="https://puppet.com/">Puppet</a> 拥有自定义语言和文件类型来管理服务和配置信息。支持 主从结构或者是 <code>无主结构</code>。在主从结构中，从属机器会在设定周期内更新主机上的配置信息。在无主架构中，你需要 <code>push</code> 推送修改到各个节点。</p>

<p><a href="https://www.chef.io/">Chef</a> 不仅仅只是一个部署框架， 它是一个基于 Ruby 的强大的系统集成框架，除了部署你的应用之外，还可以构建整个服务环境或者虚拟机。AWS 提供一个服务叫 OpsWorks，其集成了 Chef。</p>

<h4 id="section-2">延伸阅读：</h4>

<ul>
  <li><a href="https://serversforhackers.com/an-ansible-tutorial">An Ansible Tutorial</a></li>
  <li><a href="https://leanpub.com/ansible-for-devops">Ansible for DevOps</a> - paid book on everything Ansible</li>
  <li><a href="https://leanpub.com/ansible-for-aws">Ansible for AWS</a> - paid book on integrating Ansible and Amazon Web Services</li>
  <li><a href="http://www.jasongrimes.org/2012/06/managing-lamp-environments-with-chef-vagrant-and-ec2-1-of-3/">Three part blog series about deploying a LAMP application with Chef, Vagrant, and EC2</a></li>
  <li><a href="https://github.com/chef-cookbooks/php">Chef Cookbook which installs and configures PHP and the PEAR package management system</a></li>
  <li><a href="https://www.youtube.com/playlist?list=PL11cZfNdwNyPnZA9D1MbVqldGuOWqbumZ">Chef video tutorial series</a></li>
</ul>

<h3 id="section-3">持续集成</h3>

<blockquote>
  <p>持续集成是一种软件开发实践，团队的成员经常用来集成他们的工作，
通常每一个成员至少每天都会进行集成 — 因此每天都会有许多的集成。许多团队发现这种方式会显著地降低集成问题，
approach leads to significantly reduced integration problems and allows a team to develop cohesive software more
并允许一个团队更快的开发软件。</p>
</blockquote>

<p><em>– Martin Fowler</em></p>

<p>对于 PHP 来说，有许多的方式来实现持续集成。近来 <a href="https://travis-ci.org/">Travis CI</a> 在持续集成上做的很棒，对于小项目来说也可以很好的使用。Travis CI 是一个托管的持续集成服务用于开源社区。它可以和 Github 很好的集成，并且提供了很多语言的支持包括 PHP 。</p>

<h4 id="section-4">延伸阅读：</h4>

<ul>
  <li><a href="https://jenkins.io/">使用 Jenkins 进行持续集成</a></li>
  <li><a href="https://www.phptesting.org/">使用 PHPCI 进行持续集成</a></li>
  <li><a href="https://www.jetbrains.com/teamcity/">使用 Teamcity 进行持续集成</a></li>
</ul>


</section>

<div class="back-to-top"><p><a href="#top" class="top">回到顶部</a></p>
</div>
<section class="chapter" id="virtualization">
    <h1 id="virtualization_title">虚拟化技术</h1>

<p>在开发和线上阶段使用不同的系统运行环境的话, 经常会遇到各种各样的 BUG, 并且在团队开发的时候, 让所有成员都保持使用最新版本的软件和类库, 也是一件很让人头痛的事情.</p>

<p>如果你是在 Windows 下开发, 线上环境是 Linux (或者别的非 Windows 系统) 的话, 或者团队协同开发的时候, 建议使用虚拟机.</p>

<p>除了大家熟知的 VMware 和 VirtualBox 外, 还有很多工具可以让你快速, 轻松的用上虚拟环境.</p>

</section>


<section class="chapter" id="vagrant">
    <h2 id="vagrant_title">Vagrant 简介</h2>

<p><a href="https://www.vagrantup.com/">Vagrant</a> 可以让你使用单一的配置信息来部署一套虚拟环境, 最后打包为一个所谓的 box (就是已经部署好环境的虚拟机器). 你可以手动来安装和配置 box, 也可以使用自动部署工具, 如 <a href="https://puppet.com/">Puppet</a> 或者 <a href="https://www.chef.io/">Chef</a> .</p>

<p>自动部署工具可以让你快速部署一套一模一样的环境, 避免了一大堆的手动的命令输入, 并且允许你随时删除和重建一个全新的 box, 虚拟机的管理变得更加简单.</p>

<p>Vagrant 还可以在虚拟机和主机上分享文件夹, 意味着你可以在主机里面编辑代码, 然后在虚拟机里面运行.</p>

<h3 id="section">需要更多的帮助?</h3>

<p>下面是一些其他的软件, 可以帮助你更好的使用 Vagrant:</p>

<ul>
  <li><a href="http://rove.io/">Rove</a>: 使用 Chef 自动化安装一些常用的软件, PHP 包含在内.</li>
  <li><a href="https://puphpet.com/">Puphpet</a>: 简单的 Web 图形界面用来生成部署 PHP 环境的 Puppet 脚本, 此项目不仅可以用在开发上, 也可以在生产环境中使用.</li>
  <li><a href="https://www.getprotobox.com/">Protobox</a>: 是一个基于 vagrant 的一个层, 还有 Web 图形界面, 允许你使用一个 YAML 文件来安装和配置虚拟机里面的软件.</li>
  <li><a href="http://phansible.com/">Phansible</a>: 提供了一个简单的 Web 图形界面, 用来创建 Ansible 自动化部署脚本, 专门为 PHP 项目定制.</li>
</ul>


</section>


<section class="chapter" id="docker">
    <h2 id="docker_title">Docker 简介</h2>

<p><a href="https://www.docker.com/">Docker</a> - 一个轻量级的虚拟化解决方案。Docker 为各种应用程序提供了 Linux 容器。 A container is a building block which, in the simplest case, does one specific job, e.g. running a web server.  An “image” is the package you use to build the container - Docker has a repository full of them.</p>

<p>通常情况下，一个 LAMP 应用汇包含以下三个容器：一个 Web 服务器，一个 PHP-FPM 线程和 MySQL。在 Vagrant 的共享文件夹中，你不需要改变你应用文件路径，你只需要告诉 Docker 到哪里可以找到他们即可。</p>

<p>你可以通过命令行来生成容器，或者，为了更好的维护，为你的项目构建一个 <code>docker-compose.yml</code> 文件来配置生成容器的规则和容器的通讯规则。</p>

<p>Docker 在多网站要求不同运行环境的情况下尤其趁手，你可以在一台机器上运行多个 Docker 虚拟主机，他们将会运行在完全不同的环境中，使用不同的 Web 服务，并且不管在内存共享、硬盘空间、或者是 CPU 资源上，都能做到高效利用。这些虚拟机同时也指出秒寄重启。</p>

<h3 id="docker--php-">例子: 在 Docker 里面运行 PHP 应用</h3>

<p>在你成功 <a href="https://docs.docker.com/install/">安装 Docker</a> 后, 你只需要一步就可以安装 Apache + PHP.</p>

<p>下面的命令, 会下载一个功能齐全的 Apache 和 最新版本的 PHP, 并会设置 WEB 目录 <code>/path/to/your/php/files</code> 运行在 <code>http://localhost:8080</code>:</p>

<div class="highlight"><pre><code class="language-console" data-lang="console"><span class="go">docker run -d --name my-php-webserver -p 8080:80 -v /path/to/your/php/files:/var/www/html/ php:apache</span></code></pre></div>

<p>This will initialize and launch your container. <code>-d</code> makes it runs in the background. To stop and start it, simply run <code>docker stop my-php-webserver</code> and <code>docker start my-php-webserver</code> (the other parameters are not needed again).</p>

<h3 id="docker-">了解更多关于 Docker 的信息</h3>

<p>以上的命令教你快速的创建简单的服务器。Docker 还提供了很多功能等着你去发现。<a href="https://hub.docker.com/">Docker Hub</a>) 上更是提供了数以千计的已经构建好的镜像。花点时间去学习下 <a href="https://docs.docker.com/">Docker 用户手册</a>。不要运行随机看到的代码，非官方的镜像有时候并没有最新安全更新，如果你对镜像有疑问，优先选择 <a href="https://hub.docker.com/explore/">官方的仓库</a>。</p>

<p><a href="https://phpdocker.io/generator">PHPDocker.io</a> 是另一个很棒的 PHP 相关的 Docker 资源站点。支持自动生成一个全栈的 LAMP/LEMP 服务器，包含你自定义的 PHP 版本和扩展。</p>

<ul>
  <li><a href="https://www.docker.com/">Docker Website</a></li>
  <li><a href="https://docs.docker.com/install/">Docker Installation</a></li>
  <li><a href="https://docs.docker.com/">Docker User Guide</a></li>
  <li><a href="https://hub.docker.com/">Docker Hub</a></li>
  <li><a href="https://hub.docker.com/explore/">Docker Hub - official images</a></li>
</ul>


</section>

<div class="back-to-top"><p><a href="#top" class="top">回到顶部</a></p>
</div>
<section class="chapter" id="caching">
    <h1 id="caching_title">缓存</h1>

<p>PHP 本身来说是非常快的，但是但你当发起远程连接、加载文件等操作时也会遇到瓶颈。
幸运的是，有各种各样的工具可以用来加速你应用程序某些耗时的部分，或者说减少某些耗时任务所需要运行的次数。</p>

</section>


<section class="chapter" id="opcode_cache">
    <h2 id="opcode_cache_title">Opcode 缓存</h2>

<p>当一个 PHP 文件被解释执行的时候，首先是被编译成名为 <a href="http://php.net/manual/en/internals2.opcodes.php">opcodes</a> 的中间代码，然后才被底层的虚拟机执行。
如果PHP文件没有被修改过，opcode 始终是一样的。这就意味着编译步骤白白浪费了 CPU 的资源。</p>

<p>此时 opcode 缓存就派上用场了。通过将 opcode 缓存在内存中，它能防止冗余的编译步骤，并且在下次调用执行时得到重用。设置 opcode 缓存只需要几分钟的时间，你的应用程序便会因此大大加速，实在没有理由不用它。</p>

<p>PHP 5.5 中自带了 opcode 缓存工具，叫做<a href="https://secure.php.net/book.opcache">Zend OPcache</a>，默认一般是开启的，请在 <code>phpinfo()</code> 输出中检查 <a href="http://php.net/manual/en/opcache.configuration.php#ini.opcache.enable">opcache.enable</a> 关键词是否出现来确定是否开启。早期的版本也能通过 PECL 扩展来安装。</p>

<p>更多关于 opcode 缓存的资料：</p>

<ul>
  <li><a href="https://secure.php.net/book.opcache">Zend OPcache</a> (bundled with PHP since 5.5)</li>
  <li>Zend OPcache (formerly known as Zend Optimizer+) is now <a href="https://github.com/zendtech/ZendOptimizerPlus">open source</a></li>
  <li><a href="https://secure.php.net/book.apc">APC</a> - PHP 5.4 and earlier</li>
  <li><a href="https://xcache.lighttpd.net/">XCache</a></li>
  <li><a href="https://www.iis.net/downloads/microsoft/wincache-extension">WinCache</a> (extension for MS Windows Server)</li>
  <li><a href="https://wikipedia.org/wiki/List_of_PHP_accelerators">list of PHP accelerators on Wikipedia</a></li>
</ul>


</section>


<section class="chapter" id="object_caching">
    <h2 id="object_caching_title">对象缓存</h2>

<p>有时缓存代码中的单个对象会很有用，比如有些需要很大开销获取的数据或者一些结果集不怎么变化的数据库查询。你可以使用一些缓存软件将这些数据存放在内存中以便下次高速获取。如果你获得数据后把他们存起来，下次请求直接从缓存里面获取数据，在减少数据库负载的同时能极大提高性能。</p>

<p>许多流行的字节码缓存方案也能缓存定制化的数据，所以更有理由好好使用它们了。APCu、XCache 以及 WinCache 都提供了 API，以便你将数据缓存到内存中</p>

<p>最常用的内存对象缓存系统是 APCu 和 Memcached 。APCu 对于对象缓存来说是个很好的选择，它提供了简单的 API 让你能将数据缓存到内存，并且很容易设置和使用。APCu 的局限性表现在它依赖于所在的服务器。另一方面，Memcached 以独立的服务的形式安装，可以通过网络交互，这意味着你能将数据集中存在一个高速存取的地方，而且许多不同的系统能从中获取数据。</p>

<p>值得注意的是当你以 CGI(FastCGI) 的形式使用 PHP 时，每个进程将会有各自的缓存，比如说，APCu 缓存数据无法在多个工作进程中共享。在这种情况下，你可能得考虑 Memcached 了，由于它独立于 PHP 进程。</p>

<p>通常 APCu 在存取速度上比 Memcached 更快，但是 Memcached 在扩展上更有优势。如果你不希望应用程序涉及多个服务器，或者不需要 Memcached 提供的其他特性，那么 APCu 可能是最好的选择。</p>

<p>使用 APCu 的例子：</p>

<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="c1">// check if there is data saved as 'expensive_data' in cache</span>
<span class="nv">$data</span> <span class="o">=</span> <span class="nb">apc_fetch</span><span class="p">(</span><span class="s1">'expensive_data'</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$data</span> <span class="o">===</span> <span class="kc">false</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// data is not in cache; save result of expensive call for later use</span>
    <span class="nb">apc_add</span><span class="p">(</span><span class="s1">'expensive_data'</span><span class="p">,</span> <span class="nv">$data</span> <span class="o">=</span> <span class="nx">get_expensive_data</span><span class="p">());</span>
<span class="p">}</span>

<span class="nb">print_r</span><span class="p">(</span><span class="nv">$data</span><span class="p">);</span></code></pre></div>

<p>注意在 PHP 5.5 之前，APC 同时提供了对象缓存与字节码缓存。APCu 是为了将 APC 的对象缓存移植到 PHP 5.5+ 的一个项目，因为现在 PHP 有了内建的字节码缓存方案 (OPcache)。</p>

<h3 id="section">更多关于缓存系统的项目：</h3>

<ul>
  <li><a href="https://github.com/krakjoe/apcu">APCu</a></li>
  <li><a href="https://secure.php.net/ref.apc">APC Functions</a></li>
  <li><a href="https://memcached.org/">Memcached</a></li>
  <li><a href="https://redis.io/">Redis</a></li>
  <li><a href="https://xcache.lighttpd.net/wiki/XcacheApi">XCache APIs</a></li>
  <li><a href="https://secure.php.net/ref.wincache">WinCache Functions</a></li>
</ul>

</section>

<div class="back-to-top"><p><a href="#top" class="top">回到顶部</a></p>
</div>
<section class="chapter" id="documenting">
    <h1 id="documenting_title">代码注释</h1>

</section>


<section class="chapter" id="phpdoc">
    <h2 id="phpdoc_title">PHPDoc</h2>

<p>PHPDoc 是注释 PHP 代码的非正式标准。它有<em>许多</em>不同的<a href="https://docs.phpdoc.org/references/phpdoc/tags/index.html">标记</a>可以使用。完整的标记列表和范例可以查看 <a href="https://docs.phpdoc.org/index.html">PHPDoc 指南</a>。</p>

<p>如下是撰写类方法时的一种写法：</p>

<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="sd">/**
 * @author A Name &lt;a.name@example.com&gt;
 * @link http://www.phpdoc.org/docs/latest/index.html
 */</span>
<span class="k">class</span> <span class="nc">DateTimeHelper</span>
<span class="p">{</span>
    <span class="sd">/**
     * @param mixed $anything Anything that we can convert to a \DateTime object
     *
     * @throws \InvalidArgumentException
     *
     * @return \DateTime
     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">dateTimeFromAnything</span><span class="p">(</span><span class="nv">$anything</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$type</span> <span class="o">=</span> <span class="nb">gettype</span><span class="p">(</span><span class="nv">$anything</span><span class="p">);</span>

        <span class="k">switch</span> <span class="p">(</span><span class="nv">$type</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// Some code that tries to return a \DateTime object</span>
        <span class="p">}</span>

        <span class="k">throw</span> <span class="k">new</span> <span class="nx">\InvalidArgumentException</span><span class="p">(</span>
            <span class="s2">"Failed Converting param of type '</span><span class="si">{</span><span class="nv">$type</span><span class="si">}</span><span class="s2">' to DateTime object"</span>
        <span class="p">);</span>
    <span class="p">}</span>

    <span class="sd">/**
     * @param mixed $date Anything that we can convert to a \DateTime object
     *
     * @return void
     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">printISO8601Date</span><span class="p">(</span><span class="nv">$date</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">echo</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">dateTimeFromAnything</span><span class="p">(</span><span class="nv">$date</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">format</span><span class="p">(</span><span class="s1">'c'</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="sd">/**
     * @param mixed $date Anything that we can convert to a \DateTime object
     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">printRFC2822Date</span><span class="p">(</span><span class="nv">$date</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">echo</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">dateTimeFromAnything</span><span class="p">(</span><span class="nv">$date</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">format</span><span class="p">(</span><span class="s1">'r'</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></div>

<p>这个类的说明使用了 <a href="https://docs.phpdoc.org/references/phpdoc/tags/author.html">@author</a> 和 <a href="https://docs.phpdoc.org/references/phpdoc/tags/link.html">@link</a>标记， <a href="https://docs.phpdoc.org/references/phpdoc/tags/author.html">@author</a> 标记是用來说明代码的作者，在多位开发者的情况下，可以同时列出好几位。其次 <a href="https://docs.phpdoc.org/references/phpdoc/tags/link.html">@link</a> 标记用来提供网站链接，进一步说明代码和网站之间的关系。</p>

<p>在这个类中，第一个方法的 <a href="https://docs.phpdoc.org/references/phpdoc/tags/param.html">@param</a> 标记，说明类型、名字和传入方法的参数。此外，<a href="https://docs.phpdoc.org/references/phpdoc/tags/return.html">@return</a> 和 <a href="https://docs.phpdoc.org/references/phpdoc/tags/throws.html">@throws</a> 标记说明返回类型以及可能抛出的异常。</p>

<p>第二、第三个方法非常类似，和第一个方法一样使用一个 <a href="https://docs.phpdoc.org/references/phpdoc/tags/param.html">@param</a> 标记。第二、和第三个方法之间关键差別在注释区块使用／排除 <a href="https://docs.phpdoc.org/references/phpdoc/tags/return.html">@return</a> 标记。<code>@return void</code> 标记明确告诉我们没有返回值，而过去省略 <code>@return void</code> 声明也具有相同效果（沒有返回任何值）。</p>


</section>

<div class="back-to-top"><p><a href="#top" class="top">回到顶部</a></p>
</div>
<section class="chapter" id="resources">
    <h1 id="resources_title">资源</h1>

</section>


<section class="chapter" id="from_the_source">
    <h2 id="from_the_source_title">PHP 官方</h2>

<ul>
  <li><a href="https://secure.php.net/">PHP Website</a></li>
  <li><a href="https://secure.php.net/docs.php">PHP Documentation</a></li>
</ul>

</section>


<section class="chapter" id="people_to_follow">
    <h2 id="people_to_follow_title">值得关注的大牛</h2>

<p>刚进入社区时很难一下子找到很多有趣或者经验丰富的 PHP 社区成员，你可以在以下链接中找到 PHP 社区部分成员名单：</p>

<ul>
  <li><a href="https://www.ogprogrammer.com/2017/06/28/how-to-get-connected-with-the-php-community/">https://www.ogprogrammer.com/2017/06/28/how-to-get-connected-with-the-php-community/</a></li>
  <li><a href="https://twitter.com/CalEvans/lists/phpeople">https://twitter.com/CalEvans/lists/phpeople</a></li>
</ul>


</section>


<section class="chapter" id="mentoring">
    <h2 id="mentoring_title">指导</h2>

<ul>
  <li><a href="https://php-mentoring.org/">php-mentoring.org</a> - PHP 社区中的一对一指导。</li>
</ul>

</section>


<section class="chapter" id="php_paas_providers">
    <h2 id="php_paas_providers_title">PHP 的 Paas 提供商</h2>

<ul>
  <li><a href="https://www.ctl.io/appfog/">AppFog</a></li>
  <li><a href="https://aws.amazon.com/elasticbeanstalk/">AWS Elastic Beanstalk</a></li>
  <li><a href="https://www.cloudways.com/">Cloudways</a></li>
  <li><a href="https://www.engineyard.com/features">Engine Yard Cloud</a></li>
  <li><a href="https://www.fortrabbit.com/">fortrabbit</a></li>
  <li><a href="https://cloud.google.com/appengine/docs/php/">Google App Engine</a></li>
  <li><a href="https://devcenter.heroku.com/categories/php-support">Heroku</a></li>
  <li><a href="https://console.bluemix.net/docs/runtimes/php/getting-started.html#getting_started">IBM Cloud</a></li>
  <li><a href="https://jelastic.com/">Jelastic</a></li>
  <li><a href="https://azure.microsoft.com/">Microsoft Azure</a></li>
  <li><a href="https://nanobox.io/">Nanobox</a></li>
  <li><a href="https://run.pivotal.io/">Pivotal Web Services</a></li>
  <li><a href="https://platform.sh/">Platform.sh</a></li>
  <li><a href="https://www.openshift.com/">Red Hat OpenShift</a></li>
</ul>

<p>To see which versions these PaaS hosts are running, head over to <a href="http://phpversions.info/paas-hosting/">PHP Versions</a>.</p>

</section>


<section class="chapter" id="frameworks">
    <h2 id="frameworks_title">框架</h2>

<p>许多的 PHP 开发者都使用框架，而不是重新造轮子来构建 Web 应用。框架抽象了许多底层常用的逻辑，并提供了有益又简便的方法來完成常见的任务。</p>

<p>你并不一定要在每个项目中都使用框架。有时候原生的 PHP 才是正确的选择，但如果你需要一个框架，那么有如下三种主要类型：</p>

<ul>
  <li>微型框架</li>
  <li>全栈框架</li>
  <li>组件框架</li>
</ul>

<p>微型框架基本上是一个封装的路由，用来转发 HTTP 请求至一个闭包，控制器，或方法等等，尽可能地加快开发的速度，有时还会使用一些类库来帮助开发，例如一个基本的数据库封装等等。他們用来构建 HTTP 的服务卓有成效。</p>

<p>许多的框架会在微型框架上加入相当多的功能，我们则称之为全栈框架。这些框架通常会提供 ORMs ，身份认证扩展包等等。</p>

<p>组件框架是多个独立的类库所结合起来的。不同的组件框架可以一起使用在微型或是全栈框架上。</p>

</section>


<section class="chapter" id="components">
    <h2 id="components_title">组件</h2>

<p>正如标题提到的，「组件」是另一种建立，发布及推动开源的方式。现在存在的各种的组件库，其中最主要的两个为：</p>

<ul>
  <li><a href="/#composer_and_packagist">Packagist</a></li>
  <li><a href="/#pear">PEAR</a></li>
</ul>

<p>这两个组件库都有用來安装及升级的命令行工具，这部分已经在這部分已經在[依赖管理]中解释过。</p>

<p>此外，还有基于组件的构成的框架的提供商提供不包含框架的组件。这些项目通常和其他的组件或者特定的框架没有依赖关系。</p>

<p>例如，你可以使用 [FuelPHP 验证类库]，而不使用 FuelPHP 整个框架。</p>

<ul>
  <li><a href="http://auraphp.com/framework/">Aura</a></li>
  <li>CakePHP Components
    <ul>
      <li><a href="https://github.com/cakephp/collection">Collection</a></li>
      <li><a href="https://github.com/cakephp/database">Database</a></li>
      <li><a href="https://github.com/cakephp/datasource">Datasource</a></li>
      <li><a href="https://github.com/cakephp/event">Event</a></li>
      <li><a href="https://github.com/cakephp/i18n">I18n</a></li>
      <li><a href="https://github.com/cakephp/orm">ORM</a></li>
    </ul>
  </li>
  <li><a href="https://github.com/fuelphp">FuelPHP</a></li>
  <li><a href="https://github.com/hoaproject">Hoa Project</a></li>
  <li><a href="https://symfony.com/doc/current/components/index.html">Symfony Components</a></li>
  <li><a href="https://thephpleague.com/">The League of Extraordinary Packages</a></li>
  <li>Laravel’s Illuminate Components
    <ul>
      <li><a href="https://github.com/illuminate/container">IoC Container</a></li>
      <li><a href="https://github.com/illuminate/database">Eloquent ORM</a></li>
      <li><a href="https://github.com/illuminate/queue">Queue</a></li>
    </ul>
  </li>
</ul>

<p><em>Laravel 的 [Illuminate 组件] 和 Laravel 框架将变得更加解耦。 现在我们只列出和 Laravel 框架最没有依赖关系的组件。</em></p>

<p>Laravel 中文资料：</p>

<ul>
  <li><a href="https://learnku.com/topics/3383">Laravel 中文书籍《Laravel 入门教程》</a></li>
  <li><a href="https://learnku.com/docs/laravel/5.8">Laravel 中文文档，涵盖 5.1~5.8 版本</a></li>
  <li><a href="https://learnku.com/">Laravel 中文社区</a> 我们是现代化 PHP 的拥护者</li>
  <li><a href="https://cs.laravel-china.org/">Laravel 速查表</a></li>
</ul>

</section>


<section class="chapter" id="other_resources">
    <h2 id="other_resources_title">Other Useful Resources</h2>

<h3 id="cheatsheets">Cheatsheets</h3>

<ul>
  <li><a href="http://phpcheatsheets.com/">PHP Cheatsheets</a> - for variable comparisons, arithmetics and variable testing in various
PHP versions</li>
  <li><a href="https://www.owasp.org/index.php/OWASP_Cheat_Sheet_Series">OWASP Security Cheatsheets</a> - provides a concise collection of high value information on specific application security topics.</li>
</ul>

<h3 id="section">更多最佳实践</h3>

<ul>
  <li><a href="https://phpbestpractices.org/">PHP Best Practices</a></li>
  <li><a href="https://www.airpair.com/php/posts/best-practices-for-modern-php-development">Best practices for Modern PHP Development</a></li>
  <li><a href="https://kinsta.com/blog/php-versions/">Why You Should Be Using Supported PHP Versions</a></li>
</ul>

<h3 id="php-web-">PHP Web 开发社区的新人</h3>

<p>你可以通过订阅周刊资讯来获取关于扩展包推荐、最新消息、特殊事件或者是社区公告，还有不定时发布的资源：</p>

<ul>
  <li><a href="http://www.phpweekly.com">PHP Weekly</a></li>
  <li><a href="https://javascriptweekly.com/">JavaScript Weekly</a></li>
  <li><a href="https://frontendfoc.us/">Frontend Focus</a></li>
  <li><a href="https://mobiledevweekly.com/">Mobile Web Weekly</a></li>
</ul>

<h3 id="php-">PHP 世界</h3>

<ul>
  <li><a href="https://blog.phpdeveloper.org/">PHP Developer blog</a></li>
</ul>

<h2 id="laravel-">Laravel 中文资料</h2>

<ul>
  <li><a href="https://learnku.com/topics/3383">Laravel 中文书籍《Laravel 入门教程》</a></li>
  <li><a href="https://learnku.com/docs/laravel/5.8">Laravel 中文文档，涵盖 5.1~5.8 版本</a></li>
  <li><a href="https://learnku.com/">Laravel 中文社区</a> 我们是现代化 PHP 的拥护者</li>
  <li><a href="https://cs.laravel-china.org/">Laravel 速查表</a></li>
</ul>

</section>


<section class="chapter" id="videos">
    <h3 id="videos">Youtube 视频</h3>

<ul>
  <li><a href="https://www.youtube.com/user/phpacademy">PHP Academy</a></li>
  <li><a href="https://www.youtube.com/user/thenewboston">The New Boston</a></li>
  <li><a href="https://www.youtube.com/user/businessgeek">Sherif Ramadan</a></li>
  <li><a href="https://www.youtube.com/user/LevelUpTuts">Level Up Tuts</a></li>
</ul>

<h3 id="section">付费视频</h3>

<ul>
  <li><a href="https://teamtreehouse.com/library/php-standards-and-best-practices">Standards and Best practices</a></li>
  <li><a href="https://www.pluralsight.com/search?q=php">PHP Training on Pluralsight</a></li>
  <li><a href="https://www.lynda.com/search?q=php">PHP Training on Lynda.com</a></li>
  <li><a href="https://code.tutsplus.com/categories/php/courses">PHP Training on Tutsplus</a></li>
  <li><a href="https://laracasts.com/">Laracasts</a></li>
</ul>

</section>


<section class="chapter" id="books">
    <h2 id="books_title">书籍</h2>

<p>市面上有很多关于 PHP 的书，但遗憾的是很多都已经非常陈旧而且不正确的资料。甚至还有出版商发布「 PHP 6 」，这是不存在的书，而且永远不会出现。因为那些书，所以 PHP 的下一个版本为「 PHP 7 」，[原因在此] (https://wiki.php.net/rfc/php6)。</p>

<p>这个章节的目录主要是针对 PHP 开发，并且会随着最新的技术趋势而更新。如果你想在这里加入你的书，请发送一个 PR ，我们将会审查你提供的内容是否有相关性。</p>

<h3 id="section">免费书籍</h3>

<ul>
  <li><a href="http://daylerees.com/php-pandas/">PHP Pandas</a> - Web 开发入门书籍</li>
  <li><a href="https://leanpub.com/phptherightway/">PHP The Right Way</a> - 本书完全免费</li>
  <li><a href="https://paragonie.com/book/pecl-libsodium">Using Libsodium in PHP Projects</a> - 使用 Libsodium 来构建现代的、安全的、快速的 PHP 加密</li>
</ul>

<h3 id="section-1">付费书籍</h3>

<ul>
  <li><a href="https://learnku.com/laravel/t/3383/laravel-the-first-chinese-new-book-laravel-tutorial">Laravel 中文书籍《Laravel 入门教程》</a> - Web 开发实战书籍，一步步构建一个微博应用</li>
  <li><a href="https://apisyouwonthate.com/">Build APIs You Won’t Hate</a> - Everyone and their dog wants an API,
so you should probably learn how to build them.</li>
  <li><a href="http://shop.oreilly.com/product/0636920033868.do">Modern PHP</a> - covers modern PHP features, best practices, testing, tuning, deployment and setting up a dev environment.</li>
  <li><a href="https://leanpub.com/buildingsecurephpapps">Building Secure PHP Apps</a> - Learn the security basics that a senior
developer usually acquires over years of experience, all condensed down into one quick and easy handbook</li>
  <li><a href="https://leanpub.com/mlaphp">Modernizing Legacy Applications In PHP</a> - Get your code under control in a series of
small, specific steps</li>
  <li><a href="https://leanpub.com/securingphp-coreconcepts">Securing PHP: Core Concepts</a> - A guide to some of the most common
security terms and provides some examples of them in every day PHP</li>
  <li><a href="http://www.scalingphpbook.com/">Scaling PHP</a> - Stop playing sysadmin and get back to coding</li>
  <li><a href="https://leanpub.com/signalingphp">Signaling PHP</a> - PCNLT signals are a great help when writing PHP scripts that
run from the command line.</li>
  <li><a href="https://leanpub.com/minimumviabletests">Minimum Viable Tests</a> - Long-time PHP testing evangelist Chris Hartjes goes over what he feels is the minimum you need to know to get started.</li>
  <li><a href="https://leanpub.com/ddd-in-php">Domain-Driven Design in PHP</a> - See real examples written in PHP showcasing Domain-Driven Design Architectural Styles (Hexagonal Architecture, CQRS or Event Sourcing), Tactical Design Patterns, and Bounded Context Integration.</li>
</ul>

</section>

<div class="back-to-top"><p><a href="#top" class="top">回到顶部</a></p>
</div>
<section class="chapter" id="community">
    <h1 id="community_title">社区</h1>

<p>PHP 社区多元化并且规模庞大，成员们也乐意并随时准备好帮助新人。你可以考虑加入当地的 PHP 使用者社区 （PUG） 或者参加教大型的 PHP 会议，从中学习更多最佳实践。你也可以使用 IRC 逛逛 <a href="https://webchat.freenode.net/?channels=phpc">irc.freenode.com</a> 上的 #phpc 频道，也可以关注 <a href="https://twitter.com/phpc">@phpc</a> 的Twitter 账号。试着去多结交一些新的开发者，学习新的东西，总之，交一些新朋友！其他的社区资源包含 Google+ 的 PHP <a href="https://plus.google.com/u/0/communities/104245651975268426012">Programmer community</a> 以及 <a href="https://stackoverflow.com/questions/tagged/php">StackOverflow</a>。</p>

<p>中文的 PHP 开发者，欢迎加入 <a href="https://learnku.com/php">LearnKu 社区</a>。LearnKu 是终身学习者的编程知识社区。</p>

<p><a href="https://secure.php.net/cal.php">阅读 PHP 官方事件日历</a></p>


</section>


<section class="chapter" id="user_groups">
    <h2 id="user_groups_title">PHP 用户群</h2>

<p>如果你住在较大的城市，附近应该就有 PHP 用户群。你可以通过基于 <a href="https://php.ug/">PHP.ug</a> 的 [usergroup-list at php.net][php-uglist] 这个地址找到当地的 PUG。也可以通过 <a href="http://www.meetup.com/find/">Meetup.com</a> 或者使用搜索引擎 (i.e. <a href="https://www.google.com/search?q=php+user+group+near+me">Google</a>) 搜索 <code>php user group near me</code> 。如果你住在比较小的城镇，当地也许还没有 PUG ，如果是这种情形，不妨就开始组建一个。</p>

<p>这里要特别提到两个全球的用户组：<a href="https://nomadphp.com/">NomadPHP</a> 和 <a href="http://phpwomen.org/">PHPWomen</a>。<a href="https://nomadphp.com/">NomadPHP</a> 提供每月两次的在线用户组会议，由 PHP 社区里顶尖的高手进行演讲。<a href="http://phpwomen.org/">PHPWomen</a> 原本是针对女性 PHP 开发者的非排他性的用户组。会员资格发放给那些支持多元化社区的人。PHPWomen 提供了一技术支持，指导和教育的个平台，并且促进了女性的创造力以及专业的氛围。</p>

<p><a href="https://wiki.php.net/usergroups">了解关于 PHP Wiki 上的用户群</a></p>


</section>


<section class="chapter" id="conferences">
    <h2 id="conferences_title">PHP 会议</h2>

<p>世界各地的 PHP 社区也会举办一些较大型的区域性或国际性的会议，一些知名的社区成员通常会在这些大型活动中现身演讲，这是一个直接和业内领袖学习的好机会。</p>

<p><a href="https://secure.php.net/conferences/index.php">查找 PHP 会议</a></p>


</section>


<section class="chapter" id="elephpants">
    <h2 id="elephpants_title">ElePHPants</h2>

<p><a href="https://secure.php.net/elephpant.php">ElePHPant</a> is that beautiful mascot of the PHP project with elephant in their design. It was originally designed for the PHP project in 1998 by <a href="http://www.elroubio.net/">Vincent Pontier</a> - spiritual father of thousands of elePHPants around the world and 10 years later adorable plush elephant toy came to birth as well. Now elePHPants are present at many PHP conferences and with many PHP developers at their computers for fun and inspiration.</p>

<p><a href="https://7php.com/elephpant/">Interview with Vincent Pontier</a></p>


</section>


        </div>

        <footer class="site-footer" id="credits">
            <h2>中文版本</h2>  
            <ul>
                <li><a href="https://github.com/leo-yi/php-the-right-way/" target="_blank">Leo Yi</a></li>
                <li><a href="https://github.com/laravel-china/php-the-right-way/graphs/contributors" target="_blank">项目贡献者</a></li>
            </ul>
            <h2>感谢之前的维护者</h2>
            <ul>
                <li><a href="https://github.com/summerblue" target="_blank">Summer</a></li>
                <li><a href="https://laravel-china.org/" target="_blank">Laravel China 社区</a></li>
            </ul>
            <h2>原始版本创建和维护</h2>
            <ul>
                    <li><a href="https://joshlockhart.com" target="_blank">Josh Lockhart</a></li>
                    <li><a href="https://philsturgeon.uk/" target="_blank">Phil Sturgeon</a></li>
                    <li><a href="https://github.com/codeguy/php-the-right-way/graphs/contributors" target="_blank">Project Contributors</a></li>
            </ul>
            <div class="license">
                <a class="cc-badge" rel="license" href="https://creativecommons.org/licenses/by-nc-sa/3.0/"></a>
                <br />
                <span xmlns:dct="http://purl.org/dc/terms/" href="http://purl.org/dc/dcmitype/Text" property="dct:title" rel="dct:type">PHP: The Right Way</span> by <a xmlns:cc="http://creativecommons.org/ns#" href="https://joshlockhart.com" property="cc:attributionName" rel="cc:attributionURL">Josh Lockhart</a>
                <br/>
                is licensed under a <a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/3.0/">Creative Commons Attribution-NonCommercial-ShareAlike 3.0 Unported License</a>.<br />Based on a work at <a xmlns:dct="http://purl.org/dc/terms/" href="https://www.phptherightway.com" rel="dct:source">www.phptherightway.com</a>.
            </div>
        </footer>
    </body>
</html>
